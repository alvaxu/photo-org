# 快速问题解决指南

## 文档说明

本文档提供常见问题的快速解决方案，适用于紧急情况下的问题排查和修复。

**使用场景**: 系统出现问题时快速定位和解决  
**目标用户**: 开发人员、维护人员  
**更新频率**: 随问题解决经验更新  

---

## 🚨 紧急问题快速修复

### 1. 系统无法启动

#### 症状
```
ImportError: numpy.core.multiarray failed to import
AttributeError: _ARRAY_API not found
```

#### 快速修复
```bash
# 1. 停止系统
Ctrl+C

# 2. 清理环境
rm -rf venv
find . -name "__pycache__" -type d -exec rm -rf {} +

# 3. 重建环境
python -m venv venv
venv\Scripts\activate
pip install -e .

# 4. 重启系统
python main.py
```

#### 验证
```bash
curl http://localhost:8000/health
```

---

### 2. 数据库字段缺失

#### 症状
```
(sqlite3.OperationalError) no such column: photos.description
```

#### 快速修复
```bash
# 1. 停止系统
Ctrl+C

# 2. 删除数据库
rm data/photos.db
rm -rf photos_storage

# 3. 重启系统（自动重建数据库）
python main.py
```

---

### 3. 前端无法访问

#### 症状
- 浏览器显示404或500错误
- 静态文件无法加载

#### 快速修复
```bash
# 1. 检查系统状态
curl http://localhost:8000/health

# 2. 检查静态文件
curl http://localhost:8000/static/index.html

# 3. 重启系统
python main.py
```

---

## 🔧 环境问题诊断

### 检查Python环境
```bash
# 检查Python版本
python --version

# 检查pip版本
pip --version

# 检查虚拟环境
which python
# Windows: where python
```

### 检查包版本
```bash
# 检查关键包版本
pip list | grep -E "(numpy|opencv|fastapi)"

# 检查包兼容性
python -c "import numpy; print('NumPy:', numpy.__version__)"
python -c "import cv2; print('OpenCV:', cv2.__version__)"
```

### 检查数据库
```bash
# 检查数据库文件
ls -la data/
# Windows: dir data\

# 检查数据库结构
sqlite3 data/photos.db ".schema"
```

---

## 📋 常用诊断命令

### 系统状态检查
```bash
# 健康检查
curl http://localhost:8000/health

# API文档
curl http://localhost:8000/docs

# 前端页面
curl http://localhost:8000/static/index.html
```

### 日志检查
```bash
# 查看应用日志
tail -f logs/app.log

# 查看错误日志
grep -i error logs/app.log
```

### 进程检查
```bash
# 检查Python进程
ps aux | grep python
# Windows: tasklist | findstr python

# 检查端口占用
netstat -tulpn | grep :8000
# Windows: netstat -an | findstr :8000
```

---

## 🛠️ 环境重建流程

### 完整环境重建
```bash
# 1. 备份重要数据
cp -r photos_storage photos_storage_backup
cp data/photos.db data/photos.db.backup

# 2. 清理环境
rm -rf venv
find . -name "__pycache__" -type d -exec rm -rf {} +
find . -name "*.pyc" -delete

# 3. 重建虚拟环境
python -m venv venv
venv\Scripts\activate
python -m pip install --upgrade pip

# 4. 安装依赖
pip install -e .

# 5. 启动系统
python main.py
```

### 快速环境修复
```bash
# 1. 重新安装关键包
pip install --force-reinstall "numpy>=1.21.0,<2.0.0"
pip install --force-reinstall "opencv-python==4.8.1.78"

# 2. 重启系统
python main.py
```

---

## 📚 相关文档

### 详细文档
- [问题排查与解决经验文档.md](./问题排查与解决经验文档.md)
- [NumPy_OpenCV兼容性问题解决案例.md](./NumPy_OpenCV兼容性问题解决案例.md)
- [开发环境搭建指南.md](./开发环境搭建指南.md)

### 配置文件
- `requirements.txt`: 依赖包版本约束
- `config.json`: 系统配置文件
- `setup.py`: 项目包配置

### 脚本文件
- `main.py`: 系统启动入口
- `test_package_import.py`: 包导入测试
- `run_system_test.py`: 系统功能测试

---

## ⚠️ 注意事项

### 数据安全
- 重建环境前务必备份重要数据
- 数据库文件位于 `data/photos.db`
- 照片文件位于 `photos_storage/` 目录

### 版本兼容性
- NumPy版本必须 < 2.0.0
- OpenCV版本固定为 4.8.1.78
- Python版本建议使用 3.8-3.12

### 常见陷阱
- 不要使用 `pip install --upgrade` 升级关键包
- 避免在全局环境安装项目依赖
- 确保虚拟环境路径正确

---

## 🆘 紧急联系

如果以上方法都无法解决问题，请：

1. **收集信息**
   - 完整的错误信息
   - 系统环境信息
   - 问题复现步骤

2. **查看详细文档**
   - 参考 `doc/问题排查与解决经验文档.md`
   - 查看相关错误案例

3. **寻求帮助**
   - 提供详细的错误信息
   - 说明已尝试的解决方案
   - 附上系统环境信息

---

**文档维护**: 本文档应保持简洁明了，便于紧急情况下快速查阅。
