<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- Edgeæµè§ˆå™¨å…¼å®¹æ€§ä¿®å¤ -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="msapplication-TileColor" content="#0d6efd">
    <meta name="theme-color" content="#0d6efd">
    <title>ç›¸ä¼¼ç…§è¯†åˆ« - å®¶åº­ç‰ˆæ™ºèƒ½ç…§ç‰‡ç³»ç»Ÿ</title>

    <!-- Bootstrap CSS - ä¼˜å…ˆä½¿ç”¨æœ¬åœ°ç‰ˆæœ¬ -->
    <link href="/static/lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/lib/bootstrap-icons/css/bootstrap-icons.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons å­—ä½“ä¿®å¤ -->
    <style>
        @font-face {
            font-display: block;
            font-family: "bootstrap-icons";
            src: url("/static/lib/bootstrap-icons/fonts/bootstrap-icons.woff2?2ab2cbbe07fcebb53bdaa7313bb290f2") format("woff2"),
                 url("/static/lib/bootstrap-icons/fonts/bootstrap-icons.woff?2ab2cbbe07fcebb53bdaa7313bb290f2") format("woff");
        }
    </style>
    
    <!-- CDNå¤‡ç”¨åŠ è½½ -->
    <script>
        // å¦‚æœæœ¬åœ°èµ„æºåŠ è½½å¤±è´¥ï¼Œå°è¯•CDN
        setTimeout(function() {
            const links = document.querySelectorAll('link[href*="/static/lib/"]');
            links.forEach(link => {
                if (!link.sheet) {
                    console.warn('æœ¬åœ°èµ„æºåŠ è½½å¤±è´¥ï¼Œå°è¯•CDN:', link.href);
                    if (link.href.includes('bootstrap.min.css')) {
                        link.href = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css';
                    } else if (link.href.includes('bootstrap-icons.min.css')) {
                        link.href = 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css';
                    }
                }
            });
        }, 2000);
    </script>
    
    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <link href="/static/css/style.css?v=20250120_01" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/images/xuwh.ico">
</head>
<body>
    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="container-fluid mt-4">
        <!-- ç›¸ä¼¼ç…§è¯†åˆ«é¡µé¢ -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-images me-2"></i>ç›¸ä¼¼ç…§è¯†åˆ«
                            <small class="text-muted ms-2">
                                <span id="clustersCount">0</span> ä¸ªèšç±»
                            </small>
                        </h5>
                        <div class="btn-group" role="group">
                            <button class="btn btn-sm btn-outline-primary" id="refreshClustersBtn">
                                <i class="bi bi-arrow-clockwise"></i> åˆ·æ–°
                            </button>
                            <button class="btn btn-sm btn-outline-info" id="imageFeatureExtractionBtn" title="æå–ç…§ç‰‡çš„æ·±åº¦ç‰¹å¾å‘é‡ï¼Œç”¨äºç²¾ç¡®çš„ç›¸ä¼¼ç…§ç‰‡æœç´¢ï¼ŒåŸºäºResNet50æ¨¡å‹">
                                <i class="bi bi-image"></i> ç‰¹å¾æå–
                            </button>
                            <button class="btn btn-sm btn-outline-success" id="startClusterBtn" title="åŸºäºå·²æå–çš„ç‰¹å¾å‘é‡ï¼Œä½¿ç”¨DBSCANç®—æ³•å¯¹ç›¸ä¼¼ç…§ç‰‡è¿›è¡Œè‡ªåŠ¨èšç±»åˆ†ç»„ï¼Œéœ€è¦å…ˆå®Œæˆç‰¹å¾æå–">
                                <i class="bi bi-diagram-3"></i> å¼€å§‹èšç±»
                            </button>
                            <a class="btn btn-sm btn-outline-secondary" href="/">
                                <i class="bi bi-grid-3x3-gap"></i> è¿”å›ç…§ç‰‡åº“é¦–é¡µ
                            </a>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- èšç±»è¿›åº¦æ˜¾ç¤º -->
                        <div id="clusterProgress" class="d-none mb-4">
                            <div class="alert alert-info">
                                <div class="d-flex align-items-center mb-2">
                                    <div class="spinner-border spinner-border-sm me-2" role="status">
                                        <span class="visually-hidden">å¤„ç†ä¸­...</span>
                                    </div>
                                    <strong>èšç±»åˆ†æè¿›è¡Œä¸­...</strong>
                                </div>
                                <div class="progress mb-2" style="height: 25px;">
                                    <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" 
                                         id="clusterProgressBar"
                                         role="progressbar"
                                         style="width: 0%; min-width: 2%; transition: width 0.3s ease;"
                                         aria-valuenow="0"
                                         aria-valuemin="0"
                                         aria-valuemax="100"></div>
                                </div>
                                <div class="text-center">
                                    <p class="mb-1" id="clusterStatus">æ­£åœ¨å‡†å¤‡èšç±»åˆ†æ...</p>
                                    <small class="text-muted" id="clusterDetails">è¯·ç¨å€™...</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                        <div class="row mb-4">
                            <div class="col-md-3 col-sm-6 mb-3">
                                <div class="card bg-light h-100">
                                    <div class="card-body text-center">
                                        <h5 class="card-title text-primary">ğŸ“¦ æ€»èšç±»</h5>
                                        <h3 class="text-primary" id="totalClustersCount">-</h3>
                                        <small class="text-muted">ä¸ªèšç±»</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6 mb-3">
                                <div class="card bg-light h-100">
                                    <div class="card-body text-center">
                                        <h5 class="card-title text-success">ğŸ“¸ èšç±»ç…§ç‰‡</h5>
                                        <h3 class="text-success" id="totalPhotosInClusters">-</h3>
                                        <small class="text-muted">å¼ ç…§ç‰‡</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6 mb-3">
                                <div class="card bg-light h-100">
                                    <div class="card-body text-center">
                                        <h5 class="card-title text-warning">â­ é«˜è´¨é‡</h5>
                                        <h3 class="text-warning" id="highQualityClustersCount">-</h3>
                                        <small class="text-muted">ä¸ªèšç±»</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6 mb-3">
                                <div class="card bg-light h-100">
                                    <div class="card-body text-center">
                                        <h5 class="card-title text-info">ğŸ“Š å¹³å‡ç›¸ä¼¼åº¦</h5>
                                        <h3 class="text-info" id="avgSimilarity">-</h3>
                                        <small class="text-muted">%</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- èšç±»åˆ—è¡¨ -->
                        <div id="clustersList" class="row g-3">
                            <!-- èšç±»å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>

                        <!-- åˆ†é¡µä¿¡æ¯ -->
                        <div id="clustersPaginationInfo" class="mt-4 d-none">
                            <div class="row">
                                <div class="col-md-6">
                                    <small class="text-muted" id="clustersPaginationText">
                                        <!-- åˆ†é¡µä¿¡æ¯å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                    </small>
                                </div>
                                <div class="col-md-6 text-end">
                                    <small class="text-muted">
                                        æ¯é¡µæ˜¾ç¤º <span id="clustersPageSize">30</span> ä¸ªèšç±»
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- åˆ†é¡µ -->
                        <div id="clustersPaginationContainer" class="mt-2 d-none">
                            <nav aria-label="èšç±»åˆ†é¡µ">
                                <ul class="pagination justify-content-center" id="clustersPagination">
                                    <!-- åˆ†é¡µæŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                </ul>
                            </nav>
                        </div>

                        <!-- ç©ºçŠ¶æ€ -->
                        <div id="clustersEmptyState" class="text-center py-5 d-none">
                            <i class="bi bi-images display-1 text-muted"></i>
                            <h4 class="mt-3 text-muted">æš‚æ— ç›¸ä¼¼ç…§èšç±»</h4>
                            <p class="text-muted">è¯·å…ˆè¿›è¡Œç‰¹å¾æå–ï¼Œç„¶åå¼€å§‹èšç±»åˆ†æ</p>
                            <button class="btn btn-primary" id="startClusterFirstBtn" title="åŸºäºå·²æå–çš„ç‰¹å¾å‘é‡ï¼Œä½¿ç”¨DBSCANç®—æ³•å¯¹ç›¸ä¼¼ç…§ç‰‡è¿›è¡Œè‡ªåŠ¨èšç±»åˆ†ç»„ï¼Œéœ€è¦å…ˆå®Œæˆç‰¹å¾æå–">
                                <i class="bi bi-diagram-3 me-2"></i>å¼€å§‹èšç±»
                            </button>
                        </div>

                        <!-- åŠ è½½çŠ¶æ€ -->
                        <div id="clustersLoadingState" class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">åŠ è½½ä¸­...</span>
                            </div>
                            <p class="mt-3 text-muted">æ­£åœ¨åŠ è½½èšç±»æ•°æ®...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- èšç±»ç…§ç‰‡æ¨¡æ€æ¡† -->
    <div class="modal fade" id="clusterPhotosModal" tabindex="-1" aria-labelledby="clusterPhotosModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="clusterPhotosModalLabel">
                        <i class="bi bi-images me-2"></i>èšç±»ç…§ç‰‡
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="clusterPhotosContainer" class="row g-3">
                        <!-- ç…§ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div id="clusterPhotosLoading" class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">åŠ è½½ä¸­...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS - ä¼˜å…ˆä½¿ç”¨æœ¬åœ°ç‰ˆæœ¬ -->
    <script src="/static/lib/bootstrap/js/bootstrap.bundle.min.js"></script>
    
    <!-- CDNå¤‡ç”¨åŠ è½½ -->
    <script>
        // å¦‚æœæœ¬åœ°Bootstrap JSåŠ è½½å¤±è´¥ï¼Œå°è¯•CDN
        setTimeout(function() {
            if (typeof bootstrap === 'undefined') {
                console.warn('æœ¬åœ°Bootstrap JSåŠ è½½å¤±è´¥ï¼Œå°è¯•CDN');
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js';
                script.onload = function() {
                    console.log('CDN Bootstrap JSåŠ è½½æˆåŠŸ');
                };
                document.head.appendChild(script);
            }
        }, 2000);
    </script>
    
    <!-- ç…§ç‰‡è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal fade" id="photoModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="photoModalTitle">ç…§ç‰‡è¯¦æƒ…</h5>
                    <div class="d-flex align-items-center gap-2">
                        <button type="button" class="btn btn-sm btn-outline-primary" id="downloadPhotoBtn">
                            <i class="bi bi-download"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-secondary" id="editPhotoBtn">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-success" id="addToFavoritesBtn">
                            <i class="bi bi-heart"></i>
                        </button>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                </div>
                <div class="modal-body">
                    <!-- ç…§ç‰‡è¯¦æƒ…å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- å›¾åƒç‰¹å¾æå–æ¨¡æ€æ¡† -->
    <div class="modal fade" id="imageFeatureExtractionModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-image me-2"></i>å›¾åƒç‰¹å¾æå–
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        å›¾åƒç‰¹å¾æå–å°†ä¸ºç…§ç‰‡ç”Ÿæˆæ·±åº¦ç‰¹å¾å‘é‡ï¼Œç”¨äºç²¾ç¡®çš„ç›¸ä¼¼ç…§ç‰‡æœç´¢<br>
                        åŸºäºResNet50æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œæå–2048ç»´ç‰¹å¾å‘é‡<br>
                        æ­¤åŠŸèƒ½è°ƒç”¨æœ¬åœ°æ¨¡å‹ï¼Œå¤„ç†å¿«é€Ÿé«˜æ•ˆ
                    </div>

                    <!-- ç…§ç‰‡æ•°é‡ç»Ÿè®¡ -->
                    <div class="alert alert-warning" id="featurePhotoCountInfo" style="display: none;">
                        <i class="bi bi-info-circle me-2"></i>
                        <span id="featurePhotoCountText">æ­£åœ¨è·å–ç…§ç‰‡æ•°é‡...</span>
                    </div>

                    <!-- æ‰¹æ¬¡ä¿¡æ¯æ˜¾ç¤º -->
                    <div id="featureBatchInfo" class="mb-3" style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="bi bi-collection me-2"></i>æ‰¹æ¬¡å¤„ç†ä¿¡æ¯</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <label class="form-label">æ€»ç…§ç‰‡æ•°ï¼š</label>
                                        <div class="fw-bold" id="featureTotalPhotos">-</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">é¢„è®¡æ‰¹æ¬¡æ•°ï¼š</label>
                                        <div class="fw-bold" id="featureBatchCount">-</div>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-md-6">
                                        <label class="form-label">æ¯æ‰¹ç…§ç‰‡æ•°ï¼š</label>
                                        <div class="text-muted" id="featureBatchSize">-</div>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">åˆ†æ‰¹é˜ˆå€¼ï¼š</label>
                                        <div class="text-muted" id="featureBatchThreshold">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="featureProgress" class="d-none mt-3">
                        <div class="progress mb-2" style="height: 25px;">
                            <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" 
                                 id="featureProgressBar" 
                                 style="width: 0%; min-width: 2%; transition: width 0.3s ease;"></div>
                        </div>
                        <div class="text-center mb-2">
                            <p class="mb-1" id="featureStatus">æ­£åœ¨å‡†å¤‡ç‰¹å¾æå–...</p>
                            <small class="text-muted" id="featureDetails">è¯·ç¨å€™...</small>
                        </div>
                        <div class="row text-center" id="featureStats" style="display: none;">
                            <div class="col-3">
                                <div class="border rounded p-2">
                                    <div class="h5 mb-0 text-primary" id="featureProcessedCount">0</div>
                                    <small class="text-muted">å·²å¤„ç†</small>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="border rounded p-2">
                                    <div class="h5 mb-0 text-success" id="featureExtractedCount">0</div>
                                    <small class="text-muted">æˆåŠŸæå–</small>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="border rounded p-2">
                                    <div class="h5 mb-0 text-warning" id="featureSkippedCount">0</div>
                                    <small class="text-muted">è·³è¿‡</small>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="border rounded p-2">
                                    <div class="h5 mb-0 text-danger" id="featureFailedCount">0</div>
                                    <small class="text-muted">å¤±è´¥</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-primary" id="startFeatureExtractionBtn">å¼€å§‹ç‰¹å¾æå–</button>
                </div>
            </div>
        </div>
    </div>

    <!-- å¿…è¦çš„JavaScriptæ–‡ä»¶ï¼ˆç”¨äºç…§ç‰‡è¯¦æƒ…åŠŸèƒ½ï¼‰ -->
    <script src="/static/js/app-utils.js"></script>
    <script src="/static/js/app-data.js"></script>
    <script src="/static/js/app-ui.js"></script>
    <script src="/static/js/app-photos.js"></script>
    
    <!-- å›¾åƒç‰¹å¾æå–è„šæœ¬ -->
    <script src="/static/js/image-feature-extraction.js?v=20250120_01"></script>
    
    <!-- ç›¸ä¼¼ç…§è¯†åˆ«ç®¡ç†è„šæœ¬ -->
    <script src="/static/js/similar-photos-management.js"></script>
</body>
</html>

