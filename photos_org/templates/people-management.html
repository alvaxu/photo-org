<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <!-- Edgeæµè§ˆå™¨å…¼å®¹æ€§ä¿®å¤ -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="msapplication-TileColor" content="#0d6efd">
    <meta name="theme-color" content="#0d6efd">
    <title>äººç‰©ç®¡ç† - å®¶åº­ç‰ˆæ™ºèƒ½ç…§ç‰‡ç³»ç»Ÿ</title>

    <!-- Bootstrap CSS - ä¼˜å…ˆä½¿ç”¨æœ¬åœ°ç‰ˆæœ¬ -->
    <link href="/static/lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/lib/bootstrap-icons/css/bootstrap-icons.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons å­—ä½“ä¿®å¤ -->
    <style>
        @font-face {
            font-display: block;
            font-family: "bootstrap-icons";
            src: url("/static/lib/bootstrap-icons/fonts/bootstrap-icons.woff2?2ab2cbbe07fcebb53bdaa7313bb290f2") format("woff2"),
                 url("/static/lib/bootstrap-icons/fonts/bootstrap-icons.woff?2ab2cbbe07fcebb53bdaa7313bb290f2") format("woff");
        }
    </style>
    
    <!-- CDNå¤‡ç”¨åŠ è½½ -->
    <script>
        // å¦‚æœæœ¬åœ°èµ„æºåŠ è½½å¤±è´¥ï¼Œå°è¯•CDN
        setTimeout(function() {
            const links = document.querySelectorAll('link[href*="/static/lib/"]');
            links.forEach(link => {
                if (!link.sheet) {
                    console.warn('æœ¬åœ°èµ„æºåŠ è½½å¤±è´¥ï¼Œå°è¯•CDN:', link.href);
                    if (link.href.includes('bootstrap.min.css')) {
                        link.href = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css';
                    } else if (link.href.includes('bootstrap-icons.min.css')) {
                        link.href = 'https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css';
                    }
                }
            });
        }, 2000);
    </script>
    
    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <link href="/static/css/style.css?v=20250120_01" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/images/xuwh.ico">
</head>
<body>
    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="container-fluid mt-4">
        <!-- äººç‰©ç®¡ç†é¡µé¢ -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-people me-2"></i>äººç‰©ç®¡ç†
                            <small class="text-muted ms-2">
                                <span id="peopleCount">0</span> ä¸ªäººç‰©
                            </small>
                        </h5>
                        <div class="btn-group" role="group">
                            <button class="btn btn-sm btn-outline-primary" id="refreshPeopleBtn">
                                <i class="bi bi-arrow-clockwise"></i> åˆ·æ–°
                            </button>
                            <button class="btn btn-sm btn-outline-success" id="startFaceRecognitionBtn">
                                <i class="bi bi-camera"></i> å¼€å§‹äººè„¸è¯†åˆ«
                            </button>
                            <a class="btn btn-sm btn-outline-secondary" href="/">
                                <i class="bi bi-grid-3x3-gap"></i> è¿”å›ç…§ç‰‡åº“é¦–é¡µ
                            </a>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- äººç‰©ç»Ÿè®¡ä¿¡æ¯ -->
                        <div class="row mb-4">
                            <div class="col-md-3 col-sm-6 mb-3">
                                <div class="card bg-light h-100">
                                    <div class="card-body text-center">
                                        <h5 class="card-title text-primary">ğŸ‘¥ æ€»äººç‰©</h5>
                                        <h3 class="text-primary" id="totalPeopleCount">-</h3>
                                        <small class="text-muted">ä¸ªäººç‰©</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6 mb-3">
                                <div class="card bg-light h-100">
                                    <div class="card-body text-center">
                                        <h5 class="card-title text-success">ğŸ·ï¸ å·²æ ‡è®°</h5>
                                        <h3 class="text-success" id="labeledPeopleCount">-</h3>
                                        <small class="text-muted">ä¸ªèšç±»</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6 mb-3">
                                <div class="card bg-light h-100">
                                    <div class="card-body text-center">
                                        <h5 class="card-title text-warning">â“ æœªæ ‡è®°</h5>
                                        <h3 class="text-warning" id="unlabeledPeopleCount">-</h3>
                                        <small class="text-muted">ä¸ªèšç±»</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6 mb-3">
                                <div class="card bg-light h-100">
                                    <div class="card-body text-center">
                                        <h5 class="card-title text-info">ğŸ“¸ æ€»äººè„¸</h5>
                                        <h3 class="text-info" id="totalFacesCount">-</h3>
                                        <small class="text-muted">ä¸ªäººè„¸</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- èšç±»æ˜¾ç¤ºæç¤º -->
                        <div class="alert alert-info d-flex align-items-center justify-content-between" id="clusterDisplayNotice" style="display: none;">
                            <div class="d-flex align-items-center">
                                <i class="bi bi-info-circle me-2 fs-5"></i>
                                <small id="clusterDisplayNoticeText">
                                    å½“å‰æ˜¾ç¤ºé…ç½®ï¼šä»…æ˜¾ç¤ºè‡³å°‘ <strong id="minClusterSizeNotice">2</strong> å¼ ç…§ç‰‡çš„èšç±»ï¼Œæœ€å¤šæ˜¾ç¤ºå‰ <strong id="maxClustersNotice">40</strong> ä¸ªæœ€å¤§çš„èšç±»
                                </small>
                            </div>
                            <button class="btn btn-sm btn-outline-primary" id="faceRecognitionConfigBtn" title="é…ç½®æ˜¾ç¤ºå‚æ•°">
                                <i class="bi bi-gear"></i> é…ç½®
                            </button>
                        </div>

                        <!-- äººç‰©åˆ—è¡¨ -->
                        <div id="peopleList" class="row g-3">
                            <!-- äººç‰©å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>

                        <!-- ç©ºçŠ¶æ€ -->
                        <div id="peopleEmptyState" class="text-center py-5 d-none">
                            <i class="bi bi-people display-1 text-muted"></i>
                            <h4 class="mt-3 text-muted">æš‚æ— äººç‰©æ•°æ®</h4>
                            <p class="text-muted">è¯·å…ˆè¿›è¡Œäººè„¸è¯†åˆ«åˆ†æ</p>
                            <button class="btn btn-primary" id="startFaceRecognitionFirstBtn">
                                <i class="bi bi-camera me-2"></i>å¼€å§‹äººè„¸è¯†åˆ«
                            </button>
                        </div>

                        <!-- åŠ è½½çŠ¶æ€ -->
                        <div id="peopleLoadingState" class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">åŠ è½½ä¸­...</span>
                            </div>
                            <p class="mt-3 text-muted">æ­£åœ¨åŠ è½½äººç‰©æ•°æ®...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS - ä¼˜å…ˆä½¿ç”¨æœ¬åœ°ç‰ˆæœ¬ -->
    <script src="/static/lib/bootstrap/js/bootstrap.bundle.min.js"></script>
    
    <!-- CDNå¤‡ç”¨åŠ è½½ -->
    <script>
        // å¦‚æœæœ¬åœ°Bootstrap JSåŠ è½½å¤±è´¥ï¼Œå°è¯•CDN
        setTimeout(function() {
            if (typeof bootstrap === 'undefined') {
                console.warn('æœ¬åœ°Bootstrap JSåŠ è½½å¤±è´¥ï¼Œå°è¯•CDN');
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js';
                script.onload = function() {
                    console.log('CDN Bootstrap JSåŠ è½½æˆåŠŸ');
                };
                document.head.appendChild(script);
            }
        }, 2000);
    </script>
    
    <!-- æµè§ˆå™¨å…¼å®¹æ€§ä¿®å¤ -->
    <script>
        // æµè§ˆå™¨å…¼å®¹æ€§æ£€æµ‹å’Œä¿®å¤
        function detectBrowser() {
            const userAgent = navigator.userAgent;
            const isEdge = userAgent.indexOf('Edg') > -1;
            const isChrome = userAgent.indexOf('Chrome') > -1 && !isEdge;
            const isFirefox = userAgent.indexOf('Firefox') > -1;
            const isSafari = userAgent.indexOf('Safari') > -1 && !isChrome && !isEdge;
            
            return { isEdge, isChrome, isFirefox, isSafari };
        }
        
        const browser = detectBrowser();
        
        // åªå¯¹Edgeæµè§ˆå™¨åº”ç”¨ç‰¹å®šçš„ä¿®å¤
        if (browser.isEdge) {
            // æ·»åŠ Edgeæµè§ˆå™¨ç‰¹å®šçš„CSSç±»
            document.documentElement.classList.add('edge-browser');
            
            // ä¿®å¤Edgeæµè§ˆå™¨çš„Flexboxé—®é¢˜
            if (!CSS.supports('display', 'flex')) {
                document.documentElement.classList.add('no-flexbox');
            }
            
            // ä¿®å¤Edgeæµè§ˆå™¨çš„Gridé—®é¢˜
            if (!CSS.supports('display', 'grid')) {
                document.documentElement.classList.add('no-grid');
            }
            
            // ä¿®å¤Edgeæµè§ˆå™¨çš„CSSå˜é‡é—®é¢˜
            if (!CSS.supports('color', 'var(--test)')) {
                document.documentElement.classList.add('no-css-vars');
            }
        }
        
        // ç¡®ä¿Bootstrap 5åœ¨æ‰€æœ‰æµè§ˆå™¨ä¸­æ­£å¸¸å·¥ä½œ
        document.addEventListener('DOMContentLoaded', function() {
            // åªåœ¨Edgeæµè§ˆå™¨ä¸­åº”ç”¨ç‰¹å®šçš„ä¿®å¤
            if (browser.isEdge) {
                // ä¿®å¤Edgeæµè§ˆå™¨çš„æ¨¡æ€æ¡†é—®é¢˜
                var modals = document.querySelectorAll('.modal');
                modals.forEach(function(modal) {
                    modal.addEventListener('shown.bs.modal', function() {
                        // ç¡®ä¿æ¨¡æ€æ¡†åœ¨Edgeæµè§ˆå™¨ä¸­æ­£ç¡®æ˜¾ç¤º
                        this.style.display = 'block';
                    });
                });
                
                // ä¿®å¤Edgeæµè§ˆå™¨çš„è¡¨å•æ§ä»¶é—®é¢˜
                var formControls = document.querySelectorAll('.form-control, .form-select');
                formControls.forEach(function(control) {
                    control.addEventListener('focus', function() {
                        this.style.borderColor = '#0d6efd';
                        this.style.boxShadow = '0 0 0 0.2rem rgba(13, 110, 253, 0.25)';
                    });
                    control.addEventListener('blur', function() {
                        this.style.borderColor = '#ced4da';
                        this.style.boxShadow = 'none';
                    });
                });
            }
            
            // é€šç”¨ä¿®å¤ï¼šç¡®ä¿æ‰€æœ‰æµè§ˆå™¨çš„ä¸‹æ‹‰èœå•æ­£å¸¸å·¥ä½œ
            var dropdowns = document.querySelectorAll('.dropdown-toggle');
            dropdowns.forEach(function(dropdown) {
                // ç§»é™¤å¯èƒ½å†²çªçš„äº‹ä»¶ç›‘å¬å™¨
                dropdown.removeEventListener('click', handleDropdownClick);
                
                // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬å™¨
                dropdown.addEventListener('click', handleDropdownClick);
            });
            
            function handleDropdownClick(e) {
                // è®©Bootstrap 5å¤„ç†ä¸‹æ‹‰èœå•ï¼Œä¸è¦é˜»æ­¢é»˜è®¤è¡Œä¸º
                // åªåœ¨å¿…è¦æ—¶è¿›è¡Œå¹²é¢„
                var menu = this.nextElementSibling;
                if (menu && menu.classList.contains('dropdown-menu')) {
                    // ç¡®ä¿èœå•æœ‰æ­£ç¡®çš„z-index
                    if (!menu.style.zIndex) {
                        menu.style.zIndex = '9999';
                    }
                }
            }
            
            // é€šç”¨ä¿®å¤ï¼šç¡®ä¿æ‰€æœ‰æµè§ˆå™¨çš„åŸºæœ¬åŠŸèƒ½æ­£å¸¸
            console.log('æµè§ˆå™¨æ£€æµ‹ç»“æœ:', browser);
        });
    </script>

    <!-- äººè„¸è¯†åˆ«æ¨¡æ€æ¡† -->
    <div class="modal fade" id="faceRecognitionModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">äººè„¸è¯†åˆ«åˆ†æ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        äººè„¸è¯†åˆ«å°†åˆ†ææ‰€æœ‰ç…§ç‰‡ä¸­çš„äººè„¸ï¼Œè¿›è¡Œèšç±»å’Œæ ‡è®°<br>
                       é¦–æ¬¡ä½¿ç”¨éœ€è¦åŠ è½½æœ¬åœ°æ¨¡å‹å’Œç›¸å…³æ¨¡å—ï¼Œå› æ­¤æ—¶é—´ç•¥é•¿
                    </div>

                    <!-- ç…§ç‰‡æ•°é‡ç»Ÿè®¡ -->
                    <div class="alert alert-warning" id="facePhotoCountInfo" style="display: none;">
                        <i class="bi bi-info-circle me-2"></i>
                        <span id="facePhotoCountText">æ­£åœ¨è·å–ç…§ç‰‡æ•°é‡...</span>
                    </div>

                    <div id="faceProgress" class="d-none mt-3">
                        <div class="progress mb-2">
                            <div class="progress-bar" id="faceProgressBar" style="width: 0%"></div>
                        </div>
                        <p class="text-center" id="faceStatus">æ­£åœ¨å¤„ç†...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="startFaceBtn">å¼€å§‹äººè„¸è¯†åˆ«</button>
                </div>
            </div>
        </div>
    </div>

    <!-- äººè„¸è¯†åˆ«é…ç½®æ¨¡æ€æ¡† -->
    <div class="modal fade" id="faceRecognitionConfigModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="bi bi-gear me-2"></i>äººè„¸è¯†åˆ«æ˜¾ç¤ºé…ç½®
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        é…ç½®äººè„¸è¯†åˆ«æ˜¾ç¤ºçš„èšç±»å‚æ•°
                    </div>

                    <!-- æœ€å°èšç±»ç…§ç‰‡æ•° -->
                    <div class="mb-3">
                        <label for="configMinClusterSize" class="form-label">
                            <i class="bi bi-people me-1"></i>æœ€å°èšç±»ç…§ç‰‡æ•°
                            <i class="bi bi-question-circle text-muted ms-1" data-bs-toggle="tooltip" title="åŒä¸€ä¸ªäººè‡³å°‘éœ€è¦åœ¨å¤šå°‘å¼ ç…§ç‰‡ä¸­å‡ºç°æ‰èƒ½å½¢æˆä¸€ä¸ªèšç±»"></i>
                        </label>
                        <input type="number" class="form-control" id="configMinClusterSize" min="1" max="10" value="2">
                        <div class="form-text">å»ºè®®å€¼ï¼š2-3å¼ ã€‚å€¼è¶Šå°ï¼Œè¶Šå®¹æ˜“å½¢æˆèšç±»ï¼ˆåŒ…æ‹¬ä»…å‡ºç°1æ¬¡çš„äººç‰©ï¼‰ï¼›å€¼è¶Šå¤§ï¼Œè¦æ±‚åŒä¸€ä¸ªäººåœ¨æ›´å¤šå¼ ç…§ç‰‡ä¸­å‡ºç°æ‰èƒ½å½¢æˆèšç±»ã€‚</div>
                    </div>

                    <!-- æœ€å¤§æ˜¾ç¤ºèšç±»æ•° -->
                    <div class="mb-3">
                        <label for="configMaxClusters" class="form-label">
                            <i class="bi bi-list-ol me-1"></i>æœ€å¤§æ˜¾ç¤ºèšç±»æ•°
                            <i class="bi bi-question-circle text-muted ms-1" data-bs-toggle="tooltip" title="æœ€å¤šæ˜¾ç¤ºå¤šå°‘ä¸ªæœ€å¤§çš„èšç±»"></i>
                        </label>
                        <input type="number" class="form-control" id="configMaxClusters" min="10" max="200" value="40">
                        <div class="form-text">å»ºè®®å€¼ï¼š30-50ã€‚å¦‚æœç…§ç‰‡ä¸­äººç‰©è¾ƒå¤šï¼Œå¯ä»¥é€‚å½“å¢åŠ æ­¤å€¼ã€‚</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-primary" id="saveFaceRecognitionConfigBtn">
                        <i class="bi bi-check-lg me-1"></i>ä¿å­˜é…ç½®
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- åº”ç”¨è„šæœ¬ -->
    <script src="/static/js/app-data.js?v=20250120_01"></script>
    <script src="/static/js/people-management-standalone.js?v=20250120_01"></script>
</body>
</html>
