# 家庭照片整理系统 - 数据需求分析

## 一、数据需求概览

基于我们的家庭照片整理系统需求，我们需要以下四类数据：

### 1. **基础文件数据** (必需)
- 文件基本信息
- 存储路径信息
- 文件状态信息

### 2. **技术元数据** (重要)
- EXIF拍摄信息
- 图像技术参数
- 文件完整性信息

### 3. **智能分析数据** (核心)
- AI内容分析结果
- 质量评估数据
- 重复检测数据

### 4. **用户管理数据** (辅助)
- 分类标签信息
- 用户操作记录
- 系统配置数据

## 二、详细数据需求

### 2.1 基础文件数据

**必需字段**：
```sql
- id: 照片唯一标识
- filename: 原始文件名
- file_path: 存储路径
- file_size: 文件大小(字节)
- file_hash: 文件MD5哈希
- width: 图像宽度
- height: 图像高度
- format: 图像格式(JPEG/PNG等)
- created_at: 创建时间
- updated_at: 更新时间
- status: 处理状态(imported/analyzing/completed/error)
```

**可选字段**：
```sql
- thumbnail_path: 缩略图路径
- original_path: 原始文件路径(如果移动过)
- import_source: 导入来源(web/drag/scan)
- file_extension: 文件扩展名
```

### 2.2 技术元数据

**EXIF数据** (从EXIF提取)：
```sql
- camera_make: 相机品牌
- camera_model: 相机型号
- lens_model: 镜头型号
- focal_length: 焦距
- aperture: 光圈值
- shutter_speed: 快门速度
- iso: ISO感光度
- flash: 闪光灯使用
- white_balance: 白平衡
- exposure_mode: 曝光模式
- metering_mode: 测光模式
- date_taken: 拍摄时间
- gps_latitude: GPS纬度
- gps_longitude: GPS经度
- gps_altitude: GPS海拔
- orientation: 图像方向
```

**图像技术参数** (从OpenCV分析)：
```sql
- sharpness: 清晰度评分
- brightness: 亮度值
- contrast: 对比度值
- color_temperature: 色温
- saturation: 饱和度
- noise_level: 噪声水平
- dynamic_range: 动态范围
- aspect_ratio: 宽高比
- total_pixels: 总像素数
```

### 2.3 智能分析数据

**AI内容分析** (从Qwen-VL模型)：
```sql
- description: 照片描述
- scene_type: 场景类型(室内/室外/风景/人物等)
- objects: 检测到的物体列表
- people_count: 人物数量
- emotion: 情感分析
- activity: 活动类型
- time_period: 时间特征(白天/夜晚/季节)
- location_type: 地点类型(家庭/户外/旅行等)
- confidence: 分析置信度
- tags: 自动生成的标签
```

**质量评估** (从OpenCV分析)：
```sql
- quality_score: 综合质量评分(0-100)
- sharpness_score: 清晰度评分
- brightness_score: 亮度评分
- contrast_score: 对比度评分
- color_score: 色彩评分
- composition_score: 构图评分
- technical_issues: 技术问题列表
- quality_level: 质量等级(优秀/良好/一般/较差)
```

**重复检测** (从感知哈希)：
```sql
- perceptual_hash: 感知哈希值
- duplicate_group_id: 重复组ID
- similarity_score: 相似度评分
- is_duplicate: 是否为重复照片
- duplicate_count: 重复照片数量
```

### 2.4 用户管理数据

**分类标签**：
```sql
- category_id: 分类ID
- category_name: 分类名称
- parent_category_id: 父分类ID
- category_type: 分类类型(自动/手动/系统)
- tag_id: 标签ID
- tag_name: 标签名称
- tag_confidence: 标签置信度
- tag_source: 标签来源(AI/用户/系统)
```

**用户操作**：
```sql
- user_id: 用户ID
- action_type: 操作类型(查看/编辑/删除/分享)
- action_time: 操作时间
- action_details: 操作详情
- ip_address: IP地址
```

## 三、数据来源映射

### 3.1 EXIF数据源
**可提取数据**：
- 拍摄时间、相机信息、GPS位置
- 技术参数(光圈、快门、ISO等)
- 图像方向、白平衡等

**实际需求**：
- 拍摄时间(用于时间线排序)
- 相机信息(用于设备分类)
- GPS位置(用于地点分类)
- 技术参数(用于质量评估)

### 3.2 OpenCV数据源
**可提取数据**：
- 60+个技术指标
- 质量评估、颜色分析、纹理分析
- 几何特征、频域分析等

**实际需求**：
- 质量评分(用于质量筛选)
- 颜色信息(用于颜色搜索)
- 清晰度(用于质量排序)
- 几何特征(用于重复检测)

### 3.3 AI模型数据源
**可提取数据**：
- 场景识别、物体检测、人物识别
- 情感分析、活动识别
- 自动标签生成

**实际需求**：
- 场景分类(用于自动分类)
- 物体标签(用于内容搜索)
- 情感标签(用于情感筛选)
- 自动描述(用于搜索和展示)

## 四、数据存储策略

### 4.1 数据库设计
**主表**：photos (照片基础信息)
**扩展表**：
- photo_metadata (技术元数据)
- photo_analysis (AI分析结果)
- photo_quality (质量评估)
- photo_duplicates (重复检测)

### 4.2 存储优化
**JSON字段**：复杂数据存储为JSON
**索引优化**：关键字段建立索引
**分页查询**：大数据量分页处理

### 4.3 数据完整性
**必填字段**：基础文件信息
**可选字段**：EXIF和AI分析数据
**默认值**：缺失数据使用默认值
**数据验证**：入库前数据格式验证

## 五、实际应用场景

### 5.1 照片分类
**需要数据**：
- 场景类型 (AI分析)
- 拍摄时间 (EXIF)
- 地点信息 (EXIF GPS)
- 质量评分 (OpenCV)

### 5.2 智能搜索
**需要数据**：
- 照片描述 (AI分析)
- 标签信息 (AI+用户)
- 技术参数 (EXIF)
- 质量指标 (OpenCV)

### 5.3 重复检测
**需要数据**：
- 感知哈希 (OpenCV)
- 相似度评分 (算法计算)
- 文件大小 (基础信息)

### 5.4 质量筛选
**需要数据**：
- 综合质量评分 (OpenCV)
- 技术问题列表 (OpenCV)
- 清晰度评分 (OpenCV)

## 六、数据优先级

### 6.1 高优先级 (必需)
- 基础文件信息
- 拍摄时间
- 图像尺寸
- 文件哈希

### 6.2 中优先级 (重要)
- 质量评分
- 场景分类
- 基础标签
- 重复检测

### 6.3 低优先级 (可选)
- 详细技术参数
- 复杂AI分析
- 用户操作记录
- 高级标签

## 七、总结

我们的项目需要的数据包括：

1. **基础数据**：文件信息、存储路径、基本属性
2. **技术数据**：EXIF元数据、OpenCV分析结果
3. **智能数据**：AI分析结果、质量评估、重复检测
4. **管理数据**：分类标签、用户操作、系统配置

这些数据完全可以通过我们测试的EXIF、OpenCV和AI模型来获取，能够满足家庭照片整理系统的所有功能需求。
