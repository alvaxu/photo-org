
## ğŸ¯ **GPSè½¬åœ°å€åŠŸèƒ½è®¾è®¡æ–¹æ¡ˆ**

**æœ€ç»ˆæŠ€æœ¯é€‰å‹ï¼šé«˜å¾·åœ°å›¾API**

æ‚¨çš„äº¤äº’è®¾è®¡éå¸¸å¥½ï¼åŸºäºè¯¦ç»†åˆ†æï¼Œæˆ‘ä»¬ç¡®å®šä½¿ç”¨é«˜å¾·åœ°å›¾ä½œä¸ºGPSè½¬åœ°å€çš„è§£å†³æ–¹æ¡ˆã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„åŠŸèƒ½è®¾è®¡æ–¹æ¡ˆï¼š

## ğŸ—‚ï¸ **åŠŸèƒ½æ¶æ„è®¾è®¡**

### **1. å¯¼èˆªæ GPSè½¬åœ°å€æŒ‰é’®**
```
å¯¼èˆªæ : [ğŸ”„ GPSè½¬åœ°å€]  â† æ–°å¢æŒ‰é’®
```

### **2. ç…§ç‰‡å±•ç¤ºåŒºå•å¼ è½¬æ¢**
```
ç…§ç‰‡å¡ç‰‡:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ğŸ“ é‡æ–°è§£æåœ°å€] â† æ–°å¢æŒ‰é’®    â”‚
â”‚                                 â”‚
â”‚ ğŸ–¼ï¸ ç…§ç‰‡ç¼©ç•¥å›¾                   â”‚
â”‚                                 â”‚
â”‚ ğŸ“ åœ°å€: æµ™æ±Ÿçœå®æ³¢å¸‚åŒ—ä»‘åŒº...   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ **æŠ€æœ¯å®ç°è¦ç‚¹**

### **åç«¯APIè®¾è®¡**

#### **æ‰¹é‡GPSè½¬åœ°å€API**
```python
@app.post("/api/photos/batch-convert-gps-address")
async def batch_convert_gps_address(
    photo_ids: List[int] = Body(...),
    background_tasks: BackgroundTasks = None,
    db: Session = Depends(get_db)
):
    """
    æ‰¹é‡å°†GPSåæ ‡è½¬æ¢ä¸ºåœ°å€
    
    :param photo_ids: ç…§ç‰‡IDåˆ—è¡¨ï¼ˆå¯é€‰ï¼Œä¸ä¼ åˆ™å¤„ç†æ‰€æœ‰æœ‰GPSçš„ç…§ç‰‡ï¼‰
    :return: ä»»åŠ¡çŠ¶æ€
    """
    # 1. ç­›é€‰æœ‰GPSä½†æ²¡æœ‰åœ°å€çš„ç…§ç‰‡
    query = db.query(Photo).filter(
        Photo.location_lat.isnot(None),
        Photo.location_lng.isnot(None),
        Photo.location_name.is_(None)  # è¿˜æ²¡æœ‰åœ°å€çš„
    )
    
    if photo_ids:
        query = query.filter(Photo.id.in_(photo_ids))
    
    photos_to_process = query.all()
    
    if not photos_to_process:
        return {"message": "æ²¡æœ‰éœ€è¦è½¬æ¢çš„ç…§ç‰‡"}
    
    # 2. åˆ›å»ºåå°ä»»åŠ¡
    task_id = f"gps_convert_{int(time.time())}"
    
    background_tasks.add_task(
        process_gps_batch_conversion,
        photos_to_process,
        task_id
    )
    
    return {
        "task_id": task_id,
        "total_photos": len(photos_to_process),
        "message": f"å·²å¯åŠ¨æ‰¹é‡è½¬æ¢ï¼Œå…±{len(photos_to_process)}å¼ ç…§ç‰‡"
    }
```

#### **å•å¼ ç…§ç‰‡åœ°å€é‡è§£æAPI**
```python
@app.post("/api/photos/{photo_id}/convert-gps-address")
async def convert_single_photo_address(
    photo_id: int,
    force: bool = False,  # å¼ºåˆ¶é‡æ–°è½¬æ¢ï¼Œå³ä½¿å·²æœ‰åœ°å€
    db: Session = Depends(get_db)
):
    """
    è½¬æ¢å•å¼ ç…§ç‰‡çš„GPSä¸ºåœ°å€
    
    :param photo_id: ç…§ç‰‡ID
    :param force: æ˜¯å¦å¼ºåˆ¶é‡æ–°è½¬æ¢
    """
    photo = db.query(Photo).filter(Photo.id == photo_id).first()
    if not photo:
        raise HTTPException(status_code=404, detail="ç…§ç‰‡ä¸å­˜åœ¨")
    
    if not photo.location_lat or not photo.location_lng:
        raise HTTPException(status_code=400, detail="ç…§ç‰‡æ²¡æœ‰GPSä¿¡æ¯")
    
    # æ£€æŸ¥æ˜¯å¦å·²æœ‰åœ°å€ä¸”ä¸å¼ºåˆ¶æ›´æ–°
    if photo.location_name and not force:
        return {
            "address": photo.location_name,
            "message": "ç…§ç‰‡å·²æœ‰åœ°å€ä¿¡æ¯"
        }
    
    # è°ƒç”¨åœ°å›¾APIè·å–åœ°å€
    address = await map_service.reverse_geocode(
        photo.location_lat, 
        photo.location_lng
    )
    
    # æ›´æ–°æ•°æ®åº“
    photo.location_name = address
    db.commit()
    
    return {
        "address": address,
        "message": "åœ°å€è½¬æ¢æˆåŠŸ"
    }
```

### **å‰ç«¯å®ç°**

#### **å¯¼èˆªæ æ‰¹é‡æŒ‰é’®**
```javascript
// åœ¨å¯¼èˆªæ æ·»åŠ æ‰¹é‡GPSè½¬æ¢æŒ‰é’®
function addBatchGpsButton() {
    const navBar = document.querySelector('.navbar-actions');
    
    const gpsButton = document.createElement('button');
    gpsButton.className = 'btn btn-outline-primary btn-sm me-2';
    gpsButton.id = 'gpsConvertBtn';
    gpsButton.title = 'å°†æ‰€æœ‰æœ‰GPSçš„ç…§ç‰‡è½¬æ¢ä¸ºåœ°å€';
    gpsButton.innerHTML = '<i class="bi bi-geo-alt"></i> GPSè½¬åœ°å€';
    gpsButton.onclick = () => batchConvertGpsAddresses();
    
    navBar.appendChild(gpsButton);
}

async function batchConvertGpsAddresses() {
    const btn = document.getElementById('gpsConvertBtn');
    const originalText = btn.innerHTML;

    try {
        // æ£€æŸ¥API Keyæ˜¯å¦é…ç½®
        if (!await checkApiKeyConfigured()) {
            showToast('è¯·å…ˆé…ç½®é«˜å¾·åœ°å›¾API Key', 'warning');
            window.open('/help-gaode-api-key', '_blank');
            return;
        }

        // æ˜¾ç¤ºå¤„ç†ä¸­çŠ¶æ€
        btn.disabled = true;
        btn.innerHTML = '<i class="bi bi-geo-alt-fill"></i> è½¬æ¢ä¸­...';
        showToast('æ­£åœ¨è½¬æ¢GPSåœ°å€ï¼Œè¯·ç¨å€™...', 'info');

        const response = await fetch('/api/photos/batch-convert-gps-address', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'}
        });

        if (!response.ok) {
            const error = await response.json();
            throw new Error(error.detail || 'è½¬æ¢å¤±è´¥');
        }

        const result = await response.json();

        // è½®è¯¢ä»»åŠ¡çŠ¶æ€
        const success = await pollBatchConversion(result.task_id);

        if (success) {
            showToast('GPSè½¬åœ°å€è½¬æ¢å®Œæˆï¼', 'success');
            // åˆ·æ–°ç…§ç‰‡åˆ—è¡¨
            await loadPhotos();
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            await updateGpsButton();
        }

    } catch (error) {
        showToast(`è½¬æ¢å¤±è´¥: ${error.message}`, 'error');
    } finally {
        // æ¢å¤æŒ‰é’®çŠ¶æ€
        btn.disabled = false;
        btn.innerHTML = originalText;
    }
}
```

#### **ç…§ç‰‡å¡ç‰‡åœ°å€é‡è§£ææŒ‰é’®**
```javascript
// ä¸ºæ¯å¼ æœ‰GPSçš„ç…§ç‰‡æ·»åŠ é‡è§£ææŒ‰é’®
function addAddressResolveButtons() {
    document.querySelectorAll('.photo-card').forEach(card => {
        const photoId = card.dataset.photoId;
        const hasGps = card.dataset.hasGps === 'true';
        const hasAddress = card.dataset.hasAddress === 'true';
        
        if (hasGps) {
            const button = document.createElement('button');
            button.className = 'btn btn-sm btn-outline-info address-resolve-btn';
            button.innerHTML = hasAddress ? 'ğŸ”„ é‡è§£æåœ°å€' : 'ğŸ“ è§£æåœ°å€';
            button.onclick = () => resolvePhotoAddress(photoId, hasAddress);
            
            // æ·»åŠ åˆ°ç…§ç‰‡å¡ç‰‡çš„æŸä¸ªä½ç½®
            const actionsDiv = card.querySelector('.photo-actions');
            actionsDiv.appendChild(button);
        }
    });
}

async function resolvePhotoAddress(photoId, hasExistingAddress) {
    const force = hasExistingAddress; // å¦‚æœå·²æœ‰åœ°å€ï¼Œå¼ºåˆ¶æ›´æ–°
    
    try {
        const response = await fetch(`/api/photos/${photoId}/convert-gps-address`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({force: force})
        });
        
        const result = await response.json();
        
        // æ›´æ–°ç•Œé¢æ˜¾ç¤º
        updatePhotoAddress(photoId, result.address);
        showToast(result.message, 'success');
        
    } catch (error) {
        showToast('åœ°å€è§£æå¤±è´¥', 'error');
    }
}
```

## âš™ï¸ **ç³»ç»Ÿé…ç½®**

### **åœ°å›¾æœåŠ¡é…ç½®**
```json
// config.json
{
  "maps": {
    "provider": "amap",
    "api_key": "",  // ç”¨æˆ·å¯é…ç½®ï¼Œä¸ºç©ºæ—¶åŠŸèƒ½ä¸å¯ç”¨
    "batch_size": 10,    // æ‰¹é‡å¤„ç†æ—¶æ¯æ¬¡APIè°ƒç”¨æ•°é‡
    "rate_limit": 180,   // æ¯åˆ†é’Ÿæœ€å¤§APIè°ƒç”¨æ¬¡æ•°ï¼ˆé«˜å¾·é™åˆ¶200ï¼‰
    "cache_enabled": true,
    "cache_ttl": 86400,  // åœ°å€ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰
    "timeout": 10        // APIè°ƒç”¨è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
  }
}
```

### **ç”¨æˆ·ç•Œé¢é…ç½®**

#### **API Keyè®¾ç½®é¡µé¢**
- **è®¿é—®è·¯å¾„**: `/help-gaode-api-key`
- **åŠŸèƒ½**: å¼•å¯¼ç”¨æˆ·ç”³è¯·å’Œé…ç½®é«˜å¾·åœ°å›¾API Key
- **åŒ…å«å†…å®¹**:
  - é«˜å¾·APIç”³è¯·æ•™ç¨‹
  - Keyé…ç½®ç•Œé¢
  - ä½¿ç”¨è¯´æ˜å’Œæ³¨æ„äº‹é¡¹
  - è´¹ç”¨æé†’

#### **ç…§ç‰‡ç•Œé¢å¢å¼º**
- **GPSçŠ¶æ€æ ‡è¯†**: ç…§ç‰‡å¡ç‰‡æ˜¾ç¤ºGPSå›¾æ ‡
- **åœ°å€æ˜¾ç¤º**: æ”¯æŒå±•å¼€/æ”¶èµ·å®Œæ•´åœ°å€
- **è½¬æ¢æŒ‰é’®**: æ™ºèƒ½æ˜¾ç¤ºï¼ˆè§£æ/é‡è§£æï¼‰
- **è¿›åº¦åé¦ˆ**: è½¬æ¢è¿‡ç¨‹ä¸­çš„çŠ¶æ€æç¤º

## ğŸ”§ **æ ¸å¿ƒæŠ€æœ¯å®ç°**

### **é«˜å¾·åœ°å›¾APIé›†æˆ**

#### **APIè°ƒç”¨å°è£…**
```python
# app/services/map_service.py
class AMapService:
    """é«˜å¾·åœ°å›¾æœåŠ¡"""

    def __init__(self):
        self.api_key = settings.maps.api_key
        self.base_url = "https://restapi.amap.com"
        self.timeout = settings.maps.timeout

    def reverse_geocode(self, lat: float, lng: float) -> Optional[str]:
        """
        GPSåæ ‡è½¬åœ°å€ï¼ˆé€†åœ°ç†ç¼–ç ï¼‰

        :param lat: çº¬åº¦
        :param lng: ç»åº¦
        :return: æ ¼å¼åŒ–çš„åœ°å€å­—ç¬¦ä¸²
        """
        if not self.api_key:
            raise ValueError("é«˜å¾·API Keyæœªé…ç½®")

        url = f"{self.base_url}/v3/geocode/regeo"
        params = {
            "location": f"{lng},{lat}",  # é«˜å¾·APIï¼šç»åº¦,çº¬åº¦
            "key": self.api_key,
            "radius": 1000,  # æœç´¢åŠå¾„(ç±³)
            "extensions": "all",  # è¿”å›è¯¦ç»†ä¿¡æ¯
            "output": "json"
        }

        try:
            response = requests.get(url, params=params, timeout=self.timeout)
            data = response.json()

            if data.get("status") == "1" and data.get("info") == "OK":
                return data["regeocode"]["formatted_address"]
            else:
                logger.warning(f"é«˜å¾·APIè°ƒç”¨å¤±è´¥: {data.get('info', 'æœªçŸ¥é”™è¯¯')}")
                return None

        except Exception as e:
            logger.error(f"é«˜å¾·APIè°ƒç”¨å¼‚å¸¸: {e}")
            return None

    def batch_reverse_geocode(self, locations: List[Tuple[float, float]]) -> Dict[str, str]:
        """
        æ‰¹é‡GPSåæ ‡è½¬åœ°å€

        :param locations: [(lat, lng), ...] åæ ‡åˆ—è¡¨
        :return: {coord_key: address} åœ°å€å­—å…¸
        """
        results = {}

        # æ§åˆ¶å¹¶å‘å’Œé¢‘ç‡é™åˆ¶
        batch_size = settings.maps.batch_size
        rate_limit = settings.maps.rate_limit

        for i in range(0, len(locations), batch_size):
            batch = locations[i:i + batch_size]

            # å¹¶å‘ç”Ÿæˆåœ°å€
            tasks = []
            for lat, lng in batch:
                coord_key = f"{lat:.6f}_{lng:.6f}"
                # è¿™é‡Œå¯ä»¥æ”¹ä¸ºå¼‚æ­¥è°ƒç”¨ä»¥æé«˜æ€§èƒ½
                address = self.reverse_geocode(lat, lng)
                if address:
                    results[coord_key] = address

            # é¢‘ç‡æ§åˆ¶
            if i + batch_size < len(locations):
                time.sleep(60 / rate_limit * batch_size)

        return results
```

#### **ç¼“å­˜æœºåˆ¶**
```python
# app/services/map_cache_service.py
class MapCacheService:
    """åœ°å›¾ç¼“å­˜æœåŠ¡"""

    def __init__(self):
        self.cache_enabled = settings.maps.cache_enabled
        self.cache_ttl = settings.maps.cache_ttl
        # ä½¿ç”¨Redisæˆ–å†…å­˜ç¼“å­˜
        self.cache = {}  # ç®€åŒ–å®ç°ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ç”¨Redis

    def get_cached_address(self, lat: float, lng: float) -> Optional[str]:
        """è·å–ç¼“å­˜çš„åœ°å€"""
        if not self.cache_enabled:
            return None

        coord_key = f"{lat:.6f}_{lng:.6f}"
        cached_item = self.cache.get(coord_key)

        if cached_item:
            address, timestamp = cached_item
            if time.time() - timestamp < self.cache_ttl:
                return address
            else:
                # ç¼“å­˜è¿‡æœŸï¼Œåˆ é™¤
                del self.cache[coord_key]

        return None

    def set_cached_address(self, lat: float, lng: float, address: str):
        """ç¼“å­˜åœ°å€"""
        if not self.cache_enabled:
            return

        coord_key = f"{lat:.6f}_{lng:.6f}"
        self.cache[coord_key] = (address, time.time())
```

### **åç«¯APIè®¾è®¡**

#### **API Keyç®¡ç†**
```python
@app.get("/api/maps/config")
def get_map_config():
    """è·å–åœ°å›¾é…ç½®çŠ¶æ€"""
    return {
        "provider": settings.maps.provider,
        "has_api_key": bool(settings.maps.api_key),
        "cache_enabled": settings.maps.cache_enabled
    }

@app.post("/api/maps/config")
def update_map_config(api_key: str = Body(...)):
    """æ›´æ–°åœ°å›¾API Key"""
    if not api_key or len(api_key) != 32:
        raise HTTPException(status_code=400, detail="æ— æ•ˆçš„API Keyæ ¼å¼")

    # éªŒè¯API Key
    test_service = AMapService()
    test_service.api_key = api_key

    # æµ‹è¯•è°ƒç”¨
    test_result = test_service.reverse_geocode(39.9042, 116.4074)  # åŒ—äº¬åæ ‡
    if not test_result:
        raise HTTPException(status_code=400, detail="API KeyéªŒè¯å¤±è´¥")

    # ä¿å­˜é…ç½®
    settings.maps.api_key = api_key
    # è¿™é‡Œéœ€è¦å®ç°é…ç½®æ–‡ä»¶æ›´æ–°é€»è¾‘

    return {"message": "API Keyé…ç½®æˆåŠŸ"}

# ä½¿ç”¨ç»Ÿè®¡åŠŸèƒ½æš‚æ—¶ä¸å®ç°ï¼Œé¿å…å¤æ‚æ€§
```

#### **GPSè½¬åœ°å€API**
```python
@app.post("/api/photos/{photo_id}/convert-gps-address")
async def convert_single_photo_address(
    photo_id: int,
    force: bool = False,
    db: Session = Depends(get_db)
):
    """è½¬æ¢å•å¼ ç…§ç‰‡çš„GPSä¸ºåœ°å€"""

    # æ£€æŸ¥API Key
    if not settings.maps.api_key:
        raise HTTPException(
            status_code=400,
            detail="è¯·å…ˆé…ç½®é«˜å¾·åœ°å›¾API Key",
            headers={"X-Help-Page": "/help-gaode-api-key"}
        )

    photo = db.query(Photo).filter(Photo.id == photo_id).first()
    if not photo:
        raise HTTPException(status_code=404, detail="ç…§ç‰‡ä¸å­˜åœ¨")

    if not photo.location_lat or not photo.location_lng:
        raise HTTPException(status_code=400, detail="ç…§ç‰‡æ²¡æœ‰GPSä¿¡æ¯")

    # æ£€æŸ¥ç¼“å­˜
    cache_service = MapCacheService()
    cached_address = cache_service.get_cached_address(
        photo.location_lat, photo.location_lng
    )

    if cached_address and not force:
        # æ›´æ–°æ•°æ®åº“ä½†ä¸é‡æ–°è°ƒç”¨API
        photo.location_name = cached_address
        db.commit()
        return {
            "address": cached_address,
            "cached": True,
            "message": "ä½¿ç”¨ç¼“å­˜åœ°å€"
        }

    # è°ƒç”¨é«˜å¾·API
    map_service = AMapService()
    address = map_service.reverse_geocode(
        photo.location_lat,
        photo.location_lng
    )

    if not address:
        raise HTTPException(status_code=500, detail="åœ°å€è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–API Key")

    # ç¼“å­˜ç»“æœ
    cache_service.set_cached_address(
        photo.location_lat,
        photo.location_lng,
        address
    )

    # æ›´æ–°æ•°æ®åº“
    photo.location_name = address
    db.commit()

    return {
        "address": address,
        "cached": False,
        "message": "åœ°å€è½¬æ¢æˆåŠŸ"
    }

@app.get("/api/photos/gps-stats")
def get_gps_photo_stats(db: Session = Depends(get_db)):
    """è·å–GPSç…§ç‰‡ç»Ÿè®¡ä¿¡æ¯"""
    total_photos = db.query(func.count(Photo.id)).scalar()
    photos_with_gps = db.query(func.count(Photo.id)).filter(
        Photo.location_lat.isnot(None),
        Photo.location_lng.isnot(None)
    ).scalar()

    photos_with_address = db.query(func.count(Photo.id)).filter(
        Photo.location_name.isnot(None)
    ).scalar()

    photos_gps_without_address = db.query(func.count(Photo.id)).filter(
        Photo.location_lat.isnot(None),
        Photo.location_lng.isnot(None),
        Photo.location_name.is_(None)
    ).scalar()

    return {
        "total_photos": total_photos,
        "photos_with_gps": photos_with_gps,
        "photos_with_address": photos_with_address,
        "has_gps_without_address": photos_gps_without_address,
        "gps_coverage": round(photos_with_gps / total_photos * 100, 1) if total_photos > 0 else 0
    }
```

### **å‰ç«¯ç•Œé¢è®¾è®¡**

#### **API Keyè®¾ç½®é¡µé¢ (`/help-gaode-api-key`)**

##### **é¡µé¢ç»“æ„**
```html
<!-- templates/help_gaode_api_key.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>é«˜å¾·åœ°å›¾APIé…ç½® - å®¶åº­ç‰ˆæ™ºèƒ½ç…§ç‰‡ç³»ç»Ÿ</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">

    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <link href="/static/css/style.css?v=20250119_80" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/static/images/favicon.ico">

    <style>
        .help-content { max-width: 1000px; margin: 0 auto; }
        .help-image { max-width: 100%; height: auto; border: 1px solid #dee2e6; border-radius: 0.375rem; margin: 1rem 0; }
        .step-card { border-left: 4px solid #0d6efd; background-color: #f8f9fa; }
        .warning-box { background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 0.375rem; padding: 1rem; margin: 1rem 0; }
        .info-box { background-color: #d1ecf1; border: 1px solid #bee5eb; border-radius: 0.375rem; padding: 1rem; margin: 1rem 0; }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <img src="/static/images/xuwh.ico" alt="æ™ºèƒ½ç…§ç‰‡ç³»ç»Ÿ" class="me-2" style="width: 32px; height: 32px;">
                æ™ºèƒ½ç…§ç‰‡ç³»ç»Ÿ
                <small class="ms-2 text-light opacity-75">2025.10.01</small>
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../static/index.html">
                            <i class="bi bi-grid-3x3-gap"></i> ç…§ç‰‡åº“
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="settings.html">
                            <i class="bi bi-gear"></i> ç³»ç»Ÿé…ç½®
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="help-overview.html">
                            <i class="bi bi-info-circle"></i> åŠŸèƒ½è¯´æ˜
                        </a>
                    </li>
                </ul>

                <div class="d-flex">
                    <button class="btn btn-outline-light" onclick="window.close()">
                        <i class="bi bi-x-lg"></i> å…³é—­
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="container-fluid mt-4">
        <div class="help-content">
            <h1 class="mb-4">
                <i class="bi bi-geo-alt me-2"></i>
                é«˜å¾·åœ°å›¾APIé…ç½®
            </h1>

            <div class="alert alert-info">
                <i class="bi bi-info-circle me-2"></i>
                æœ¬ç³»ç»Ÿæ”¯æŒå°†ç…§ç‰‡GPSåæ ‡è½¬æ¢ä¸ºå…·ä½“åœ°å€ï¼Œæ‚¨éœ€è¦é…ç½®é«˜å¾·åœ°å›¾API Keyã€‚
            </div>

            <!-- ä¸€ã€å¼€é€šé«˜å¾·åœ°å›¾API -->
            <section class="mb-5">
                <h2 class="h3 mb-3">ä¸€ã€å¼€é€šé«˜å¾·åœ°å›¾APIæœåŠ¡</h2>

                <p>è®¿é—®<a href="https://lbs.amap.com/" target="_blank" class="text-decoration-none">é«˜å¾·å¼€æ”¾å¹³å°</a>ï¼Œæ³¨å†Œè´¦å·å¹¶å¼€é€šåœ°å›¾æœåŠ¡ã€‚</p>

                <div class="info-box">
                    <i class="bi bi-info-circle me-2"></i>
                    <strong>è¯´æ˜ï¼š</strong>é«˜å¾·åœ°å›¾APIæä¾›å…è´¹é¢åº¦ï¼Œè¶…å‡ºéƒ¨åˆ†æŒ‰é‡è®¡è´¹ã€‚
                </div>
            </section>

            <!-- äºŒã€è·å–API Key -->
            <section class="mb-5">
                <h2 class="h3 mb-3">äºŒã€è·å–API Key</h2>

                <div class="step-card p-3 mb-3">
                    <h4 class="h5">æ­¥éª¤1ï¼šåˆ›å»ºåº”ç”¨</h4>
                    <p>ç™»å½•é«˜å¾·å¼€æ”¾å¹³å° â†’ æ§åˆ¶å° â†’ åº”ç”¨ç®¡ç† â†’ åˆ›å»ºæ–°åº”ç”¨</p>
                </div>

                <div class="step-card p-3 mb-3">
                    <h4 class="h5">æ­¥éª¤2ï¼šæ·»åŠ Key</h4>
                    <p>é€‰æ‹©åº”ç”¨ â†’ æ·»åŠ Key â†’ é€‰æ‹©"WebæœåŠ¡API" â†’ æäº¤</p>
                </div>

                <div class="step-card p-3 mb-3">
                    <h4 class="h5">æ­¥éª¤3ï¼šè·å–Key</h4>
                    <p>å¤åˆ¶ç”Ÿæˆçš„32ä½Keyå­—ç¬¦ä¸²</p>
                </div>
            </section>

            <!-- ä¸‰ã€é…ç½®API Key -->
            <section class="mb-5">
                <h2 class="h3 mb-3">ä¸‰ã€é…ç½®API Key</h2>

                <form id="apiKeyForm">
                    <div class="mb-3">
                        <label for="apiKey" class="form-label">
                            <strong>é«˜å¾·API Key</strong>
                        </label>
                        <input type="text" class="form-control" id="apiKey"
                               placeholder="è¾“å…¥32ä½API Key" maxlength="32" required>
                        <div class="form-text">
                            API Keyå°†åœ¨æœ¬åœ°ä¿å­˜ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨
                        </div>
                    </div>

                    <div class="mb-3">
                        <button type="button" class="btn btn-primary" onclick="testApiKey()">
                            <i class="bi bi-check-circle"></i> æµ‹è¯•Key
                        </button>
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-save"></i> ä¿å­˜é…ç½®
                        </button>
                    </div>
                </form>
            </section>

        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- é¡µé¢è„šæœ¬ -->
    <script>
        // æµ‹è¯•API Key
        async function testApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();

            if (!apiKey || apiKey.length !== 32) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„32ä½API Key');
                return;
            }

            try {
                // è°ƒç”¨åç«¯æµ‹è¯•æ¥å£
                const response = await fetch('/api/maps/test-geocode', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        lat: 39.9042,
                        lng: 116.4074,
                        api_key: apiKey
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    alert(`API Keyæµ‹è¯•æˆåŠŸï¼åœ°å€ï¼š${result.address}`);
                } else {
                    alert(`API Keyæµ‹è¯•å¤±è´¥ï¼š${result.detail}`);
                }

            } catch (error) {
                alert('æµ‹è¯•è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ');
            }
        }

        // ä¿å­˜API Key
        document.getElementById('apiKeyForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const apiKey = document.getElementById('apiKey').value.trim();

            try {
                const response = await fetch('/api/maps/config', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({api_key: apiKey})
                });

                const result = await response.json();

                if (response.ok) {
                    alert('API Keyé…ç½®æˆåŠŸï¼');
                } else {
                    alert(`é…ç½®å¤±è´¥ï¼š${result.detail}`);
                }

            } catch (error) {
                alert('ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ');
            }
        });
    </script>
</body>
</html>
```

##### **JavaScripté€»è¾‘**
```javascript
// static/js/help_gaode_api_key.js
async function testApiKey() {
    const apiKey = document.getElementById('apiKey').value.trim();

    if (!apiKey || apiKey.length !== 32) {
        showToast('è¯·è¾“å…¥æœ‰æ•ˆçš„32ä½API Key', 'warning');
        return;
    }

    try {
        // æµ‹è¯•API Keyï¼ˆè°ƒç”¨åŒ—äº¬çš„åæ ‡ï¼‰
        const testLat = 39.9042;
        const testLng = 116.4074;

        const response = await fetch('/api/maps/test-geocode', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                lat: testLat,
                lng: testLng,
                api_key: apiKey
            })
        });

        const result = await response.json();

        if (response.ok) {
            showToast(`API Keyæµ‹è¯•æˆåŠŸï¼åœ°å€ï¼š${result.address}`, 'success');
        } else {
            showToast(`API Keyæµ‹è¯•å¤±è´¥ï¼š${result.detail}`, 'error');
        }

    } catch (error) {
        showToast('æµ‹è¯•è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ', 'error');
    }
}

async function saveApiKey(event) {
    event.preventDefault();

    const apiKey = document.getElementById('apiKey').value.trim();

    try {
        const response = await fetch('/api/maps/config', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({api_key: apiKey})
        });

        const result = await response.json();

        if (response.ok) {
            showToast('API Keyé…ç½®æˆåŠŸï¼', 'success');
// æš‚ä¸å®ç°ä½¿ç”¨ç»Ÿè®¡åŠŸèƒ½
        } else {
            showToast(`é…ç½®å¤±è´¥ï¼š${result.detail}`, 'error');
        }

    } catch (error) {
        showToast('ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ', 'error');
    }
}

async function loadUsageStats() {
    try {
        const response = await fetch('/api/maps/stats');
        const stats = await response.json();

        document.getElementById('totalCalls').textContent = stats.total_calls;
        document.getElementById('successRate').textContent = `${stats.success_rate}%`;
        document.getElementById('remainingQuota').textContent = stats.remaining_quota;

        document.getElementById('usageStats').style.display = 'block';

    } catch (error) {
        console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥:', error);
    }
}

// é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('apiKeyForm').addEventListener('submit', saveApiKey);

    // å¦‚æœå·²æœ‰é…ç½®ï¼ŒåŠ è½½ç»Ÿè®¡
    loadUsageStats();
});
```

#### **ç…§ç‰‡ç•Œé¢å¢å¼º**

##### **ç…§ç‰‡å¡ç‰‡GPSçŠ¶æ€æ˜¾ç¤º**
```html
<!-- ç…§ç‰‡å¡ç‰‡æ¨¡æ¿ -->
<div class="photo-card" data-photo-id="{{ photo.id }}"
     data-has-gps="{{ 'true' if photo.location_lat else 'false' }}"
     data-has-address="{{ 'true' if photo.location_name else 'false' }}">

    <div class="photo-image">
        <img src="{{ photo.thumbnail_url }}" alt="{{ photo.filename }}">

        <!-- GPSçŠ¶æ€å›¾æ ‡ -->
        {% if photo.location_lat %}
        <div class="gps-indicator" title="åŒ…å«GPSä¿¡æ¯">
            <i class="fas fa-map-marker-alt"></i>
        </div>
        {% endif %}
    </div>

    <div class="photo-info">
        <h6>{{ photo.filename }}</h6>

        <!-- åœ°å€æ˜¾ç¤ºåŒºåŸŸ -->
        {% if photo.location_name %}
        <div class="photo-address">
            <small class="text-muted">
                <i class="fas fa-map-marked-alt"></i>
                <span class="address-text">{{ photo.location_name }}</span>
            </small>
        </div>
        {% endif %}
    </div>

    <div class="photo-actions">
        <!-- GPSè½¬åœ°å€æŒ‰é’® -->
        {% if photo.location_lat %}
        <button class="btn btn-sm btn-outline-info address-resolve-btn"
                onclick="resolvePhotoAddress({{ photo.id }}, {{ 'true' if photo.location_name else 'false' }})">
            {% if photo.location_name %}
                <i class="fas fa-sync-alt"></i> é‡è§£æåœ°å€
            {% else %}
                <i class="fas fa-map-marked-alt"></i> è§£æåœ°å€
            {% endif %}
        </button>
        {% endif %}

        <!-- å…¶ä»–æ“ä½œæŒ‰é’® -->
        <button class="btn btn-sm btn-outline-primary">æŸ¥çœ‹</button>
        <button class="btn btn-sm btn-outline-danger">åˆ é™¤</button>
    </div>
</div>
```

##### **å¯¼èˆªæ GPSè½¬åœ°å€æŒ‰é’®**
```html
<!-- å¯¼èˆªæ GPSè½¬åœ°å€æŒ‰é’® -->
<div class="d-flex">
    <button class="btn btn-outline-primary me-2" onclick="batchConvertGps()"
            id="gpsConvertBtn" title="å°†æ‰€æœ‰æœ‰GPSçš„ç…§ç‰‡è½¬æ¢ä¸ºåœ°å€">
        <i class="bi bi-geo-alt"></i> GPSè½¬åœ°å€
    </button>
</div>
```

##### **æŒ‰é’®çŠ¶æ€ç®¡ç†**
```javascript
// æ£€æŸ¥æ˜¯å¦æœ‰GPSç…§ç‰‡å¹¶æ›´æ–°æŒ‰é’®çŠ¶æ€
async function updateGpsButton() {
    try {
        const response = await fetch('/api/photos/gps-stats');
        const stats = await response.json();

        const btn = document.getElementById('gpsConvertBtn');
        if (stats.has_gps_without_address > 0) {
            btn.classList.remove('btn-outline-secondary');
            btn.classList.add('btn-outline-primary');
            btn.disabled = false;
            btn.innerHTML = `<i class="bi bi-geo-alt"></i> GPSè½¬åœ°å€ (${stats.has_gps_without_address})`;
        } else {
            btn.classList.remove('btn-outline-primary');
            btn.classList.add('btn-outline-secondary');
            btn.disabled = true;
            btn.innerHTML = `<i class="bi bi-geo-alt"></i> GPSè½¬åœ°å€`;
        }
    } catch (error) {
        console.error('è·å–GPSç»Ÿè®¡å¤±è´¥:', error);
    }
}

// é¡µé¢åŠ è½½æ—¶æ›´æ–°æŒ‰é’®çŠ¶æ€
document.addEventListener('DOMContentLoaded', updateGpsButton);
```

## ğŸ”„ **å¤„ç†æµç¨‹**

### **GPSè½¬åœ°å€è½¬æ¢æµç¨‹**
```
ç”¨æˆ·ç‚¹å‡»å¯¼èˆªæ "GPSè½¬åœ°å€"æŒ‰é’®
    â†“
ç­›é€‰æœ‰GPSæ— åœ°å€çš„ç…§ç‰‡
    â†“
åˆ†ç»„å¤„ç†ï¼ˆæ§åˆ¶APIè°ƒç”¨é¢‘ç‡ï¼‰
    â†“
è°ƒç”¨åœ°å›¾APIè·å–åœ°å€
    â†“
æ›´æ–°æ•°æ®åº“ + æ˜¾ç¤ºè¿›åº¦
    â†“
å®Œæˆæç¤º
```

### **å•å¼ è½¬æ¢æµç¨‹**
```
ç”¨æˆ·ç‚¹å‡»ç…§ç‰‡çš„"è§£æåœ°å€"æŒ‰é’®
    â†“
æ£€æŸ¥GPSåæ ‡æ˜¯å¦å­˜åœ¨
    â†“
è°ƒç”¨åœ°å›¾APIï¼ˆå¸¦ç¼“å­˜ï¼‰
    â†“
æ›´æ–°ç…§ç‰‡åœ°å€æ˜¾ç¤º
    â†“
ä¿å­˜åˆ°æ•°æ®åº“
```

## ğŸ’¡ **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**

### **æ™ºèƒ½æç¤º**
```javascript
// åœ¨æŒ‰é’®hoveræ—¶æ˜¾ç¤ºæç¤º
gpsButton.title = "å°†ç…§ç‰‡GPSåæ ‡è½¬æ¢ä¸ºå…·ä½“åœ°å€\nåªæœ‰å¼€å¯GPSå®šä½æ‹æ‘„çš„ç…§ç‰‡æ‰æœ‰æ•ˆ";

// æˆ–è€…æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
const gpsCount = await fetch('/api/photos/stats/gps-count');
gpsButton.innerHTML = `ğŸ”„ GPSè½¬åœ°å€ (${gpsCount.hasGpsNoAddress}å¼ å¯ç”¨)`;
```

### **çŠ¶æ€åé¦ˆ**
- ğŸ“Š **è¿›åº¦æ¡**: æ‰¹é‡è½¬æ¢æ—¶æ˜¾ç¤ºè¿›åº¦
- ğŸ”” **é€šçŸ¥**: è½¬æ¢å®Œæˆçš„é€šçŸ¥
- ğŸ”„ **çŠ¶æ€æŒ‡ç¤º**: è½¬æ¢ä¸­çš„loadingçŠ¶æ€
- âŒ **é”™è¯¯å¤„ç†**: APIè°ƒç”¨å¤±è´¥æ—¶çš„å‹å¥½æç¤º

## ğŸ“‹ **å¼€å‘è®¡åˆ’**

### **é˜¶æ®µä¸€ï¼šæ ¸å¿ƒæœåŠ¡å¼€å‘ (1-2å¤©)**

#### **1.1 åœ°å›¾æœåŠ¡æ¨¡å—**
- **æ–°å»ºæ–‡ä»¶**: `app/services/map_service.py`
- **å®ç°ç±»**: `AMapService` - é«˜å¾·APIå°è£…
- **æ ¸å¿ƒæ–¹æ³•**:
  - `reverse_geocode()` - GPSè½¬åœ°å€
  - `batch_reverse_geocode()` - æ‰¹é‡å¤„ç†
- **ä¾èµ–**: `requests`, `logging`

#### **1.2 ç¼“å­˜æœåŠ¡æ¨¡å—**
- **æ–°å»ºæ–‡ä»¶**: `app/services/map_cache_service.py`
- **å®ç°ç±»**: `MapCacheService` - åœ°å€ç¼“å­˜
- **åŠŸèƒ½**: å†…å­˜/Redisç¼“å­˜ï¼Œé¿å…é‡å¤APIè°ƒç”¨
- **é…ç½®**: å¯é…ç½®ç¼“å­˜æ—¶é—´å’Œå¯ç”¨çŠ¶æ€

#### **1.3 é…ç½®ç®¡ç†**
- **ä¿®æ”¹æ–‡ä»¶**: `app/core/config.py`
- **æ·»åŠ é…ç½®ç±»**: `MapSettings`
- **é…ç½®é¡¹**:
  ```python
  maps: MapSettings = MapSettings(
      provider="amap",
      api_key="",
      timeout=10,
      rate_limit=180,
      cache_enabled=True,
      cache_ttl=86400
  )
  ```

### **é˜¶æ®µäºŒï¼šAPIæ¥å£å¼€å‘ (1å¤©)**

#### **2.1 åœ°å›¾é…ç½®API**
- **æ–‡ä»¶**: `app/api/maps.py` (æ–°å»º)
- **ç«¯ç‚¹**:
  - `GET /api/maps/config` - è·å–é…ç½®
  - `POST /api/maps/config` - æ›´æ–°API Key
  - `POST /api/maps/test-geocode` - æµ‹è¯•API Key

#### **2.2 ç…§ç‰‡GPSè½¬æ¢API**
- **ä¿®æ”¹æ–‡ä»¶**: `app/api/photos.py`
- **æ–°å¢ç«¯ç‚¹**:
  - `GET /api/photos/gps-stats` - è·å–GPSç…§ç‰‡ç»Ÿè®¡
  - `POST /api/photos/{photo_id}/convert-gps-address`
  - `POST /api/photos/batch-convert-gps-address`

#### **2.3 è·¯ç”±æ³¨å†Œ**
- **ä¿®æ”¹æ–‡ä»¶**: `main.py`
- **æ·»åŠ è·¯ç”±**: `app.include_router(maps_router, prefix="/api")`

### **é˜¶æ®µä¸‰ï¼šå‰ç«¯ç•Œé¢å¼€å‘ (1-2å¤©)**

#### **3.1 API Keyè®¾ç½®é¡µé¢**
- **æ–°å»ºæ–‡ä»¶**: `templates/help_gaode_api_key.html`
- **æ–°å»ºæ–‡ä»¶**: `static/js/help_gaode_api_key.js`
- **åŠŸèƒ½**: API Keyç”³è¯·æ•™ç¨‹ã€é…ç½®è¡¨å•

#### **3.2 ç…§ç‰‡ç•Œé¢å¢å¼º**
- **ä¿®æ”¹æ–‡ä»¶**: `templates/photos.html` (ç…§ç‰‡å¡ç‰‡æ¨¡æ¿)
- **ä¿®æ”¹æ–‡ä»¶**: `static/js/app-photos.js`
- **åŠŸèƒ½**: GPSçŠ¶æ€æ˜¾ç¤ºã€åœ°å€è½¬æ¢æŒ‰é’®

#### **3.3 å¯¼èˆªæ å¢å¼º**
- **ä¿®æ”¹æ–‡ä»¶**: `static/js/app-photos.js`
- **åŠŸèƒ½**: GPSè½¬åœ°å€æŒ‰é’®ã€æŒ‰é’®çŠ¶æ€ç®¡ç†

### **é˜¶æ®µå››ï¼šæµ‹è¯•å’Œä¼˜åŒ– (1å¤©)**

#### **4.1 å•å…ƒæµ‹è¯•**
- **æµ‹è¯•æ–‡ä»¶**: `tests/test_map_service.py`
- **è¦†ç›–**: APIè°ƒç”¨ã€ç¼“å­˜ã€é”™è¯¯å¤„ç†
- **æ¨¡æ‹Ÿ**: Mocké«˜å¾·APIå“åº”

#### **4.2 é›†æˆæµ‹è¯•**
- **æµ‹è¯•åœºæ™¯**:
  - API Keyé…ç½®å’ŒéªŒè¯
  - å•å¼ ç…§ç‰‡GPSè½¬æ¢
  - æ‰¹é‡GPSè½¬æ¢
  - ç¼“å­˜æœºåˆ¶éªŒè¯

#### **4.3 æ€§èƒ½ä¼˜åŒ–**
- **å¹¶å‘æ§åˆ¶**: é¿å…APIè°ƒç”¨é¢‘ç‡è¶…é™
- **é”™è¯¯é‡è¯•**: ç½‘ç»œå¼‚å¸¸æ—¶çš„è‡ªåŠ¨é‡è¯•
- **ç¼“å­˜ä¼˜åŒ–**: æé«˜ç¼“å­˜å‘½ä¸­ç‡

## âš ï¸ **é£é™©è¯„ä¼°ä¸åº”å¯¹**

### **æŠ€æœ¯é£é™©**

#### **1. APIè°ƒç”¨é™åˆ¶**
- **é£é™©**: é«˜å¾·APIæœ‰é¢‘ç‡å’Œé¢åº¦é™åˆ¶
- **åº”å¯¹**:
  - å®ç°è¯·æ±‚é˜Ÿåˆ—å’Œé¢‘ç‡æ§åˆ¶
  - æ·»åŠ é‡è¯•æœºåˆ¶å’Œç†”æ–­å™¨
  - æä¾›ä½¿ç”¨ç»Ÿè®¡å’Œå‰©ä½™é¢åº¦æç¤º

#### **2. ç½‘ç»œå¼‚å¸¸**
- **é£é™©**: APIè°ƒç”¨å¯èƒ½å› ç½‘ç»œé—®é¢˜å¤±è´¥
- **åº”å¯¹**:
  - å®ç°è¶…æ—¶æ§åˆ¶å’Œé‡è¯•é€»è¾‘
  - æä¾›ç¦»çº¿æ¨¡å¼ï¼ˆä½¿ç”¨ç¼“å­˜æ•°æ®ï¼‰
  - ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º

#### **3. åœ°å€ç²¾åº¦é—®é¢˜**
- **é£é™©**: GPSåæ ‡å¯èƒ½å¯¹åº”å¤šä¸ªåœ°å€æˆ–ä¸å‡†ç¡®
- **åº”å¯¹**:
  - æ”¯æŒç”¨æˆ·æ‰‹åŠ¨ç¼–è¾‘åœ°å€
  - æä¾›åœ°å€éªŒè¯æœºåˆ¶
  - å…è®¸å¤šæ¬¡è§£æå°è¯•

### **ä¸šåŠ¡é£é™©**

#### **1. ç”¨æˆ·æ¥å—åº¦**
- **é£é™©**: ç”¨æˆ·ä¸æ„¿æ„é…ç½®API Key
- **åº”å¯¹**:
  - è¯¦ç»†çš„ç”³è¯·æ•™ç¨‹
  - å¼ºè°ƒåŠŸèƒ½ä»·å€¼
  - æä¾›å…è´¹é¢åº¦æé†’

#### **2. è´¹ç”¨æ§åˆ¶**
- **é£é™©**: ç”¨æˆ·APIè°ƒç”¨è´¹ç”¨è¶…é¢„æœŸ
- **åº”å¯¹**:
  - æ˜ç¡®è¯´æ˜å…è´¹é¢åº¦6,000æ¬¡/æœˆ
  - å»ºè®®ç”¨æˆ·è°¨æ…ä½¿ç”¨ï¼Œé¿å…è¿‡åº¦è°ƒç”¨

### **3. éšç§ä¿æŠ¤**
- **é£é™©**: GPSæ•°æ®æ¶‰åŠä½ç½®éšç§
- **åº”å¯¹**:
  - æœ¬åœ°å¤„ç†ï¼Œä¸ä¸Šä¼ GPSæ•°æ®
  - æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·æ•°æ®ä½¿ç”¨æ–¹å¼
  - æä¾›åˆ é™¤/é‡ç½®åŠŸèƒ½

## ğŸ“… **å®æ–½æ—¶é—´è¡¨**

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡æ—¶é—´ | è´Ÿè´£äºº |
|-----|-----|---------|--------|
| **é˜¶æ®µä¸€** | æ ¸å¿ƒæœåŠ¡å¼€å‘ | 2å¤© | åç«¯å¼€å‘ |
| **é˜¶æ®µäºŒ** | APIæ¥å£å¼€å‘ | 1å¤© | åç«¯å¼€å‘ |
| **é˜¶æ®µä¸‰** | å‰ç«¯ç•Œé¢å¼€å‘ | 2å¤© | å‰ç«¯å¼€å‘ |
| **é˜¶æ®µå››** | æµ‹è¯•å’Œä¼˜åŒ– | 1å¤© | æµ‹è¯•å·¥ç¨‹å¸ˆ |
| **æ€»è®¡** | - | **6å¤©** | - |

## ğŸ¯ **éªŒæ”¶æ ‡å‡†**

### **åŠŸèƒ½éªŒæ”¶**
- âœ… èƒ½å¤Ÿé…ç½®é«˜å¾·API Key
- âœ… èƒ½å¤Ÿè§£æå•å¼ ç…§ç‰‡GPSåœ°å€
- âœ… å¯¼èˆªæ GPSè½¬åœ°å€æŒ‰é’®æ­£å¸¸å·¥ä½œ
- âœ… æŒ‰é’®æ˜¾ç¤ºå¾…è½¬æ¢ç…§ç‰‡æ•°é‡
- âœ… åœ°å€ä¿¡æ¯æ­£ç¡®æ˜¾ç¤ºåœ¨ç…§ç‰‡å¡ç‰‡
- âœ… æ”¯æŒåœ°å€ç¼“å­˜å’Œé‡è§£æ

### **æ€§èƒ½éªŒæ”¶**
- âœ… å•å¼ è½¬æ¢å“åº”æ—¶é—´ < 3ç§’
- âœ… æ‰¹é‡è½¬æ¢æ”¯æŒå¤šä¸ªç…§ç‰‡åŒæ—¶å¤„ç†
- âœ… ç¼“å­˜æœºåˆ¶æœ‰æ•ˆå‡å°‘é‡å¤è°ƒç”¨
- âœ… é”™è¯¯å¤„ç†å‹å¥½ï¼Œæ— å´©æºƒ

### **ç”¨æˆ·ä½“éªŒéªŒæ”¶**
- âœ… API Keyé…ç½®æµç¨‹ç®€å•ç›´è§‚
- âœ… åœ°å€è½¬æ¢çŠ¶æ€åé¦ˆæ¸…æ™°
- âœ… é”™è¯¯æç¤ºå‡†ç¡®æ˜“æ‡‚
- âœ… ç§»åŠ¨ç«¯é€‚é…è‰¯å¥½

## ğŸ’¡ **æ€»ç»“**

è¿™ä¸ªGPSè½¬åœ°å€åŠŸèƒ½è®¾è®¡æ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

1. **ç”¨æˆ·å‹å¥½**: è¯¦ç»†çš„ç”³è¯·æ•™ç¨‹å’Œé…ç½®ç•Œé¢
2. **æŠ€æœ¯æˆç†Ÿ**: åŸºäºä¸»æµé«˜å¾·åœ°å›¾API
3. **æ€§èƒ½ä¼˜åŒ–**: ç¼“å­˜å’Œé¢‘ç‡æ§åˆ¶
4. **æˆæœ¬æ§åˆ¶**: å…è´¹é¢åº¦æé†’å’Œä½¿ç”¨ç»Ÿè®¡
5. **æ‰©å±•æ€§å¥½**: æ”¯æŒæœªæ¥å¢åŠ å…¶ä»–åœ°å›¾æœåŠ¡å•†

## ğŸ’¡ **è®¾è®¡ä¼˜åŒ–æ€»ç»“**

### **é£æ ¼ä¸€è‡´æ€§æ”¹è¿›**
- âœ… **å®Œå…¨åŒ¹é…ç°æœ‰ç³»ç»Ÿé£æ ¼**: ä½¿ç”¨ç›¸åŒçš„Bootstrap 5æ¡†æ¶ã€å¯¼èˆªæ ç»“æ„ã€å›¾æ ‡é£æ ¼
- âœ… **ä¿æŒç”¨æˆ·ä½“éªŒä¸€è‡´æ€§**: é‡‡ç”¨ç›¸åŒçš„é¡µé¢å¸ƒå±€ã€æç¤ºæ¡†æ ·å¼ã€äº¤äº’æ–¹å¼
- âœ… **ä»£ç è§„èŒƒç»Ÿä¸€**: ä½¿ç”¨ç›¸åŒçš„JavaScriptç¼–å†™é£æ ¼å’ŒAPIè®¾è®¡æ¨¡å¼

### **å¤æ‚æ€§ç®€åŒ–**
- âœ… **ç§»é™¤ä½¿ç”¨ç»Ÿè®¡åŠŸèƒ½**: é¿å…å¤æ‚çš„è®¡è´¹ç»Ÿè®¡é€»è¾‘
- âœ… **ç§»é™¤æ‰¹é‡æ“ä½œä¸‹æ‹‰èœå•**: æ”¹ä¸ºç›´æ¥çš„GPSè½¬åœ°å€æŒ‰é’®
- âœ… **ç®€åŒ–è´¹ç”¨æ§åˆ¶**: åªæä¾›åŸºæœ¬çš„å…è´¹é¢åº¦æé†’
- âœ… **ä¿æŒæ ¸å¿ƒåŠŸèƒ½**: ä¸“æ³¨GPSè½¬åœ°å€çš„æ ¸å¿ƒéœ€æ±‚

### **æŠ€æœ¯æ–¹æ¡ˆä¼˜åŒ–**
- âœ… **ç¼“å­˜æœºåˆ¶ä¿ç•™**: æœ‰æ•ˆå‡å°‘APIè°ƒç”¨ï¼Œé™ä½æˆæœ¬
- âœ… **é”™è¯¯å¤„ç†å®Œå–„**: æä¾›å‹å¥½çš„ç”¨æˆ·æç¤º
- âœ… **æ€§èƒ½ä¼˜åŒ–**: æ”¯æŒæ‰¹é‡å¤„ç†å’Œå¼‚æ­¥æ“ä½œ

## ğŸ‰ **å¯¼èˆªæ è®¾è®¡ä¼˜åŒ–å®Œæˆï¼**

### **æœ€æ–°æ›´æ–°**
- âœ… **ç§»é™¤æ‰¹é‡æ“ä½œä¸‹æ‹‰èœå•**: æ”¹ä¸ºç®€æ´çš„GPSè½¬åœ°å€æŒ‰é’®
- âœ… **æ™ºèƒ½æŒ‰é’®çŠ¶æ€**: æ˜¾ç¤ºå¾…è½¬æ¢ç…§ç‰‡æ•°é‡ï¼Œç©ºé—²æ—¶å˜ç°
- âœ… **ä¸€é”®æ‰¹é‡è½¬æ¢**: ç›´æ¥ç‚¹å‡»å³å¯å¤„ç†æ‰€æœ‰æœ‰GPSçš„ç…§ç‰‡
- âœ… **ä¿æŒç®€æ´ç•Œé¢**: ä¸å¢åŠ å¯¼èˆªæ çš„è§†è§‰å¤æ‚åº¦

### **ç”¨æˆ·ä½“éªŒæå‡**
1. **ç›´è§‚æ“ä½œ**: çœ‹åˆ°æŒ‰é’®å°±çŸ¥é“å¯ä»¥è½¬æ¢GPSåœ°å€
2. **çŠ¶æ€åé¦ˆ**: æŒ‰é’®æ˜¾ç¤ºå…·ä½“æ•°é‡ï¼Œç”¨æˆ·æ¸…æ¥šçŸ¥é“è¦å¤„ç†å¤šå°‘ç…§ç‰‡
3. **å³æ—¶å“åº”**: ç‚¹å‡»åç«‹å³å¼€å§‹è½¬æ¢ï¼Œæ— éœ€å¤šæ­¥æ“ä½œ
4. **è§†è§‰ç»Ÿä¸€**: ä¸ç³»ç»Ÿå…¶ä»–æŒ‰é’®ä¿æŒä¸€è‡´çš„æ ·å¼

**ç°åœ¨è¿™ä¸ªæ–¹æ¡ˆæ›´åŠ ç®€æ´é«˜æ•ˆï¼Œç”¨æˆ·ä½¿ç”¨èµ·æ¥ä¼šæ›´åŠ é¡ºç•…ï¼** ğŸš€ğŸ“

æ‚¨è§‰å¾—è¿™ä¸ªå¯¼èˆªæ è®¾è®¡å¦‚ä½•ï¼Ÿæˆ‘ä»¬å¯ä»¥å¼€å§‹å¼€å‘äº†å—ï¼Ÿ ğŸ¤”âœ¨