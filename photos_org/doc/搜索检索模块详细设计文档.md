# å®¶åº­ç‰ˆæ™ºèƒ½ç…§ç‰‡ç³»ç»Ÿ - æœç´¢æ£€ç´¢æ¨¡å—è¯¦ç»†è®¾è®¡æ–‡æ¡£

## ä¸€ã€æ–‡æ¡£åŸºç¡€ä¿¡æ¯

| é¡¹ç›®åç§° | å®¶åº­ç‰ˆæ™ºèƒ½ç…§ç‰‡ç³»ç»Ÿ | æ–‡æ¡£ç±»å‹ | æœç´¢æ£€ç´¢æ¨¡å—è¯¦ç»†è®¾è®¡æ–‡æ¡£ |
| -------- | ------------------------- | -------- | ----------------------- |
| æ–‡æ¡£ç‰ˆæœ¬ | V2.4 | æ–‡æ¡£çŠ¶æ€ | â˜‘ å·²åŒæ­¥æœ€æ–°å®ç° â–¡ è¯„å®¡ä¸­ â–¡ å·²ç¡®è®¤ â–¡ å·²å½’æ¡£ |
| ç¼–å†™äºº | AIåŠ©æ‰‹ | ç¼–å†™æ—¥æœŸ | 2025å¹´9æœˆ9æ—¥ |
| æ›´æ–°æ—¥æœŸ | 2025å¹´9æœˆ28æ—¥ | æ›´æ–°å†…å®¹ | ä¼˜åŒ–å¤§è§„æ¨¡æ ‡ç­¾ç­›é€‰åŠŸèƒ½ï¼Œå®ç°åç«¯æœç´¢é©±åŠ¨å’Œçƒ­é—¨æ ‡ç­¾ä¼˜å…ˆç­–ç•¥ |
| å…³è”æ–‡æ¡£ | ã€Šå®¶åº­ç‰ˆç®€è¦è®¾è®¡æ–‡æ¡£ã€‹ã€Šæ•°æ®åº“è®¾è®¡æ–‡æ¡£ã€‹ã€Šæ™ºèƒ½åˆ†ææ¨¡å—è¯¦ç»†è®¾è®¡æ–‡æ¡£ã€‹ | | |

## äºŒã€æ¨¡å—æ¦‚è¿°

### 2.1 æ¨¡å—ç›®æ ‡

æœç´¢æ£€ç´¢æ¨¡å—æ˜¯å®¶åº­ç…§ç‰‡ç³»ç»Ÿçš„æ ¸å¿ƒäº¤äº’æ¨¡å—ï¼Œè´Ÿè´£ä¸ºç”¨æˆ·æä¾›å¤šç»´åº¦ã€æ™ºèƒ½åŒ–çš„ç…§ç‰‡æœç´¢å’Œæ£€ç´¢åŠŸèƒ½ã€‚é€šè¿‡æ•´åˆæ•°æ®åº“ä¸­çš„ä¸°å¯Œå…ƒæ•°æ®ï¼Œæ”¯æŒå…³é”®è¯æœç´¢ã€æ¡ä»¶ç­›é€‰ã€æ™ºèƒ½æ¨èç­‰å¤šç§æœç´¢æ–¹å¼ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿæ‰¾åˆ°æ‰€éœ€çš„ç…§ç‰‡ã€‚

### 2.2 å®ç°çŠ¶æ€

#### 2.2.1 å·²å®ç°åŠŸèƒ½ï¼ˆç…§ç‰‡åº“é¡µé¢ï¼‰
- **åŸºç¡€æœç´¢åŠŸèƒ½**ï¼šå…³é”®è¯æœç´¢ã€æœç´¢ç±»å‹é€‰æ‹©ã€æœç´¢å»ºè®®
- **FTSå…¨æ–‡æœç´¢**ï¼šåŸºäºSQLite FTS5çš„é«˜æ•ˆå…¨æ–‡æœç´¢ï¼Œæ”¯æŒä¸­æ–‡åˆ†è¯å’Œå¤æ‚æŸ¥è¯¢
- **å¢å¼ºç›¸ä¼¼åº¦æœç´¢**ï¼šå¤šç®—æ³•èåˆçš„ç›¸ä¼¼ç…§ç‰‡æ£€æµ‹ï¼ˆæ„ŸçŸ¥å“ˆå¸Œã€é¢œè‰²ç›´æ–¹å›¾ã€ç»“æ„ç›¸ä¼¼ç­‰ï¼‰
- **æ¡ä»¶ç­›é€‰**ï¼šæ—¥æœŸç­›é€‰ã€è´¨é‡ç­›é€‰ã€æ’åºåŠŸèƒ½ã€æ ‡ç­¾åˆ†ç±»ç­›é€‰
- **æ™ºèƒ½æ ‡ç­¾ç­›é€‰**ï¼šåç«¯æœç´¢é©±åŠ¨ã€çƒ­é—¨æ ‡ç­¾ä¼˜å…ˆã€çªç ´æ•°é‡é™åˆ¶
- **æœç´¢API**ï¼šå®Œæ•´çš„æœç´¢æ¥å£å’Œå‚æ•°æ”¯æŒï¼ˆ10ä¸ªæ¥å£ï¼‰
- **æ™ºèƒ½æœç´¢å»ºè®®**ï¼šåŸºäºçƒ­é—¨æ ‡ç­¾å’Œåˆ†ç±»çš„å®æ—¶æœç´¢å»ºè®®
- **ç”¨æˆ·ç•Œé¢ä¼˜åŒ–**ï¼šæœç´¢è¯­æ³•æç¤ºã€ç”¨æˆ·æŒ‡å¯¼ã€æ··åˆè®¾å¤‡äº¤äº’æ”¯æŒ

#### 2.2.2 å·²åˆ é™¤åŠŸèƒ½ï¼ˆé«˜çº§æœç´¢é¡µé¢ï¼‰
- **é«˜çº§æœç´¢é¡µé¢**ï¼šå·²å®Œå…¨åˆ é™¤ï¼Œç®€åŒ–ç³»ç»Ÿæ¶æ„
- **æ™ºèƒ½æ¨è**ï¼šå·²åˆ é™¤ï¼Œç®€åŒ–ç”¨æˆ·ä½“éªŒ
- **æœç´¢å†å²ç®¡ç†**ï¼šå·²åˆ é™¤ï¼Œå‡å°‘ç³»ç»Ÿå¤æ‚åº¦
- **ä¿å­˜æœç´¢æ¡ä»¶**ï¼šå·²åˆ é™¤ï¼Œç®€åŒ–æ“ä½œæµç¨‹

#### 2.2.3 åŠŸèƒ½è¿ç§»è¯´æ˜
- **ç›¸ä¼¼ç…§ç‰‡æœç´¢**ï¼šå·²é›†æˆåˆ°å›¾ç‰‡æ‚¬åœåŠŸèƒ½ä¸­ï¼Œæä¾›æ›´ç›´è§‚çš„ç›¸ä¼¼ç…§ç‰‡å‘ç°ä½“éªŒ

#### 2.2.4 åŠŸèƒ½ç®€åŒ–è¯´æ˜
ä¸ºäº†ç®€åŒ–ç³»ç»Ÿæ¶æ„å’Œæå‡ç”¨æˆ·ä½“éªŒï¼Œå·²åˆ é™¤é«˜çº§æœç´¢é¡µé¢çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå°†æœç´¢åŠŸèƒ½é›†ä¸­åœ¨ç…§ç‰‡åº“é¡µé¢ï¼Œæä¾›æ›´ç›´è§‚ã€æ›´ç®€å•çš„æœç´¢ä½“éªŒã€‚ç›¸ä¼¼ç…§ç‰‡æœç´¢åŠŸèƒ½å·²é›†æˆåˆ°å›¾ç‰‡æ‚¬åœåŠŸèƒ½ä¸­ï¼Œæä¾›æ›´ä¾¿æ·çš„ç›¸ä¼¼ç…§ç‰‡å‘ç°æ–¹å¼ã€‚

### 2.3 è®¾è®¡åŸåˆ™

- **ç®€å•æ˜“ç”¨**ï¼šæœç´¢ç•Œé¢ç®€æ´ç›´è§‚ï¼Œæ“ä½œç®€å•
- **å“åº”å¿«é€Ÿ**ï¼šæœç´¢å“åº”æ—¶é—´ â‰¤ 2ç§’
- **ç»“æœå‡†ç¡®**ï¼šæœç´¢å‡†ç¡®ç‡ â‰¥ 90%
- **åŠŸèƒ½é›†ä¸­**ï¼šæ‰€æœ‰æœç´¢åŠŸèƒ½é›†ä¸­åœ¨ç…§ç‰‡åº“é¡µé¢
- **å®¶åº­ä¼˜åŒ–**ï¼šå•ç”¨æˆ·å®¶åº­ä½¿ç”¨ï¼Œç®€åŒ–æœç´¢ä½“éªŒ
- **æ¶æ„ç®€åŒ–**ï¼šåˆ é™¤å¤æ‚åŠŸèƒ½ï¼Œä¸“æ³¨äºæ ¸å¿ƒæœç´¢éœ€æ±‚

### 2.4 æŠ€æœ¯é€‰å‹

- **å…¨æ–‡æœç´¢**ï¼šSQLite FTS5
- **ç´¢å¼•ä¼˜åŒ–**ï¼šå¤åˆç´¢å¼•ã€è¦†ç›–ç´¢å¼•
- **æœç´¢ç®—æ³•**ï¼šæ¨¡ç³ŠåŒ¹é…ã€ç›¸ä¼¼åº¦è®¡ç®—
- **å‰ç«¯æŠ€æœ¯**ï¼šHTML5 + CSS3 + JavaScript
- **åç«¯æ¡†æ¶**ï¼šFastAPI + SQLAlchemy

## ä¸‰ã€æœç´¢éœ€æ±‚åˆ†æ

### 3.1 ç”¨æˆ·æœç´¢åœºæ™¯

åŸºäºå®¶åº­ç…§ç‰‡çš„ç‰¹ç‚¹ï¼Œç”¨æˆ·çš„ä¸»è¦æœç´¢åœºæ™¯åŒ…æ‹¬ï¼š

#### 3.1.1 æ—¶é—´ç›¸å…³æœç´¢
- **å…·ä½“æ—¶é—´**ï¼š"2023å¹´12æœˆçš„ç…§ç‰‡"
- **ç›¸å¯¹æ—¶é—´**ï¼š"æœ€è¿‘ä¸€å‘¨çš„ç…§ç‰‡"
- **å­£èŠ‚æœç´¢**ï¼š"å¤å¤©çš„ç…§ç‰‡"
- **èŠ‚æ—¥æœç´¢**ï¼š"æ˜¥èŠ‚çš„ç…§ç‰‡"

#### 3.1.2 å†…å®¹ç›¸å…³æœç´¢
- **äººç‰©æœç´¢**ï¼š"æœ‰äººçš„ç…§ç‰‡"ã€"å…¨å®¶ç¦"
- **åœºæ™¯æœç´¢**ï¼š"å®¤å†…ç…§ç‰‡"ã€"é£æ™¯ç…§ç‰‡"
- **æ´»åŠ¨æœç´¢**ï¼š"èšä¼šç…§ç‰‡"ã€"æ—…è¡Œç…§ç‰‡"
- **ç‰©ä½“æœç´¢**ï¼š"é£Ÿç‰©ç…§ç‰‡"ã€"å® ç‰©ç…§ç‰‡"

#### 3.1.3 è´¨é‡ç›¸å…³æœç´¢
- **è´¨é‡ç­›é€‰**ï¼š"æœ€æ¸…æ™°çš„ç…§ç‰‡"ã€"æ¨¡ç³Šçš„ç…§ç‰‡"
- **è¯„åˆ†æœç´¢**ï¼š"è´¨é‡è¯„åˆ†80åˆ†ä»¥ä¸Šçš„ç…§ç‰‡"
- **é—®é¢˜æœç´¢**ï¼š"æœ‰æŠ€æœ¯é—®é¢˜çš„ç…§ç‰‡"

#### 3.1.4 è®¾å¤‡ç›¸å…³æœç´¢
- **è®¾å¤‡ç±»å‹**ï¼š"ç”¨iPhoneæ‹çš„ç…§ç‰‡"
- **ç›¸æœºå“ç‰Œ**ï¼š"ç”¨ä½³èƒ½æ‹çš„ç…§ç‰‡"
- **æŠ€æœ¯å‚æ•°**ï¼š"å¤§å…‰åœˆç…§ç‰‡"ã€"é«˜ISOç…§ç‰‡"

#### 3.1.5 ä½ç½®ç›¸å…³æœç´¢
- **åœ°ç‚¹åç§°**ï¼š"åœ¨å®¶æ‹çš„ç…§ç‰‡"ã€"æ—…è¡Œç…§ç‰‡"
- **GPSä½ç½®**ï¼š"åœ¨æŸä¸ªåŒºåŸŸæ‹çš„ç…§ç‰‡"

### 3.2 æœç´¢æ–¹å¼éœ€æ±‚

#### 3.2.1 å…³é”®è¯æœç´¢
- æ”¯æŒä¸­æ–‡å…³é”®è¯æœç´¢
- æ”¯æŒæ¨¡ç³ŠåŒ¹é…å’Œéƒ¨åˆ†åŒ¹é…
- æ”¯æŒå¤šå…³é”®è¯ç»„åˆæœç´¢
- æ”¯æŒæ’é™¤å…³é”®è¯æœç´¢

#### 3.2.2 æ¡ä»¶ç­›é€‰
- æ—¶é—´èŒƒå›´ç­›é€‰
- è´¨é‡è¯„åˆ†ç­›é€‰
- åˆ†ç±»æ ‡ç­¾ç­›é€‰
- è®¾å¤‡ç±»å‹ç­›é€‰
- æ–‡ä»¶å±æ€§ç­›é€‰

#### 3.2.3 é«˜çº§æœç´¢
- å¤šæ¡ä»¶ç»„åˆæœç´¢
- å¤æ‚é€»è¾‘è¡¨è¾¾å¼
- ä¿å­˜æœç´¢æ¡ä»¶
- æœç´¢å†å²ç®¡ç†

## å››ã€æ•°æ®åº“å­—æ®µåˆ†æ

### 4.1 å¯æœç´¢å­—æ®µåˆ†ç±»

#### 4.1.1 åŸºç¡€ä¿¡æ¯å­—æ®µï¼ˆé«˜å¯ç”¨æ€§ï¼‰
```sql
-- æ–‡ä»¶åŸºç¡€ä¿¡æ¯ï¼ˆ100%å¯ç”¨ï¼‰
filename, file_size, width, height, format, file_hash
created_at, updated_at, status, import_source

-- å›¾åƒåŸºç¡€ä¿¡æ¯ï¼ˆ100%å¯ç”¨ï¼‰
width, height, format, file_size
```

#### 4.1.2 æ—¶é—´ç›¸å…³å­—æ®µï¼ˆä¸­ç­‰å¯ç”¨æ€§ï¼‰
```sql
-- æ‹æ‘„æ—¶é—´ï¼ˆçº¦60%å¯ç”¨ï¼Œå–å†³äºEXIFæ•°æ®ï¼‰
taken_at

-- ç³»ç»Ÿæ—¶é—´ï¼ˆ100%å¯ç”¨ï¼‰
created_at, updated_at
```

#### 4.1.3 è®¾å¤‡ä¿¡æ¯å­—æ®µï¼ˆä½å¯ç”¨æ€§ï¼‰
```sql
-- ç›¸æœºä¿¡æ¯ï¼ˆçº¦30%å¯ç”¨ï¼Œå–å†³äºEXIFæ•°æ®ï¼‰
camera_make, camera_model, lens_model
focal_length, aperture, shutter_speed, iso
flash, white_balance, exposure_mode, metering_mode, orientation
```

#### 4.1.4 ä½ç½®ä¿¡æ¯å­—æ®µï¼ˆä½å¯ç”¨æ€§ï¼‰
```sql
-- GPSä¿¡æ¯ï¼ˆçº¦20%å¯ç”¨ï¼Œå–å†³äºEXIFæ•°æ®ï¼‰
location_lat, location_lng, location_alt, location_name
```

#### 4.1.5 è´¨é‡è¯„ä¼°å­—æ®µï¼ˆé«˜å¯ç”¨æ€§ï¼‰
```sql
-- è´¨é‡è¯„åˆ†ï¼ˆ100%å¯ç”¨ï¼Œé€šè¿‡OpenCVåˆ†æï¼‰
quality_score, sharpness_score, brightness_score, contrast_score
color_score, composition_score, quality_level, technical_issues
```

#### 4.1.6 AIåˆ†æå­—æ®µï¼ˆä¸­ç­‰å¯ç”¨æ€§ï¼‰
```sql
-- AIåˆ†æç»“æœï¼ˆçº¦80%å¯ç”¨ï¼Œå–å†³äºAIåˆ†æå®Œæˆæƒ…å†µï¼‰
description, scene_type, objects, people_count, emotion
activity, time_period, location_type, confidence_score
```

#### 4.1.7 æ ‡ç­¾åˆ†ç±»å­—æ®µï¼ˆä¸­ç­‰å¯ç”¨æ€§ï¼‰
```sql
-- æ ‡ç­¾ä¿¡æ¯ï¼ˆé€šè¿‡å…³è”è¡¨ï¼Œçº¦70%å¯ç”¨ï¼‰
tags.name, tags.description

-- åˆ†ç±»ä¿¡æ¯ï¼ˆé€šè¿‡å…³è”è¡¨ï¼Œçº¦70%å¯ç”¨ï¼‰
categories.name, categories.description
```

### 4.2 æœç´¢ä¼˜å…ˆçº§è®¾è®¡

#### 4.2.1 é«˜ä¼˜å…ˆçº§æœç´¢å­—æ®µ
- **åŸºç¡€ä¿¡æ¯**ï¼šfilename, created_at, taken_at
- **è´¨é‡è¯„åˆ†**ï¼šquality_score, quality_level
- **AIåˆ†æ**ï¼šdescription, scene_type, objects
- **æ ‡ç­¾åˆ†ç±»**ï¼štags, categories

#### 4.2.2 ä¸­ä¼˜å…ˆçº§æœç´¢å­—æ®µ
- **è®¾å¤‡ä¿¡æ¯**ï¼šcamera_make, camera_model
- **ä½ç½®ä¿¡æ¯**ï¼šlocation_name
- **æŠ€æœ¯å‚æ•°**ï¼šfocal_length, aperture, iso

#### 4.2.3 ä½ä¼˜å…ˆçº§æœç´¢å­—æ®µ
- **è¯¦ç»†æŠ€æœ¯å‚æ•°**ï¼šshutter_speed, white_balanceç­‰
- **GPSåæ ‡**ï¼šlocation_lat, location_lng

## äº”ã€æœç´¢åŠŸèƒ½è®¾è®¡

### 5.1 å·²å®ç°åŠŸèƒ½ï¼ˆç…§ç‰‡åº“é¡µé¢ï¼‰

#### 5.1.1 åŸºç¡€æœç´¢åŠŸèƒ½ï¼ˆå·²å®ç°ï¼‰
**å…³é”®è¯æœç´¢**ï¼š
- æ”¯æŒå¤šç§æœç´¢ç±»å‹ï¼šå…¨éƒ¨å†…å®¹ã€æ–‡ä»¶åã€ç”¨æˆ·æè¿°ã€AIåˆ†æç»“æœ
- å®æ—¶æœç´¢å»ºè®®ï¼šåŸºäºçƒ­é—¨æ ‡ç­¾å’Œåˆ†ç±»ï¼ˆé€šè¿‡ä¸‹æ‹‰é€‰æ‹©ï¼‰
- æœç´¢èŒƒå›´æç¤ºï¼šåŠ¨æ€æ˜¾ç¤ºå½“å‰æœç´¢ç±»å‹çš„èŒƒå›´è¯´æ˜

**å®ç°ä»£ç **ï¼š
```html
<!-- å®é™…çš„å‰ç«¯HTMLå®ç° -->
<select class="form-select" id="searchType" style="max-width: 100px;" title="é€‰æ‹©æœç´¢èŒƒå›´">
    <option value="all">å…¨éƒ¨å†…å®¹</option>
    <option value="filename">æ–‡ä»¶å</option>
    <option value="description">ç”¨æˆ·æè¿°</option>
    <option value="ai_analysis">AIåˆ†æç»“æœ</option>
</select>
```

```javascript
// æœç´¢å¤„ç†å‡½æ•°ï¼ˆå·²å®ç°ï¼‰
function handleSearch() {
    const keyword = elements.searchInput.value.trim();
    AppState.searchFilters.keyword = keyword;
    AppState.currentPage = 1;
    loadPhotos(1);
    updateFilterStatus();
}
```

#### 5.1.2 æ¡ä»¶ç­›é€‰åŠŸèƒ½ï¼ˆå·²å®ç°ï¼‰
**æ—¥æœŸç­›é€‰**ï¼š
- é¢„è®¾æ—¶é—´èŒƒå›´ï¼šä»Šå¤©ã€æœ¬å‘¨ã€æœ¬æœˆã€ä»Šå¹´
- è‡ªå®šä¹‰æ—¥æœŸèŒƒå›´ï¼šå¼€å§‹æ—¥æœŸå’Œç»“æŸæ—¥æœŸé€‰æ‹©
- ç›¸å¯¹æ—¶é—´ç­›é€‰ï¼šæœ€è¿‘ä¸€å‘¨ã€ä¸Šä¸ªæœˆç­‰

**è´¨é‡ç­›é€‰**ï¼š
- è´¨é‡ç­‰çº§ç­›é€‰ï¼šä¼˜ç§€ã€è‰¯å¥½ã€ä¸€èˆ¬ã€è¾ƒå·®
- è´¨é‡è¯„åˆ†èŒƒå›´ï¼šæ”¯æŒæœ€å°å€¼å’Œæœ€å¤§å€¼è®¾ç½®

**æ’åºåŠŸèƒ½**ï¼š
- å¤šç§æ’åºæ–¹å¼ï¼šç›¸å…³æ€§ã€æ—¶é—´ã€è´¨é‡ã€æ–‡ä»¶å
- æ’åºé¡ºåºï¼šå‡åºã€é™åº

#### 5.1.3 æœç´¢APIæ¥å£ï¼ˆå·²å®ç°ï¼‰
**åŸºç¡€ç…§ç‰‡è·å–æ¥å£**ï¼š
```python
@router.get("/", response_model=Dict[str, Any])
async def get_photos(
    skip: int = Query(0, ge=0, description="è·³è¿‡çš„è®°å½•æ•°"),
    limit: int = Query(50, ge=1, le=1000, description="è¿”å›çš„è®°å½•æ•°"),
    search: Optional[str] = Query(None, description="æœç´¢å…³é”®è¯"),
    sort_by: str = Query("created_at", description="æ’åºå­—æ®µ"),
    sort_order: str = Query("desc", description="æ’åºé¡ºåº"),
    filters: Optional[str] = Query(None, description="ç­›é€‰æ¡ä»¶JSONå­—ç¬¦ä¸²"),
    db: Session = Depends(get_db)
):
    """
    è·å–ç…§ç‰‡åˆ—è¡¨ï¼ˆæ”¯æŒæœç´¢å’Œç­›é€‰ï¼‰
    """
```

**ç»¼åˆæœç´¢æœåŠ¡æ¥å£**ï¼š
```python
# SearchService.search_photos æ–¹æ³•ï¼ˆå®é™…æœç´¢é€»è¾‘ï¼‰
def search_photos(
    self,
    db: Session,
    keyword: Optional[str] = None,
    search_type: str = "all",
    camera_make: Optional[str] = None,
    camera_model: Optional[str] = None,
    date_from: Optional[date] = None,
    date_to: Optional[date] = None,
    quality_min: Optional[float] = None,
    quality_level: Optional[str] = None,
    tags: Optional[List[str]] = None,
    categories: Optional[List[str]] = None,
    tag_ids: Optional[List[int]] = None,
    category_ids: Optional[List[int]] = None,
    location_lat: Optional[float] = None,
    location_lng: Optional[float] = None,
    location_radius: Optional[float] = None,
    sort_by: str = "taken_at",
    sort_order: str = "desc",
    limit: int = 50,
    offset: int = 0
) -> Tuple[List[Dict[str, Any]], int]:
    """ç»¼åˆæœç´¢ç…§ç‰‡ï¼ˆå·²å®ç°ï¼‰"""
```

### 5.2 å·²åˆ é™¤åŠŸèƒ½ï¼ˆé«˜çº§æœç´¢é¡µé¢ï¼‰

#### 5.2.1 åˆ é™¤åŸå› 
ä¸ºäº†ç®€åŒ–ç³»ç»Ÿæ¶æ„å’Œæå‡ç”¨æˆ·ä½“éªŒï¼Œå·²åˆ é™¤ä»¥ä¸‹é«˜çº§æœç´¢åŠŸèƒ½ï¼š

**åˆ é™¤çš„åŠŸèƒ½**ï¼š
- **é«˜çº§æœç´¢ç•Œé¢**ï¼šå¤šæ¡ä»¶ç»„åˆæœç´¢ã€å¤æ‚é€»è¾‘è¡¨è¾¾å¼
- **æ™ºèƒ½æ¨è**ï¼šåŸºäºå†…å®¹ç›¸ä¼¼åº¦çš„ç…§ç‰‡æ¨è
- **æœç´¢å†å²ç®¡ç†**ï¼šæœç´¢è®°å½•ä¿å­˜å’Œç®¡ç†
- **ä¿å­˜æœç´¢æ¡ä»¶**ï¼šä¿å­˜å’Œé‡ç”¨å¤æ‚æœç´¢æ¡ä»¶
- **æœç´¢ç»“æœå¤„ç†**ï¼šæ‰¹é‡æ“ä½œã€ä¸ªæ€§åŒ–ç¼–è¾‘

**åŠŸèƒ½è¿ç§»**ï¼š
- **ç›¸ä¼¼ç…§ç‰‡æœç´¢**ï¼šå·²é›†æˆåˆ°å›¾ç‰‡æ‚¬åœåŠŸèƒ½ä¸­ï¼Œæä¾›æ›´ç›´è§‚çš„ç›¸ä¼¼ç…§ç‰‡å‘ç°ä½“éªŒ

#### 5.2.2 åŠŸèƒ½ç®€åŒ–è¯´æ˜
**ç®€åŒ–åŸåˆ™**ï¼š
- **ä¸“æ³¨æ ¸å¿ƒéœ€æ±‚**ï¼šä¸“æ³¨äºåŸºç¡€æœç´¢å’Œç­›é€‰åŠŸèƒ½
- **ç®€åŒ–ç”¨æˆ·ç•Œé¢**ï¼šæ‰€æœ‰æœç´¢åŠŸèƒ½é›†ä¸­åœ¨ç…§ç‰‡åº“é¡µé¢
- **å‡å°‘ç³»ç»Ÿå¤æ‚åº¦**ï¼šåˆ é™¤å¤æ‚çš„é«˜çº§æœç´¢åŠŸèƒ½
- **æå‡ç»´æŠ¤æ€§**ï¼šå‡å°‘ä»£ç é‡ï¼Œé™ä½ç»´æŠ¤æˆæœ¬

**ä¿ç•™çš„æ ¸å¿ƒåŠŸèƒ½**ï¼š
- **åŸºç¡€æœç´¢**ï¼šå…³é”®è¯æœç´¢ã€æœç´¢ç±»å‹é€‰æ‹©
- **æ¡ä»¶ç­›é€‰**ï¼šæ—¥æœŸç­›é€‰ã€è´¨é‡ç­›é€‰ã€æ ‡ç­¾ç­›é€‰ã€åˆ†ç±»ç­›é€‰
- **æœç´¢å»ºè®®**ï¼šåŸºäºçƒ­é—¨æ ‡ç­¾å’Œåˆ†ç±»çš„æœç´¢å»ºè®®
- **æ’åºåŠŸèƒ½**ï¼šå¤šç§æ’åºæ–¹å¼å’Œæ’åºé¡ºåº
- **ç›¸ä¼¼ç…§ç‰‡æœç´¢**ï¼šé›†æˆåˆ°å›¾ç‰‡æ‚¬åœåŠŸèƒ½ä¸­ï¼Œæä¾›ç›´è§‚çš„ç›¸ä¼¼ç…§ç‰‡å‘ç°

### 5.3 æœç´¢ä¼˜åŒ–åŠŸèƒ½

#### 5.3.1 FTSå…¨æ–‡æœç´¢ä¼˜åŒ–ï¼ˆå·²å®ç°ï¼‰

**FTS5åˆ†è¯å™¨é…ç½®**ï¼š
- **åˆ†è¯å™¨**ï¼šä½¿ç”¨SQLite FTS5é»˜è®¤åˆ†è¯å™¨
- **ä¸­æ–‡æ”¯æŒ**ï¼šé€šè¿‡å‰ç¼€æœç´¢å’Œå¤šè¯ANDæœç´¢ä¼˜åŒ–ä¸­æ–‡æœç´¢ä½“éªŒ
- **æ•°æ®åŒæ­¥**ï¼šé€šè¿‡æ•°æ®åº“è§¦å‘å™¨è‡ªåŠ¨ç»´æŠ¤FTSè¡¨æ•°æ®å®Œæ•´æ€§

**FTSæœç´¢è¯­æ³•æ”¯æŒ**ï¼š
- **åŸºç¡€æœç´¢**ï¼š`å…³é”®è¯` - æœç´¢åŒ…å«å…³é”®è¯çš„å†…å®¹
- **çŸ­è¯­æœç´¢**ï¼š`"å®Œæ•´çŸ­è¯­"` - æœç´¢å®Œæ•´çŸ­è¯­
- **å‰ç¼€æœç´¢**ï¼š`å…³é”®è¯*` - æœç´¢ä»¥å…³é”®è¯å¼€å¤´çš„å†…å®¹ï¼ˆç”¨äºä¸­æ–‡åˆ†è¯ä¼˜åŒ–ï¼‰
- **å¤šè¯æœç´¢**ï¼š`è¯1 AND è¯2` - å¤šè¯ANDå…³ç³»æœç´¢
- **é™çº§æœºåˆ¶**ï¼šFTSå¤±è´¥æ—¶è‡ªåŠ¨é™çº§åˆ°LIKEæŸ¥è¯¢
- **ä¸­æ–‡ä¼˜åŒ–**ï¼šé€šè¿‡å‰ç¼€æœç´¢å’Œå¤šè¯ç»„åˆä¼˜åŒ–ä¸­æ–‡æœç´¢

**FTSé™çº§æœºåˆ¶ä¼˜åŒ–**ï¼š
```python
def _apply_keyword_filter(self, query, keyword: str, search_type: str = "all"):
    """åº”ç”¨å…³é”®è¯ç­›é€‰ - ä¼˜åŒ–ç‰ˆæœ¬"""
    if search_type == "all":
        if self._check_fts_table_exists(query.session):
            try:
                # ä¼˜å…ˆä½¿ç”¨FTSæœç´¢
                fts_query = f"SELECT photo_id FROM photos_fts WHERE photos_fts MATCH '{keyword}'"
                result = query.session.execute(text(fts_query)).fetchall()
                photo_ids = [row[0] for row in result]
                
                # å¦‚æœFTSæœ‰ç»“æœï¼Œç›´æ¥è¿”å›
                if photo_ids:
                    query = query.filter(Photo.id.in_(photo_ids))
                    return query
                
                # FTSæ— ç»“æœæ—¶ï¼Œå°è¯•å‰ç¼€æœç´¢
                words = keyword.split()
                if len(words) > 1:
                    prefix_query = " AND ".join([f"{word}*" for word in words])
                    fts_query = f"SELECT photo_id FROM photos_fts WHERE photos_fts MATCH '{prefix_query}'"
                    result = query.session.execute(text(fts_query)).fetchall()
                    photo_ids = [row[0] for row in result]
                    
                    if photo_ids:
                        query = query.filter(Photo.id.in_(photo_ids))
                        return query
                        
            except Exception as e:
                # FTSæœç´¢å¤±è´¥ï¼Œç»§ç»­ä½¿ç”¨LIKEæŸ¥è¯¢
                pass
    
    # é™çº§åˆ°LIKEæŸ¥è¯¢
    if search_type == "all":
        query = query.filter(
            or_(
                Photo.filename.ilike(f"%{keyword}%"),
                Photo.original_path.ilike(f"%{keyword}%"),
                Photo.description.ilike(f"%{keyword}%"),
                Photo.tags.any(PhotoTag.tag.has(Tag.name.ilike(f"%{keyword}%"))),
                Photo.categories.any(PhotoCategory.category.has(Category.name.ilike(f"%{keyword}%"))),
                Photo.analysis_results.any(PhotoAnalysis.analysis_result.ilike(f"%{keyword}%"))
            )
        )
    return query
```

**ç”¨æˆ·ç•Œé¢æŒ‡å¯¼ä¼˜åŒ–**ï¼š
- **æœç´¢è¯­æ³•æç¤º**ï¼šåœ¨æœç´¢æ¡†ä¸‹æ–¹æ˜¾ç¤ºæœç´¢è¯­æ³•è¯´æ˜
- **æœç´¢æŠ€å·§é¢æ¿**ï¼šæä¾›è¯¦ç»†çš„æœç´¢ä½¿ç”¨æŒ‡å—
- **åŠ¨æ€æç¤º**ï¼šæ ¹æ®æœç´¢ç±»å‹æ˜¾ç¤ºç›¸åº”çš„æç¤ºä¿¡æ¯
- **å¸®åŠ©æŒ‰é’®**ï¼šæä¾›æ›´å¤šæœç´¢å¸®åŠ©ä¿¡æ¯

#### 5.3.2 æœç´¢å»ºè®®ï¼ˆå·²å®ç°ï¼‰
**åŸºäºçƒ­é—¨æ•°æ®çš„æœç´¢å»ºè®®**ï¼š
```javascript
// æœç´¢å»ºè®®æ›´æ–°å‡½æ•°ï¼ˆå·²å®ç°ï¼‰
function updateSearchSuggestions(searchType) {
    const suggestionsContainer = elements.searchSuggestions;
    const suggestionsDiv = suggestionsContainer.querySelector('div');
    
    if (searchType === 'tags' && AppState.hotTags.length > 0) {
        // æ˜¾ç¤ºçƒ­é—¨æ ‡ç­¾å»ºè®®
        suggestionsDiv.innerHTML = '';
        AppState.hotTags.slice(0, 8).forEach(tag => {
            const badge = document.createElement('span');
            badge.className = 'badge bg-secondary me-1 mb-1';
            badge.style.cursor = 'pointer';
            badge.textContent = tag.name;
            badge.onclick = () => selectSuggestion(tag.name);
            suggestionsDiv.appendChild(badge);
        });
        suggestionsContainer.style.display = 'block';
    } else if (searchType === 'categories' && AppState.hotCategories.length > 0) {
        // æ˜¾ç¤ºçƒ­é—¨åˆ†ç±»å»ºè®®
        suggestionsDiv.innerHTML = '';
        AppState.hotCategories.slice(0, 8).forEach(category => {
            const badge = document.createElement('span');
            badge.className = 'badge bg-primary me-1 mb-1';
            badge.style.cursor = 'pointer';
            badge.textContent = category.name;
            badge.onclick = () => selectSuggestion(category.name);
            suggestionsDiv.appendChild(badge);
        });
        suggestionsContainer.style.display = 'block';
    } else {
        // éšè—æœç´¢å»ºè®®
        suggestionsContainer.style.display = 'none';
    }
}
```

#### 5.3.3 æ™ºèƒ½æ ‡ç­¾ç­›é€‰ä¼˜åŒ–ï¼ˆå·²å®ç°ï¼‰
**å¤§è§„æ¨¡æ ‡ç­¾ç­›é€‰è§£å†³æ–¹æ¡ˆ**ï¼š

é’ˆå¯¹10000å¼ ç…§ç‰‡ç³»ç»Ÿå¯èƒ½äº§ç”Ÿå‡ åƒä¸ªæ ‡ç­¾çš„é—®é¢˜ï¼Œå®ç°ä»¥ä¸‹ä¼˜åŒ–ç­–ç•¥ï¼š

**çƒ­é—¨æ ‡ç­¾ä¼˜å…ˆç­–ç•¥**ï¼š
- åˆå§‹åŠ è½½50ä¸ªæœ€çƒ­é—¨æ ‡ç­¾ï¼ˆåŸºäºä½¿ç”¨é¢‘ç‡æ’åºï¼‰
- è°ƒç”¨`/api/v1/tags/popular?limit=50`æ¥å£è·å–çƒ­é—¨æ ‡ç­¾
- æå‡å¸¸ç”¨æ ‡ç­¾çš„è®¿é—®é€Ÿåº¦

**åç«¯æœç´¢é©±åŠ¨**ï¼š
- å°†å‰ç«¯æœ¬åœ°è¿‡æ»¤æ”¹ä¸ºè°ƒç”¨åç«¯`/api/v1/tags/?search=å…³é”®è¯&limit=200`æ¥å£
- æœç´¢æ—¶æ— æ•°é‡é™åˆ¶ï¼Œæ”¯æŒæŸ¥æ‰¾æ‰€æœ‰æ ‡ç­¾
- 300msé˜²æŠ–å¤„ç†ï¼Œé¿å…é¢‘ç¹APIè°ƒç”¨

**æ™ºèƒ½å›é€€æœºåˆ¶**ï¼š
```javascript
// æœç´¢å¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°æœ¬åœ°è¿‡æ»¤
try {
    const response = await fetch(searchUrl);
    if (response.ok) {
        const results = await response.json();
        filteredData = results.map(tag => ({id: tag.id, name: tag.name}));
    } else {
        // APIå¤±è´¥ï¼Œå›é€€åˆ°æœ¬åœ°è¿‡æ»¤
        filteredData = data.filter(item =>
            item.name.toLowerCase().includes(searchTerm.toLowerCase())
        );
    }
} catch (error) {
    // ç½‘ç»œå¼‚å¸¸ï¼Œå›é€€åˆ°æœ¬åœ°è¿‡æ»¤
    filteredData = data.filter(item =>
        item.name.toLowerCase().includes(searchTerm.toLowerCase())
    );
}
```

**æ€§èƒ½ä¼˜åŒ–æ•ˆæœ**ï¼š
- **åˆå§‹åŠ è½½**ï¼šä»100ä¸ªæ ‡ç­¾å‡å°‘åˆ°50ä¸ªçƒ­é—¨æ ‡ç­¾ï¼Œæå‡åŠ è½½é€Ÿåº¦
- **æœç´¢èƒ½åŠ›**ï¼šçªç ´å‰ç«¯100ä¸ªæ ‡ç­¾é™åˆ¶ï¼Œæ”¯æŒå…¨åº“æœç´¢
- **å“åº”ä½“éªŒ**ï¼š300msé˜²æŠ– + åç«¯æœç´¢ï¼Œå¹³è¡¡å“åº”é€Ÿåº¦å’Œå‡†ç¡®æ€§
- **å…¼å®¹æ€§**ï¼šå¤šå±‚å›é€€ç¡®ä¿åŠŸèƒ½ç¨³å®šå¯ç”¨

#### 5.3.4 æœç´¢å†å²ï¼ˆå¾…å¼€å‘ï¼‰
**æœç´¢å†å²ç®¡ç†**ï¼š
```python
def get_search_history(user_id: int = None, limit: int = 20) -> List[Dict]:
    """
    æœç´¢å†å²ï¼ˆå¾…å¼€å‘ï¼‰

    :param user_id: ç”¨æˆ·ID
    :param limit: å†å²è®°å½•æ•°é‡é™åˆ¶
    :return: æœç´¢å†å²åˆ—è¡¨
    """
    # ä¿å­˜ç”¨æˆ·æœç´¢è®°å½•
    # æ”¯æŒæœç´¢å†å²ç®¡ç†
    # æ”¯æŒå¿«é€Ÿé‡å¤æœç´¢
```

## å…­ã€æœç´¢ç®—æ³•è®¾è®¡

### 6.1 å…¨æ–‡æœç´¢ç®—æ³•

#### 6.1.1 FTS5é…ç½®
```sql
-- åˆ›å»ºç…§ç‰‡å…¨æ–‡æœç´¢è™šæ‹Ÿè¡¨
CREATE VIRTUAL TABLE photos_fts USING fts5(
    photo_id UNINDEXED,           -- ç…§ç‰‡IDï¼ˆä¸ç´¢å¼•ï¼Œç”¨äºå…³è”ï¼‰
    filename,                     -- æ–‡ä»¶å
    original_path,                -- æ–‡ä»¶è·¯å¾„
    description,                  -- ç”¨æˆ·æè¿°
    tags_content,                 -- æ‰€æœ‰æ ‡ç­¾åç§°ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰
    categories_content,           -- æ‰€æœ‰åˆ†ç±»åç§°ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰
    analysis_content              -- AIåˆ†æç»“æœ
);
```

#### 6.1.2 FTSæœç´¢æŸ¥è¯¢ä¼˜åŒ–
```sql
-- åŸºç¡€å…³é”®è¯æœç´¢
SELECT photo_id FROM photos_fts
WHERE photos_fts MATCH 'å…³é”®è¯'
ORDER BY rank;

-- å¤šè¯æœç´¢ï¼ˆä½¿ç”¨ANDå…³ç³»ï¼‰
SELECT photo_id FROM photos_fts
WHERE photos_fts MATCH 'è¯1 AND è¯2'
ORDER BY rank;

-- å‰ç¼€æœç´¢ï¼ˆå®é™…å®ç°ä¸­ä½¿ç”¨ç©ºæ ¼åˆ†éš”å¤šè¯ï¼‰
SELECT photo_id FROM photos_fts
WHERE photos_fts MATCH '"èŠ±æœµ"*"ç›†æ ½"*'
ORDER BY rank;

-- å­—æ®µç‰¹å®šæœç´¢ï¼ˆå®é™…å®ç°ä¸­ä¸æ”¯æŒå­—æ®µç‰¹å®šæœç´¢ï¼‰
-- ä½¿ç”¨LIKEæŸ¥è¯¢è¿›è¡Œå­—æ®µç‰¹å®šæœç´¢

-- æ’é™¤è¯æœç´¢ï¼ˆå®é™…å®ç°ä¸­ä¸æ”¯æŒï¼‰
-- ä½¿ç”¨LIKEæŸ¥è¯¢è¿›è¡Œæ’é™¤æ“ä½œ
```

#### 6.1.3 FTSä¸LIKEæŸ¥è¯¢é™çº§æœºåˆ¶
```python
def _apply_keyword_filter(self, query, keyword: str, search_type: str = "all"):
    """åº”ç”¨å…³é”®è¯ç­›é€‰"""
    if search_type == "all":
        # æ£€æŸ¥FTSè¡¨æ˜¯å¦å­˜åœ¨
        if self._check_fts_table_exists(query.session):
            try:
                # å…¨éƒ¨å†…å®¹æœç´¢ï¼Œä½¿ç”¨å…¨æ–‡æœç´¢
                fts_query = f"""
                SELECT photo_id
                FROM photos_fts
                WHERE photos_fts MATCH '{keyword}'
                """
                
                # è·å–åŒ¹é…çš„ç…§ç‰‡ID
                result = query.session.execute(text(fts_query)).fetchall()
                photo_ids = [row[0] for row in result]
                
                # å¦‚æœFTSæœç´¢æ²¡æœ‰ç»“æœï¼Œå°è¯•å‰ç¼€æœç´¢
                if not photo_ids:
                    words = keyword.split()
                    if len(words) > 1:
                        # å¤šè¯æœç´¢ï¼šå°è¯•æ¯ä¸ªè¯çš„å‰ç¼€æœç´¢ï¼Œä½¿ç”¨ANDå…³ç³»
                        try:
                            prefix_words = [f"{word}*" for word in words]
                            fts_prefix_query = f"""
                            SELECT photo_id
                            FROM photos_fts
                            WHERE photos_fts MATCH '{" AND ".join(prefix_words)}'
                            """
                            result = query.session.execute(text(fts_prefix_query)).fetchall()
                            photo_ids = [row[0] for row in result]
                        except Exception:
                            pass
                    elif len(keyword) <= 3:  # å•è¯ä¸”çŸ­è¯å°è¯•å‰ç¼€æœç´¢
                        try:
                            fts_prefix_query = f"""
                            SELECT photo_id
                            FROM photos_fts
                            WHERE photos_fts MATCH '{keyword}*'
                            """
                            result = query.session.execute(text(fts_prefix_query)).fetchall()
                            photo_ids = [row[0] for row in result]
                        except Exception:
                            pass
                
                if photo_ids:
                    query = query.filter(Photo.id.in_(photo_ids))
                    return query
            except Exception as e:
                # FTSæœç´¢å¤±è´¥ï¼Œç»§ç»­ä½¿ç”¨LIKEæŸ¥è¯¢
                pass
    
    # å¦‚æœFTSå¤±è´¥æˆ–search_typeä¸ºallï¼Œä½¿ç”¨ä¼ ç»Ÿçš„LIKEæŸ¥è¯¢ä½œä¸ºåå¤‡
    if search_type == "all":
        # æœç´¢æ–‡ä»¶åã€è·¯å¾„ã€æ ‡ç­¾ã€åˆ†ç±»å’Œåˆ†æç»“æœ
        query = query.filter(
            or_(
                Photo.filename.ilike(f"%{keyword}%"),
                Photo.original_path.ilike(f"%{keyword}%"),
                Photo.description.ilike(f"%{keyword}%"),
                # æœç´¢æ ‡ç­¾
                Photo.tags.any(PhotoTag.tag.has(Tag.name.ilike(f"%{keyword}%"))),
                # æœç´¢åˆ†ç±»
                Photo.categories.any(PhotoCategory.category.has(Category.name.ilike(f"%{keyword}%"))),
                # æœç´¢åˆ†æç»“æœä¸­çš„æè¿°å’Œæ ‡ç­¾
                Photo.analysis_results.any(
                    PhotoAnalysis.analysis_result.ilike(f"%{keyword}%")
                )
            )
        )
    
    return query
```

### 6.2 ç›¸ä¼¼åº¦è®¡ç®—ç®—æ³•

#### 6.2.1 æ„ŸçŸ¥å“ˆå¸Œç›¸ä¼¼åº¦
```python
def calculate_similarity(hash1: str, hash2: str) -> float:
    """
    è®¡ç®—æ„ŸçŸ¥å“ˆå¸Œç›¸ä¼¼åº¦
    
    :param hash1: ç¬¬ä¸€ä¸ªå“ˆå¸Œå€¼
    :param hash2: ç¬¬äºŒä¸ªå“ˆå¸Œå€¼
    :return: ç›¸ä¼¼åº¦(0-1)
    """
    # è®¡ç®—æ±‰æ˜è·ç¦»
    # è½¬æ¢ä¸ºç›¸ä¼¼åº¦åˆ†æ•°
    # æ”¯æŒä¸åŒå“ˆå¸Œç®—æ³•
```

#### 6.2.2 å†…å®¹ç›¸ä¼¼åº¦
```python
def calculate_content_similarity(photo1_id: int, photo2_id: int) -> float:
    """
    è®¡ç®—å†…å®¹ç›¸ä¼¼åº¦
    
    :param photo1_id: ç¬¬ä¸€ä¸ªç…§ç‰‡ID
    :param photo2_id: ç¬¬äºŒä¸ªç…§ç‰‡ID
    :return: ç›¸ä¼¼åº¦(0-1)
    """
    # åŸºäºAIåˆ†æç»“æœ
    # åŸºäºæ ‡ç­¾ç›¸ä¼¼åº¦
    # åŸºäºåœºæ™¯ç±»å‹ç›¸ä¼¼åº¦
```

### 6.3 æœç´¢ç»“æœæ’åºç®—æ³•

#### 6.3.1 ç›¸å…³æ€§æ’åº
```python
def calculate_relevance_score(photo: Photo, query: str) -> float:
    """
    è®¡ç®—ç›¸å…³æ€§åˆ†æ•°
    
    :param photo: ç…§ç‰‡å¯¹è±¡
    :param query: æŸ¥è¯¢å­—ç¬¦ä¸²
    :return: ç›¸å…³æ€§åˆ†æ•°
    """
    # å…³é”®è¯åŒ¹é…åº¦
    # å­—æ®µæƒé‡
    # æ—¶é—´æ–°é²œåº¦
    # è´¨é‡è¯„åˆ†
```

#### 6.3.2 ç»¼åˆæ’åº
```python
def sort_search_results(photos: List[Photo], sort_by: str = 'relevance') -> List[Photo]:
    """
    æœç´¢ç»“æœæ’åº
    
    :param photos: ç…§ç‰‡åˆ—è¡¨
    :param sort_by: æ’åºæ–¹å¼
    :return: æ’åºåçš„ç…§ç‰‡åˆ—è¡¨
    """
    # ç›¸å…³æ€§æ’åº
    # æ—¶é—´æ’åº
    # è´¨é‡æ’åº
    # è‡ªå®šä¹‰æ’åº
```

## ä¸ƒã€æ•°æ®åº“ç´¢å¼•è®¾è®¡

### 7.1 æœç´¢ç´¢å¼•

#### 7.1.1 åŸºç¡€æœç´¢ç´¢å¼•
```sql
-- æ—¶é—´ç´¢å¼•
CREATE INDEX idx_photos_taken_at ON photos(taken_at);
CREATE INDEX idx_photos_created_at ON photos(created_at);

-- è´¨é‡ç´¢å¼•
CREATE INDEX idx_photos_quality_score ON photos(quality_score);
CREATE INDEX idx_photos_quality_level ON photos(quality_level);

-- çŠ¶æ€ç´¢å¼•
CREATE INDEX idx_photos_status ON photos(status);
CREATE INDEX idx_photos_is_favorite ON photos(is_favorite);
```

#### 7.1.2 å¤åˆæœç´¢ç´¢å¼•
```sql
-- æ—¶é—´+è´¨é‡å¤åˆç´¢å¼•
CREATE INDEX idx_photos_time_quality ON photos(taken_at, quality_score);

-- çŠ¶æ€+è´¨é‡å¤åˆç´¢å¼•
CREATE INDEX idx_photos_status_quality ON photos(status, quality_score);

-- è®¾å¤‡+æ—¶é—´å¤åˆç´¢å¼•
CREATE INDEX idx_photos_camera_time ON photos(camera_make, taken_at);
```

#### 7.1.3 è¦†ç›–ç´¢å¼•
```sql
-- æœç´¢ç»“æœè¦†ç›–ç´¢å¼•
CREATE INDEX idx_photos_search_cover ON photos(
    id, filename, taken_at, quality_score, 
    scene_type, is_favorite, status
);
```

### 7.2 å…¨æ–‡æœç´¢ç´¢å¼•

#### 7.2.1 FTS5ç´¢å¼•é…ç½®
```sql
-- ç…§ç‰‡å…¨æ–‡æœç´¢ç´¢å¼•ï¼ˆå®é™…å®ç°ï¼‰
CREATE VIRTUAL TABLE photos_fts USING fts5(
    photo_id UNINDEXED,           -- ç…§ç‰‡IDï¼ˆä¸ç´¢å¼•ï¼Œç”¨äºå…³è”ï¼‰
    filename,                     -- æ–‡ä»¶å
    original_path,                -- æ–‡ä»¶è·¯å¾„
    description,                  -- ç”¨æˆ·æè¿°
    tags_content,                 -- æ‰€æœ‰æ ‡ç­¾åç§°ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰
    categories_content,           -- æ‰€æœ‰åˆ†ç±»åç§°ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰
    analysis_content              -- AIåˆ†æç»“æœ
);

-- æ ‡ç­¾å…¨æ–‡æœç´¢ç´¢å¼•ï¼ˆå®é™…å®ç°ä¸­æœªä½¿ç”¨ï¼‰
-- ç³»ç»Ÿä¸»è¦ä½¿ç”¨ç…§ç‰‡FTSè¡¨è¿›è¡Œå…¨æ–‡æœç´¢
```

## å…«ã€ç”¨æˆ·ç•Œé¢è®¾è®¡

### 8.1 å·²å®ç°ç•Œé¢ï¼ˆç…§ç‰‡åº“é¡µé¢ï¼‰

#### 8.1.1 æœç´¢æ è®¾è®¡ï¼ˆå·²å®ç°ï¼‰
```html
<!-- æœç´¢å’Œç­›é€‰æ ï¼ˆå·²å®ç°ï¼‰ -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="row g-3 align-items-end">
                    <!-- æœç´¢æ¡† -->
                    <div class="col-md-4">
                        <label class="form-label">å¿«é€Ÿæœç´¢</label>
                        <div class="input-group">
                            <select class="form-select" id="searchType" style="max-width: 120px;">
                                <option value="all">å…¨éƒ¨å†…å®¹</option>
                                <option value="filename">æ–‡ä»¶å</option>
                                <option value="tags">æ ‡ç­¾</option>
                                <option value="categories">åˆ†ç±»</option>
                                <option value="description">æè¿°</option>
                                <option value="ai_analysis">AIåˆ†æç»“æœ</option>
                            </select>
                            <input type="text" class="form-control" id="searchInput" placeholder="æœç´¢ç…§ç‰‡ã€æ ‡ç­¾ã€æ–‡ä»¶åã€æè¿°...">
                            <button class="btn btn-outline-secondary" type="button" id="searchBtn">
                                <i class="bi bi-search"></i>
                            </button>
</div>
                        <small class="text-muted" id="searchScopeHint">æ”¯æŒæœç´¢ï¼šæ–‡ä»¶åã€æ ‡ç­¾ã€æè¿°ã€åˆ†ç±»ã€AIåˆ†æç»“æœç­‰</small>
                        <!-- æœç´¢å»ºè®®å®¹å™¨ -->
                        <div id="searchSuggestions" class="mt-2" style="display: none;">
                            <div class="d-flex flex-wrap gap-1">
                                <span class="badge bg-secondary me-1 mb-1" style="cursor: pointer;" onclick="selectSuggestion(this.textContent)">
                                    ç‚¹å‡»æ ‡ç­¾å¿«é€Ÿæœç´¢
                                </span>
                            </div>
                        </div>
                    </div>
                    <!-- æ—¥æœŸç­›é€‰ -->
                    <div class="col-md-2">
                        <label class="form-label">æ‹æ‘„æ—¥æœŸ</label>
                        <select class="form-select" id="dateFilter">
                            <option value="" selected>å…¨éƒ¨æ—¶é—´</option>
        <option value="today">ä»Šå¤©</option>
        <option value="week">æœ¬å‘¨</option>
        <option value="month">æœ¬æœˆ</option>
        <option value="year">ä»Šå¹´</option>
                            <option value="custom">è‡ªå®šä¹‰</option>
    </select>
                    </div>
                    <!-- è´¨é‡ç­›é€‰ -->
                    <div class="col-md-2">
                        <label class="form-label">ç…§ç‰‡è´¨é‡</label>
                        <select class="form-select" id="qualityFilter">
                            <option value="" selected>å…¨éƒ¨è´¨é‡</option>
        <option value="excellent">ä¼˜ç§€</option>
        <option value="good">è‰¯å¥½</option>
        <option value="fair">ä¸€èˆ¬</option>
        <option value="poor">è¾ƒå·®</option>
    </select>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
```

### 8.2 å·²å®ç°ç•Œé¢ï¼ˆç…§ç‰‡åº“é¡µé¢é›†æˆåŠŸèƒ½ï¼‰

#### 8.2.1 ç›¸ä¼¼ç…§ç‰‡æ‚¬åœåŠŸèƒ½ï¼ˆå·²å®ç°ï¼‰
```html
<!-- ç…§ç‰‡æ‚¬åœç›¸ä¼¼ç…§ç‰‡å‘ç°åŠŸèƒ½ï¼ˆå·²å®ç°ï¼‰ -->
<div class="photo-card" data-photo-id="1">
    <img src="thumbnail.jpg" alt="ç…§ç‰‡ç¼©ç•¥å›¾" class="photo-thumbnail" />
    <div class="photo-overlay">
        <div class="photo-actions">
            <button class="btn btn-sm btn-light" onclick="viewPhoto(1)">
                <i class="bi bi-eye"></i>
            </button>
            <button class="btn btn-sm btn-warning" onclick="editPhoto(1)">
                <i class="bi bi-pencil"></i>
            </button>
            <button class="btn btn-sm btn-danger" onclick="deletePhoto(1)">
                <i class="bi bi-trash"></i>
            </button>
            <!-- ç›¸ä¼¼ç…§ç‰‡å‘ç°æŒ‰é’® -->
            <button class="btn btn-sm btn-info" onclick="findSimilarPhotos(1)" title="æŸ¥æ‰¾ç›¸ä¼¼ç…§ç‰‡">
                <i class="bi bi-search"></i>
            </button>
    </div>
    </div>
    <div class="photo-info">
        <div class="photo-title">ç…§ç‰‡æ ‡é¢˜</div>
        <div class="photo-meta">
            <span class="photo-date">2023-12-19</span>
            <span class="photo-quality">è´¨é‡: 85åˆ†</span>
        </div>
        <div class="photo-tags">
            <span class="tag">å®¶åº­</span>
            <span class="tag">èšä¼š</span>
        </div>
    </div>
    </div>
    
<!-- ç›¸ä¼¼ç…§ç‰‡æ‚¬åœæç¤ºæ¡†ï¼ˆå·²å®ç°ï¼‰ -->
<div class="similar-photos-tooltip" id="similar-photos-tooltip" style="display: none;">
    <div class="tooltip-header">
        <h6>ç›¸ä¼¼ç…§ç‰‡</h6>
        <button class="btn-close" onclick="hideSimilarPhotos()">&times;</button>
    </div>
    <div class="similar-photos-grid">
        <div class="similar-photo-item" data-photo-id="2">
            <img src="similar1.jpg" alt="ç›¸ä¼¼ç…§ç‰‡1" />
            <div class="similarity-score">85%</div>
        </div>
        <div class="similar-photo-item" data-photo-id="3">
            <img src="similar2.jpg" alt="ç›¸ä¼¼ç…§ç‰‡2" />
            <div class="similarity-score">78%</div>
        </div>
        <div class="similar-photo-item" data-photo-id="4">
            <img src="similar3.jpg" alt="ç›¸ä¼¼ç…§ç‰‡3" />
            <div class="similarity-score">72%</div>
        </div>
    </div>
    <div class="tooltip-footer">
        <button class="btn btn-sm btn-primary" onclick="viewAllSimilarPhotos(1)">
            æŸ¥çœ‹æ‰€æœ‰ç›¸ä¼¼ç…§ç‰‡
        </button>
    </div>
</div>
```

#### 8.2.2 ç›¸ä¼¼ç…§ç‰‡æ¨¡æ€æ¡†ï¼ˆå·²å®ç°ï¼‰
```html
<!-- ç›¸ä¼¼ç…§ç‰‡è¯¦æƒ…æ¨¡æ€æ¡†ï¼ˆå·²å®ç°ï¼‰ -->
<div class="modal fade" id="similarPhotosModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ç›¸ä¼¼ç…§ç‰‡</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="reference-photo-section">
                    <h6>å‚è€ƒç…§ç‰‡</h6>
                    <div class="reference-photo">
                        <img id="reference-photo-img" src="" alt="å‚è€ƒç…§ç‰‡" />
                        <div class="reference-info">
                            <div id="reference-filename">ç…§ç‰‡æ–‡ä»¶å</div>
                            <div id="reference-details">æ‹æ‘„æ—¶é—´ã€è´¨é‡ç­‰ä¿¡æ¯</div>
                        </div>
                    </div>
    </div>
    
                <div class="similarity-controls">
                    <label>ç›¸ä¼¼åº¦é˜ˆå€¼</label>
                    <input type="range" id="similarity-threshold" min="0.5" max="1.0" step="0.1" value="0.8" />
                    <span id="similarity-value">80%</span>
    </div>
    
                <div class="similar-results-section">
                    <h6>ç›¸ä¼¼ç…§ç‰‡ç»“æœ</h6>
                    <div class="similar-results-grid" id="similar-results-grid">
                        <!-- ç›¸ä¼¼ç…§ç‰‡ç»“æœé¡¹ -->
                        <div class="similar-result-item" data-photo-id="2">
                            <img src="similar1.jpg" alt="ç›¸ä¼¼ç…§ç‰‡1" />
                            <div class="similarity-info">
                                <div class="similarity-score">85%</div>
                                <div class="similarity-actions">
                                    <button class="btn btn-sm btn-light" onclick="viewPhoto(2)">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-warning" onclick="editPhoto(2)">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
            </div>
        </div>
    </div>
</div>
```

#### 8.2.3 ç›¸ä¼¼ç…§ç‰‡åŠŸèƒ½æ ·å¼ï¼ˆå·²å®ç°ï¼‰
```css
/* ç›¸ä¼¼ç…§ç‰‡æ‚¬åœæç¤ºæ¡†æ ·å¼ */
.similar-photos-tooltip {
    position: absolute;
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 1000;
    max-width: 300px;
    padding: 12px;
}

.tooltip-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    padding-bottom: 8px;
    border-bottom: 1px solid #eee;
}

.similar-photos-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin-bottom: 12px;
}

.similar-photo-item {
    position: relative;
    cursor: pointer;
    border-radius: 4px;
    overflow: hidden;
}

.similar-photo-item img {
    width: 100%;
    height: 60px;
    object-fit: cover;
}

.similarity-score {
    position: absolute;
    top: 4px;
    right: 4px;
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 11px;
}

/* ç›¸ä¼¼ç…§ç‰‡æ¨¡æ€æ¡†æ ·å¼ */
.reference-photo-section {
    margin-bottom: 20px;
}

.reference-photo {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
}

.reference-photo img {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 4px;
}

.similarity-controls {
    margin-bottom: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
}

.similarity-controls label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
}

.similarity-controls input[type="range"] {
    width: 200px;
    margin-right: 10px;
}

.similar-results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 15px;
}

.similar-result-item {
    position: relative;
    border: 1px solid #ddd;
    border-radius: 8px;
    overflow: hidden;
    transition: transform 0.2s;
}

.similar-result-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.similar-result-item img {
    width: 100%;
    height: 120px;
    object-fit: cover;
}

.similarity-info {
    padding: 8px;
    background: white;
}

.similarity-score {
    font-weight: bold;
    color: #007bff;
    margin-bottom: 8px;
}

.similarity-actions {
    display: flex;
    gap: 5px;
}

.similarity-actions .btn {
    padding: 4px 8px;
    font-size: 12px;
}
```

#### 8.2.4 å·²åˆ é™¤ç•Œé¢ï¼ˆé«˜çº§æœç´¢é¡µé¢ï¼‰
**åˆ é™¤åŸå› **ï¼šä¸ºäº†ç®€åŒ–ç³»ç»Ÿæ¶æ„å’Œæå‡ç”¨æˆ·ä½“éªŒï¼Œå·²åˆ é™¤ä»¥ä¸‹é«˜çº§æœç´¢ç•Œé¢ï¼š

- **é«˜çº§æœç´¢ç•Œé¢**ï¼šå¤šæ¡ä»¶ç»„åˆæœç´¢é¢æ¿
- **æœç´¢ç»“æœå¤„ç†ç•Œé¢**ï¼šæ‰¹é‡æ“ä½œå·¥å…·æ 
- **æœç´¢å†å²ç•Œé¢**ï¼šæœç´¢è®°å½•ç®¡ç†é¢æ¿

**åŠŸèƒ½è¿ç§»**ï¼šç›¸ä¼¼ç…§ç‰‡æœç´¢åŠŸèƒ½å·²é›†æˆåˆ°å›¾ç‰‡æ‚¬åœåŠŸèƒ½ä¸­ï¼Œæä¾›æ›´ç›´è§‚ã€æ›´ä¾¿æ·çš„ç›¸ä¼¼ç…§ç‰‡å‘ç°ä½“éªŒã€‚

### 8.3 æœç´¢ç»“æœå±•ç¤º

#### 8.3.1 æœç´¢ç»“æœåˆ—è¡¨ï¼ˆå·²å®ç°ï¼‰
```html
<!-- æœç´¢ç»“æœå®¹å™¨ï¼ˆå·²å®ç°ï¼‰ -->
<div class="search-results">
    <div class="results-header">
        <span id="results-count">æ‰¾åˆ° 0 å¼ ç…§ç‰‡</span>
        <div class="sort-options">
            <select id="sort-by">
                <option value="relevance">ç›¸å…³æ€§</option>
                <option value="time">æ—¶é—´</option>
                <option value="quality">è´¨é‡</option>
                <option value="name">æ–‡ä»¶å</option>
            </select>
        </div>
    </div>
    
    <div class="results-grid" id="results-grid">
        <!-- æœç´¢ç»“æœé¡¹ -->
        <div class="photo-item" data-photo-id="1">
            <img src="thumbnail.jpg" alt="ç…§ç‰‡ç¼©ç•¥å›¾" />
            <div class="photo-info">
                <div class="photo-title">ç…§ç‰‡æ ‡é¢˜</div>
                <div class="photo-meta">
                    <span class="photo-date">2023-12-19</span>
                    <span class="photo-quality">è´¨é‡: 85åˆ†</span>
                </div>
                <div class="photo-tags">
                    <span class="tag">å®¶åº­</span>
                    <span class="tag">èšä¼š</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="pagination" id="pagination">
        <!-- åˆ†é¡µæ§ä»¶ -->
    </div>
</div>
```

#### 8.3.2 æœç´¢å»ºè®®ï¼ˆå·²å®ç°ï¼‰
```html
<!-- æœç´¢å»ºè®®ä¸‹æ‹‰æ¡†ï¼ˆå·²å®ç°ï¼‰ -->
<div class="search-suggestions" id="search-suggestions">
    <div class="d-flex flex-wrap gap-1">
        <span class="badge bg-secondary me-1 mb-1" style="cursor: pointer;" onclick="selectSuggestion(this.textContent)">
            ç‚¹å‡»æ ‡ç­¾å¿«é€Ÿæœç´¢
        </span>
    </div>
</div>
```

## ä¹ã€APIæ¥å£è®¾è®¡

### 9.1 å·²å®ç°æ¥å£

#### 9.1.1 æœç´¢ç›¸å…³æ¥å£ï¼ˆå·²å®ç°ï¼‰
**åŸºç¡€æœç´¢æ¥å£**ï¼š
```python
@router.get("/photos", response_model=PhotoSearchResponse)
async def search_photos(
    keyword: Optional[str] = Query(None, description="å…³é”®è¯æœç´¢"),
    search_type: str = Query("all", description="æœç´¢ç±»å‹"),
    camera_make: Optional[str] = Query(None, description="ç›¸æœºå“ç‰Œ"),
    camera_model: Optional[str] = Query(None, description="ç›¸æœºå‹å·"),
    date_from: Optional[date] = Query(None, description="å¼€å§‹æ—¥æœŸ"),
    date_to: Optional[date] = Query(None, description="ç»“æŸæ—¥æœŸ"),
    start_date: Optional[date] = Query(None, description="è‡ªå®šä¹‰å¼€å§‹æ—¥æœŸ"),
    end_date: Optional[date] = Query(None, description="è‡ªå®šä¹‰ç»“æŸæ—¥æœŸ"),
    date_filter: Optional[str] = Query(None, description="æ—¥æœŸç­›é€‰ç±»å‹"),
    quality_min: Optional[float] = Query(None, ge=0, le=100, description="æœ€ä½è´¨é‡åˆ†æ•°"),
    quality_level: Optional[str] = Query(None, description="è´¨é‡ç­‰çº§"),
    quality_filter: Optional[str] = Query(None, description="è´¨é‡ç­›é€‰"),
    tags: Optional[List[str]] = Query(None, description="æ ‡ç­¾åˆ—è¡¨"),
    categories: Optional[List[str]] = Query(None, description="åˆ†ç±»åˆ—è¡¨"),
    location_lat: Optional[float] = Query(None, description="çº¬åº¦"),
    location_lng: Optional[float] = Query(None, description="ç»åº¦"),
    location_radius: Optional[float] = Query(None, ge=0, description="æœç´¢åŠå¾„(å…¬é‡Œ)"),
    sort_by: str = Query("taken_at", description="æ’åºå­—æ®µ"),
    sort_order: str = Query("desc", description="æ’åºé¡ºåº"),
    limit: int = Query(50, ge=1, le=200, description="è¿”å›æ•°é‡"),
    offset: int = Query(0, ge=0, description="åç§»é‡"),
    db: Session = Depends(get_db)
):
    """ç»¼åˆæœç´¢ç…§ç‰‡ï¼ˆå·²å®ç°ï¼‰"""
```

**æœç´¢å»ºè®®æ¥å£**ï¼š
```python
@router.get("/suggestions", response_model=SearchSuggestionsResponse)
async def get_search_suggestions(
    prefix: str = Query(..., min_length=1, max_length=50, description="æœç´¢å‰ç¼€"),
    search_type: str = Query("all", description="æœç´¢ç±»å‹"),
    limit: int = Query(10, ge=1, le=50, description="å»ºè®®æ•°é‡é™åˆ¶"),
    db: Session = Depends(get_db)
):
    """è·å–æœç´¢å»ºè®®ï¼ˆå·²å®ç°ï¼‰"""
```

**æœç´¢ç»Ÿè®¡æ¥å£**ï¼š
```python
@router.get("/stats", response_model=SearchStatsResponse)
async def get_search_stats(db: Session = Depends(get_db)):
    """è·å–æœç´¢ç»Ÿè®¡ä¿¡æ¯ï¼ˆå·²å®ç°ï¼‰"""
```

#### 9.1.2 ç…§ç‰‡ç®¡ç†æ¥å£ï¼ˆå·²å®ç°ï¼‰
**ç…§ç‰‡è¯¦æƒ…æ¥å£**ï¼š
```python
@router.get("/{photo_id}", response_model=Dict[str, Any])
async def get_photo_detail(photo_id: int, db: Session = Depends(get_db)):
    """è·å–ç…§ç‰‡è¯¦æƒ…ï¼ˆå·²å®ç°ï¼‰"""
```

**ç…§ç‰‡æ›´æ–°æ¥å£**ï¼š
```python
@router.put("/{photo_id}", response_model=Dict[str, Any])
async def update_photo(
    photo_id: int,
    update_request: PhotoUpdateRequest,
    db: Session = Depends(get_db)
):
    """æ›´æ–°ç…§ç‰‡ä¿¡æ¯ï¼ˆå·²å®ç°ï¼‰"""
```

**ç…§ç‰‡åˆ é™¤æ¥å£**ï¼š
```python
@router.delete("/{photo_id}")
async def delete_photo(photo_id: int, delete_file: bool = True, db: Session = Depends(get_db)):
    """åˆ é™¤å•å¼ ç…§ç‰‡ï¼ˆå·²å®ç°ï¼‰"""
```

**æ‰¹é‡åˆ é™¤æ¥å£**ï¼š
```python
@router.post("/batch-delete", response_model=BatchDeleteResponse)
async def batch_delete_photos(request: BatchDeleteRequest, db: Session = Depends(get_db)):
    """æ‰¹é‡åˆ é™¤ç…§ç‰‡ï¼ˆå·²å®ç°ï¼‰"""
```

#### 9.1.3 æ ‡ç­¾ç®¡ç†æ¥å£ï¼ˆå·²å®ç°ï¼‰
**æ ‡ç­¾åˆ—è¡¨æ¥å£**ï¼š
```python
@router.get("/", response_model=List[TagResponse])
async def get_tags(
    skip: int = Query(0, ge=0, description="è·³è¿‡çš„è®°å½•æ•°"),
    limit: int = Query(300, ge=1, le=1000, description="è¿”å›çš„è®°å½•æ•°"),
    search: Optional[str] = Query(None, description="æœç´¢å…³é”®è¯"),
    db: Session = Depends(get_db)
):
    """è·å–æ ‡ç­¾åˆ—è¡¨ï¼ˆå·²å®ç°ï¼‰"""
```

**çƒ­é—¨æ ‡ç­¾æ¥å£**ï¼š
```python
@router.get("/popular", response_model=List[Dict[str, Any]])
async def get_popular_tags(
    limit: int = Query(20, ge=1, le=100, description="è¿”å›çš„æ ‡ç­¾æ•°é‡"),
    db: Session = Depends(get_db)
):
    """è·å–çƒ­é—¨æ ‡ç­¾ï¼ˆå·²å®ç°ï¼‰"""
```

**æ ‡ç­¾CRUDæ¥å£**ï¼š
```python
@router.post("/", response_model=TagResponse)
async def create_tag(request: TagCreate, db: Session = Depends(get_db)):
    """åˆ›å»ºæ ‡ç­¾ï¼ˆå·²å®ç°ï¼‰"""

@router.put("/{tag_id}", response_model=TagResponse)
async def update_tag(tag_id: int, request: TagUpdate, db: Session = Depends(get_db)):
    """æ›´æ–°æ ‡ç­¾ï¼ˆå·²å®ç°ï¼‰"""

@router.delete("/{tag_id}")
async def delete_tag(tag_id: int, db: Session = Depends(get_db)):
    """åˆ é™¤æ ‡ç­¾ï¼ˆå·²å®ç°ï¼‰"""
```

#### 9.1.4 åˆ†ç±»ç®¡ç†æ¥å£ï¼ˆå·²å®ç°ï¼‰
**åˆ†ç±»åˆ—è¡¨æ¥å£**ï¼š
```python
@router.get("/", response_model=List[CategoryResponse])
async def get_categories(
    skip: int = Query(0, ge=0, description="è·³è¿‡çš„è®°å½•æ•°"),
    limit: int = Query(300, ge=1, le=1000, description="è¿”å›çš„è®°å½•æ•°"),
    search: Optional[str] = Query(None, description="æœç´¢å…³é”®è¯"),
    parent_id: Optional[int] = Query(None, description="çˆ¶åˆ†ç±»ID"),
    db: Session = Depends(get_db)
):
    """è·å–åˆ†ç±»åˆ—è¡¨ï¼ˆå·²å®ç°ï¼‰"""
```

**åˆ†ç±»æ ‘æ¥å£**ï¼š
```python
@router.get("/tree", response_model=List[CategoryTreeResponse])
async def get_category_tree(db: Session = Depends(get_db)):
    """è·å–åˆ†ç±»æ ‘ç»“æ„ï¼ˆå·²å®ç°ï¼‰"""
```

**çƒ­é—¨åˆ†ç±»æ¥å£**ï¼š
```python
@router.get("/popular", response_model=List[Dict[str, Any]])
async def get_popular_categories(
    limit: int = Query(20, ge=1, le=100, description="è¿”å›çš„åˆ†ç±»æ•°é‡"),
    db: Session = Depends(get_db)
):
    """è·å–çƒ­é—¨åˆ†ç±»ï¼ˆå·²å®ç°ï¼‰"""
```

**åˆ†ç±»CRUDæ¥å£**ï¼š
```python
@router.post("/", response_model=CategoryResponse)
async def create_category(request: CategoryCreate, db: Session = Depends(get_db)):
    """åˆ›å»ºåˆ†ç±»ï¼ˆå·²å®ç°ï¼‰"""

@router.put("/{category_id}", response_model=CategoryResponse)
async def update_category(category_id: int, request: CategoryUpdate, db: Session = Depends(get_db)):
    """æ›´æ–°åˆ†ç±»ï¼ˆå·²å®ç°ï¼‰"""

@router.delete("/{category_id}")
async def delete_category(category_id: int, db: Session = Depends(get_db)):
    """åˆ é™¤åˆ†ç±»ï¼ˆå·²å®ç°ï¼‰"""
```

### 9.2 å·²åˆ é™¤æ¥å£ï¼ˆé«˜çº§æœç´¢é¡µé¢ï¼‰

#### 9.2.1 åˆ é™¤çš„æ¥å£
ä¸ºäº†ç®€åŒ–ç³»ç»Ÿæ¶æ„ï¼Œå·²åˆ é™¤ä»¥ä¸‹é«˜çº§æœç´¢ç›¸å…³æ¥å£ï¼š

**åˆ é™¤çš„æ¥å£**ï¼š
- **æ™ºèƒ½æ¨èæ¥å£**ï¼š`GET /recommend/{photo_id}`
- **æœç´¢å†å²æ¥å£**ï¼š`GET /history`
- **ä¿å­˜æœç´¢æ¡ä»¶æ¥å£**ï¼š`POST /save`
- **æœç´¢ç»“æœå¤„ç†æ¥å£**ï¼š`POST /batch-process`

**åŠŸèƒ½è¿ç§»**ï¼š
- **ç›¸ä¼¼ç…§ç‰‡æœç´¢æ¥å£**ï¼š`GET /similar/{photo_id}` - å·²é›†æˆåˆ°å›¾ç‰‡æ‚¬åœåŠŸèƒ½ä¸­

#### 9.2.2 åˆ é™¤åŸå› 
**ç®€åŒ–åŸåˆ™**ï¼š
- **ä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½**ï¼šä¿ç•™åŸºç¡€æœç´¢å’Œç­›é€‰åŠŸèƒ½
- **å‡å°‘APIå¤æ‚åº¦**ï¼šåˆ é™¤å¤æ‚çš„é«˜çº§æœç´¢æ¥å£
- **é™ä½ç»´æŠ¤æˆæœ¬**ï¼šå‡å°‘æ¥å£æ•°é‡ï¼Œç®€åŒ–ç³»ç»Ÿæ¶æ„
- **æå‡ç”¨æˆ·ä½“éªŒ**ï¼šé¿å…åŠŸèƒ½è¿‡äºå¤æ‚ï¼Œä¸“æ³¨æ ¸å¿ƒéœ€æ±‚

**ä¿ç•™çš„æ ¸å¿ƒæ¥å£**ï¼š
- **åŸºç¡€æœç´¢æ¥å£**ï¼š`GET /photos`ï¼ˆå·²å®ç°ï¼‰
- **æœç´¢å»ºè®®æ¥å£**ï¼š`GET /suggestions`ï¼ˆå·²å®ç°ï¼‰
- **æœç´¢ç»Ÿè®¡æ¥å£**ï¼š`GET /stats`ï¼ˆå·²å®ç°ï¼‰
- **ç…§ç‰‡ç®¡ç†æ¥å£**ï¼šCRUDæ“ä½œï¼ˆå·²å®ç°ï¼‰
- **æ ‡ç­¾ç®¡ç†æ¥å£**ï¼šCRUDæ“ä½œï¼ˆå·²å®ç°ï¼‰
- **åˆ†ç±»ç®¡ç†æ¥å£**ï¼šCRUDæ“ä½œï¼ˆå·²å®ç°ï¼‰
- **ç›¸ä¼¼ç…§ç‰‡æœç´¢æ¥å£**ï¼š`GET /similar/{photo_id}`ï¼ˆå·²å®ç°ï¼Œé›†æˆåˆ°æ‚¬åœåŠŸèƒ½ï¼‰

### 9.3 æœç´¢ç»“æœå¤„ç†åŠŸèƒ½ï¼ˆåŸºäºç°æœ‰æ¥å£ï¼‰

#### 9.3.1 æ‰¹é‡æ“ä½œåŠŸèƒ½ï¼ˆå·²å®ç°ï¼‰
**åˆ©ç”¨ç°æœ‰æ‰¹é‡åˆ é™¤æ¥å£**ï¼š
```python
# å·²å®ç°ï¼šPOST /api/photos/batch-delete
# æ”¯æŒæ‰¹é‡åˆ é™¤ç…§ç‰‡ï¼Œå¯ç›´æ¥ç”¨äºæœç´¢ç»“æœå¤„ç†
```

**åˆ©ç”¨ç°æœ‰ç…§ç‰‡æ›´æ–°æ¥å£**ï¼š
```python
# å·²å®ç°ï¼šPUT /api/photos/{photo_id}
# æ”¯æŒæ›´æ–°ç…§ç‰‡æè¿°ã€æ ‡ç­¾ã€åˆ†ç±»ï¼Œå¯ç›´æ¥ç”¨äºæœç´¢ç»“æœå¤„ç†
```

#### 9.3.2 ç›¸ä¼¼ç…§ç‰‡æœç´¢åŠŸèƒ½ï¼ˆå·²å®ç°ï¼Œé›†æˆåˆ°æ‚¬åœåŠŸèƒ½ï¼‰
**ç›¸ä¼¼ç…§ç‰‡æœç´¢å®ç°**ï¼š
```python
# å®é™…å®ç°é€šè¿‡å›¾ç‰‡æ‚¬åœåŠŸèƒ½è°ƒç”¨
# å‰ç«¯JavaScriptä»£ç ï¼š
function findSimilarPhotos(photoId) {
    // æ˜¾ç¤ºç›¸ä¼¼ç…§ç‰‡æ¨¡æ€æ¡†
    showSimilarPhotosModal(photoId);
}

// åç«¯APIè°ƒç”¨ï¼ˆé€šè¿‡ç°æœ‰çš„ç…§ç‰‡APIå®ç°ï¼‰
# åˆ©ç”¨ç°æœ‰çš„DuplicateDetectionService
# ä½¿ç”¨calculate_perceptual_hashå’Œfind_similar_photosæ–¹æ³•
# é›†æˆåˆ°å›¾ç‰‡æ‚¬åœåŠŸèƒ½ä¸­ï¼Œæä¾›ç›´è§‚çš„ç›¸ä¼¼ç…§ç‰‡å‘ç°ä½“éªŒ

# å®é™…çš„ç›¸ä¼¼åº¦è®¡ç®—é€šè¿‡é…ç½®ä¸­çš„similarityç®—æ³•å®ç°ï¼š
"similarity": {
  "first_layer_weights": {
    "perceptual_hash": 0.25,
    "objects": 0.15,
    "time": 0.15,
    "color_histogram": 0.15,
    "scene_type": 0.1,
    "location": 0.1,
    "description": 0.1,
    "emotion": 0.05,
    "activity": 0.05,
    "tags": 0.05,
    "camera": 0.05,
    "structural": 0.1
  },
  "first_layer_thresholds": {
    "perceptual_hash": 0.6,
    "color_histogram": 0.7,
    "structural": 0.8,
    "scene_type": 1.0,
    "objects": 0.5,
    "emotion": 0.6,
    "activity": 0.6,
    "description": 0.5,
    "tags": 0.5,
    "time": 0.8,
    "location": 0.9,
    "camera": 0.7,
    "combined": 0.55
  }
}
```

**æ‚¬åœåŠŸèƒ½é›†æˆ**ï¼š
- **æ‚¬åœæç¤ºæ¡†**ï¼šå¿«é€Ÿé¢„è§ˆç›¸ä¼¼ç…§ç‰‡
- **ç›¸ä¼¼åº¦è¯„åˆ†**ï¼šæ˜¾ç¤ºæ¯å¼ ç…§ç‰‡çš„ç›¸ä¼¼åº¦ç™¾åˆ†æ¯”
- **æ¨¡æ€æ¡†è¯¦æƒ…**ï¼šå®Œæ•´çš„ç›¸ä¼¼ç…§ç‰‡æµè§ˆå’Œæ“ä½œç•Œé¢
- **é˜ˆå€¼è°ƒèŠ‚**ï¼šæ”¯æŒåŠ¨æ€è°ƒæ•´ç›¸ä¼¼åº¦é˜ˆå€¼

### 9.4 æ¥å£å®ç°çŠ¶æ€æ€»ç»“

#### âœ… å·²å®Œå…¨å®ç°çš„åŠŸèƒ½
1. **åŸºç¡€æœç´¢**ï¼šå…³é”®è¯æœç´¢ã€æ¡ä»¶ç­›é€‰ã€æ’åºåˆ†é¡µ
2. **ç…§ç‰‡ç®¡ç†**ï¼šè¯¦æƒ…æŸ¥çœ‹ã€æ›´æ–°ã€åˆ é™¤ã€æ‰¹é‡åˆ é™¤
3. **æ ‡ç­¾ç®¡ç†**ï¼šCRUDæ“ä½œã€çƒ­é—¨æ ‡ç­¾ã€ç»Ÿè®¡ä¿¡æ¯
4. **åˆ†ç±»ç®¡ç†**ï¼šCRUDæ“ä½œã€åˆ†ç±»æ ‘ã€çƒ­é—¨åˆ†ç±»ã€ç»Ÿè®¡ä¿¡æ¯
5. **æœç´¢å»ºè®®**ï¼šåŸºäºå‰ç¼€çš„æœç´¢å»ºè®®
6. **æœç´¢ç»Ÿè®¡**ï¼šæœç´¢ç›¸å…³ç»Ÿè®¡ä¿¡æ¯
7. **æ™ºèƒ½æ ‡ç­¾ç­›é€‰**ï¼šåç«¯æœç´¢é©±åŠ¨ã€çƒ­é—¨æ ‡ç­¾ä¼˜å…ˆã€çªç ´æ•°é‡é™åˆ¶ï¼Œæ”¯æŒå¤§è§„æ¨¡æ ‡ç­¾åº“
8. **ç›¸ä¼¼ç…§ç‰‡æœç´¢**ï¼šé›†æˆåˆ°å›¾ç‰‡æ‚¬åœåŠŸèƒ½ä¸­ï¼Œæä¾›ç›´è§‚çš„ç›¸ä¼¼ç…§ç‰‡å‘ç°

#### âŒ å·²åˆ é™¤çš„åŠŸèƒ½
1. **æ™ºèƒ½æ¨è**ï¼šå·²åˆ é™¤ï¼Œä¸“æ³¨æ ¸å¿ƒæœç´¢åŠŸèƒ½
2. **æœç´¢å†å²**ï¼šå·²åˆ é™¤ï¼Œå‡å°‘ç³»ç»Ÿå¤æ‚åº¦
3. **ä¿å­˜æœç´¢æ¡ä»¶**ï¼šå·²åˆ é™¤ï¼Œç®€åŒ–æ“ä½œæµç¨‹
4. **é«˜çº§æœç´¢ç•Œé¢**ï¼šå·²åˆ é™¤ï¼Œæ‰€æœ‰åŠŸèƒ½é›†ä¸­åœ¨ç…§ç‰‡åº“é¡µé¢

#### ğŸ”„ åŠŸèƒ½è¿ç§»
1. **ç›¸ä¼¼ç…§ç‰‡æœç´¢**ï¼šä»é«˜çº§æœç´¢é¡µé¢è¿ç§»åˆ°å›¾ç‰‡æ‚¬åœåŠŸèƒ½ä¸­

#### ğŸ’¡ ç³»ç»Ÿç®€åŒ–è¯´æ˜
1. **ä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½**ï¼šä¿ç•™åŸºç¡€æœç´¢å’Œç­›é€‰åŠŸèƒ½
2. **ç®€åŒ–ç”¨æˆ·ç•Œé¢**ï¼šæ‰€æœ‰æœç´¢åŠŸèƒ½é›†ä¸­åœ¨ç…§ç‰‡åº“é¡µé¢
3. **å‡å°‘ç»´æŠ¤æˆæœ¬**ï¼šåˆ é™¤å¤æ‚åŠŸèƒ½ï¼Œé™ä½ç³»ç»Ÿå¤æ‚åº¦
4. **æå‡ç”¨æˆ·ä½“éªŒ**ï¼šé¿å…åŠŸèƒ½è¿‡äºå¤æ‚ï¼Œä¸“æ³¨æ ¸å¿ƒéœ€æ±‚

## åã€æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### 10.1 æœç´¢æ€§èƒ½ä¼˜åŒ–

#### 10.1.1 FTSå…¨æ–‡æœç´¢ä¼˜åŒ–
- **FTSè¡¨ç®¡ç†**ï¼šè‡ªåŠ¨åˆ›å»ºå’Œç»´æŠ¤FTSè™šæ‹Ÿè¡¨
- **æ•°æ®åŒæ­¥**ï¼šé€šè¿‡è§¦å‘å™¨è‡ªåŠ¨åŒæ­¥æ•°æ®åˆ°FTSè¡¨
- **åˆ†è¯ä¼˜åŒ–**ï¼šä½¿ç”¨é»˜è®¤åˆ†è¯å™¨æ”¯æŒä¸­æ–‡æœç´¢
- **æŸ¥è¯¢ä¼˜åŒ–**ï¼šä¼˜åŒ–FTSæŸ¥è¯¢è¯­æ³•ï¼Œæ”¯æŒAND/OR/NOTæ“ä½œ
- **é™çº§æœºåˆ¶**ï¼šFTSå¤±è´¥æ—¶è‡ªåŠ¨é™çº§åˆ°LIKEæŸ¥è¯¢

#### 10.1.2 ç´¢å¼•ä¼˜åŒ–
- **å¤åˆç´¢å¼•**ï¼šä¸ºå¸¸ç”¨æœç´¢ç»„åˆåˆ›å»ºå¤åˆç´¢å¼•
- **è¦†ç›–ç´¢å¼•**ï¼šå‡å°‘å›è¡¨æŸ¥è¯¢ï¼Œæå‡æœç´¢é€Ÿåº¦
- **éƒ¨åˆ†ç´¢å¼•**ï¼šä¸ºç‰¹å®šæ¡ä»¶åˆ›å»ºéƒ¨åˆ†ç´¢å¼•
- **FTSç´¢å¼•**ï¼šä¸ºå…¨æ–‡æœç´¢åˆ›å»ºFTS5è™šæ‹Ÿè¡¨ç´¢å¼•

#### 10.1.3 æŸ¥è¯¢ä¼˜åŒ–
- **åˆ†é¡µæŸ¥è¯¢**ï¼šä½¿ç”¨LIMITå’ŒOFFSETè¿›è¡Œåˆ†é¡µ
- **æŸ¥è¯¢ç¼“å­˜**ï¼šç¼“å­˜å¸¸ç”¨æŸ¥è¯¢ç»“æœ
- **å¼‚æ­¥æŸ¥è¯¢**ï¼šä½¿ç”¨å¼‚æ­¥æŸ¥è¯¢æå‡å¹¶å‘æ€§èƒ½
- **FTSæŸ¥è¯¢**ï¼šä¼˜å…ˆä½¿ç”¨FTSæœç´¢ï¼Œå¤±è´¥æ—¶é™çº§åˆ°LIKE

#### 10.1.4 ç»“æœä¼˜åŒ–
- **ç»“æœé¢„åŠ è½½**ï¼šé¢„åŠ è½½æœç´¢ç»“æœçš„ç›¸å…³æ•°æ®
- **æ‡’åŠ è½½**ï¼šå›¾ç‰‡æ‡’åŠ è½½ï¼Œæå‡é¡µé¢åŠ è½½é€Ÿåº¦
- **ç»“æœå‹ç¼©**ï¼šå‹ç¼©æœç´¢ç»“æœï¼Œå‡å°‘ç½‘ç»œä¼ è¾“
- **FTSç»“æœ**ï¼šä¼˜åŒ–FTSæœç´¢ç»“æœçš„å¤„ç†å’Œå±•ç¤º

### 10.2 ç”¨æˆ·ä½“éªŒä¼˜åŒ–

#### 10.2.1 æœç´¢å“åº”ä¼˜åŒ–
- **å³æ—¶æœç´¢**ï¼šè¾“å…¥æ—¶å³æ—¶æ˜¾ç¤ºæœç´¢ç»“æœ
- **æœç´¢é˜²æŠ–**ï¼šé¿å…é¢‘ç¹æœç´¢è¯·æ±‚
- **åŠ è½½çŠ¶æ€**ï¼šæ˜¾ç¤ºæœç´¢è¿›åº¦å’ŒçŠ¶æ€

#### 10.2.2 ç»“æœå±•ç¤ºä¼˜åŒ–
- **æ— é™æ»šåŠ¨**ï¼šæ”¯æŒæ— é™æ»šåŠ¨åŠ è½½æ›´å¤šç»“æœ
- **ç»“æœé¢„è§ˆ**ï¼šé¼ æ ‡æ‚¬åœæ˜¾ç¤ºç…§ç‰‡é¢„è§ˆ
- **å¿«é€Ÿæ“ä½œ**ï¼šæ”¯æŒå¿«é€Ÿæ”¶è—ã€åˆ é™¤ç­‰æ“ä½œ

## åä¸€ã€é…ç½®ç®¡ç†

### 11.1 ç»Ÿä¸€é…ç½®ç®¡ç†

#### 11.1.1 ç»Ÿä¸€é…ç½®å‚æ•°
```json
{
  "system": {
    "max_file_size": 52428800,
    "timeout": 10,
    "max_concurrent": 2
  },
  "database": {
    "path": "./data/photos.db"
  },
  "analysis": {
    "duplicate_threshold": 5
  }
}
```

### 11.2 æœç´¢é…ç½®

#### 11.2.1 æœç´¢å‚æ•°é…ç½®
```json
{
  "search": {
    "similarity_threshold": 0.6,
    "timeout": 5,
    "default_page_size": 20,
    "max_page_size": 100,
    "suggestion_limit": 10,
    "history_limit": 50
  }
}
```

#### 11.1.2 FTSç´¢å¼•é…ç½®
```json
{
  "fts": {
    "enabled": true,
    "auto_create": true,
    "auto_sync": true,
    "fallback_to_like": true,
    "rebuild_interval": 3600,
    "optimization_interval": 7200
  },
  "indexing": {
    "index_rebuild_interval": 3600,
    "auto_index_update": true,
    "index_optimization": true
  }
}
```

### 11.2 æœç´¢è§„åˆ™é…ç½®

#### 11.2.1 FTSæœç´¢å­—æ®µæƒé‡
```json
{
  "fts_weights": {
    "filename": 1.0,
    "description": 0.8,
    "tags_content": 0.6,
    "categories_content": 0.5,
    "analysis_content": 0.7,
    "original_path": 0.3
  },
  "search_weights": {
    "filename": 1.0,
    "description": 0.8,
    "scene_type": 0.6,
    "objects": 0.4,
    "activity": 0.4,
    "location_name": 0.3
  }
}
```

#### 11.2.2 FTSæœç´¢è¿‡æ»¤è§„åˆ™
```json
{
  "fts_filters": {
    "enable_prefix_search": true,
    "enable_phrase_search": true,
    "enable_boolean_search": true,
    "min_word_length": 1,
    "max_word_length": 50,
    "exclude_stop_words": false
  },
  "search_filters": {
    "exclude_duplicates": false,
    "exclude_low_quality": false,
    "quality_threshold": 0,
    "date_range_limit": 365
  }
}
```

## åäºŒã€ç›‘æ§ä¸æ—¥å¿—

### 12.1 æœç´¢æ€§èƒ½ç›‘æ§

#### 12.1.1 FTSæ€§èƒ½æŒ‡æ ‡
- **FTSæœç´¢å“åº”æ—¶é—´**ï¼šFTSæœç´¢å¹³å‡å“åº”æ—¶é—´
- **FTSæœç´¢æˆåŠŸç‡**ï¼šFTSæœç´¢æˆåŠŸæ¯”ä¾‹
- **FTSé™çº§ç‡**ï¼šFTSé™çº§åˆ°LIKEæŸ¥è¯¢çš„æ¯”ä¾‹
- **FTSç´¢å¼•ä½¿ç”¨ç‡**ï¼šFTSç´¢å¼•å‘½ä¸­ç‡
- **FTSæŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡**ï¼šFTSæŸ¥è¯¢ç¼“å­˜å‘½ä¸­ç‡

#### 12.1.2 é€šç”¨æ€§èƒ½æŒ‡æ ‡
- **æœç´¢å“åº”æ—¶é—´**ï¼šå¹³å‡æœç´¢æ—¶é—´
- **æœç´¢æˆåŠŸç‡**ï¼šæœç´¢æˆåŠŸæ¯”ä¾‹
- **ç´¢å¼•ä½¿ç”¨ç‡**ï¼šç´¢å¼•å‘½ä¸­ç‡
- **ç¼“å­˜å‘½ä¸­ç‡**ï¼šç¼“å­˜å‘½ä¸­ç‡

#### 12.1.2 ç”¨æˆ·è¡Œä¸ºç›‘æ§
- **æœç´¢å…³é”®è¯ç»Ÿè®¡**ï¼šçƒ­é—¨æœç´¢è¯
- **æœç´¢é¢‘ç‡ç»Ÿè®¡**ï¼šç”¨æˆ·æœç´¢é¢‘ç‡
- **æœç´¢ç»“æœç‚¹å‡»ç‡**ï¼šç»“æœç‚¹å‡»ç‡
- **æœç´¢è½¬åŒ–ç‡**ï¼šæœç´¢åˆ°æŸ¥çœ‹çš„è½¬åŒ–ç‡

### 12.2 æœç´¢æ—¥å¿—ç®¡ç†

#### 12.2.1 FTSæ—¥å¿—å†…å®¹
- **FTSæœç´¢è¯·æ±‚æ—¥å¿—**ï¼šFTSæœç´¢å…³é”®è¯ã€æ¡ä»¶ã€æ—¶é—´
- **FTSæœç´¢ç»“æœæ—¥å¿—**ï¼šFTSç»“æœæ•°é‡ã€å“åº”æ—¶é—´ã€é™çº§æƒ…å†µ
- **FTSæœç´¢é”™è¯¯æ—¥å¿—**ï¼šFTSé”™è¯¯ç±»å‹ã€é”™è¯¯ä¿¡æ¯ã€é™çº§åŸå› 
- **FTSæ€§èƒ½æ—¥å¿—**ï¼šFTSæŸ¥è¯¢æ—¶é—´ã€ç´¢å¼•ä½¿ç”¨æƒ…å†µã€ç¼“å­˜å‘½ä¸­ç‡

#### 12.2.2 é€šç”¨æ—¥å¿—å†…å®¹
- **æœç´¢è¯·æ±‚æ—¥å¿—**ï¼šæœç´¢å…³é”®è¯ã€æ¡ä»¶ã€æ—¶é—´
- **æœç´¢ç»“æœæ—¥å¿—**ï¼šç»“æœæ•°é‡ã€å“åº”æ—¶é—´
- **æœç´¢é”™è¯¯æ—¥å¿—**ï¼šé”™è¯¯ç±»å‹ã€é”™è¯¯ä¿¡æ¯
- **æ€§èƒ½æ—¥å¿—**ï¼šæŸ¥è¯¢æ—¶é—´ã€ç´¢å¼•ä½¿ç”¨æƒ…å†µ

#### 12.2.3 FTSæ—¥å¿—åˆ†æ
- **FTSæœç´¢è¶‹åŠ¿åˆ†æ**ï¼šFTSæœç´¢é‡å˜åŒ–è¶‹åŠ¿
- **FTSçƒ­é—¨æœç´¢åˆ†æ**ï¼šæœ€å—æ¬¢è¿çš„FTSæœç´¢è¯
- **FTSæ€§èƒ½ç“¶é¢ˆåˆ†æ**ï¼šFTSæ…¢æŸ¥è¯¢åˆ†æ
- **FTSé™çº§åˆ†æ**ï¼šFTSé™çº§åˆ°LIKEæŸ¥è¯¢çš„åŸå› åˆ†æ

#### 12.2.4 é€šç”¨æ—¥å¿—åˆ†æ
- **æœç´¢è¶‹åŠ¿åˆ†æ**ï¼šæœç´¢é‡å˜åŒ–è¶‹åŠ¿
- **çƒ­é—¨æœç´¢åˆ†æ**ï¼šæœ€å—æ¬¢è¿çš„æœç´¢è¯
- **æ€§èƒ½ç“¶é¢ˆåˆ†æ**ï¼šæ…¢æŸ¥è¯¢åˆ†æ
- **ç”¨æˆ·è¡Œä¸ºåˆ†æ**ï¼šæœç´¢è¡Œä¸ºæ¨¡å¼

## åä¸‰ã€æµ‹è¯•ç­–ç•¥

### 13.1 åŠŸèƒ½æµ‹è¯•

#### 13.1.1 FTSæœç´¢åŠŸèƒ½æµ‹è¯•
- **FTSå…³é”®è¯æœç´¢æµ‹è¯•**ï¼šå„ç§FTSå…³é”®è¯æœç´¢
- **FTSå¤šè¯æœç´¢æµ‹è¯•**ï¼šFTSå¤šè¯AND/OR/NOTæœç´¢
- **FTSå‰ç¼€æœç´¢æµ‹è¯•**ï¼šFTSå‰ç¼€æœç´¢åŠŸèƒ½
- **FTSé™çº§æµ‹è¯•**ï¼šFTSå¤±è´¥æ—¶é™çº§åˆ°LIKEæŸ¥è¯¢
- **FTSä¸­æ–‡æœç´¢æµ‹è¯•**ï¼šFTSä¸­æ–‡åˆ†è¯å’Œæœç´¢

#### 13.1.2 é€šç”¨æœç´¢åŠŸèƒ½æµ‹è¯•
- **å…³é”®è¯æœç´¢æµ‹è¯•**ï¼šå„ç§å…³é”®è¯æœç´¢
- **æ¡ä»¶ç­›é€‰æµ‹è¯•**ï¼šå„ç§ç­›é€‰æ¡ä»¶
- **é«˜çº§æœç´¢æµ‹è¯•**ï¼šå¤æ‚æœç´¢æ¡ä»¶
- **ç›¸ä¼¼æœç´¢æµ‹è¯•**ï¼šç›¸ä¼¼ç…§ç‰‡æœç´¢

#### 13.1.2 ç•Œé¢æµ‹è¯•
- **æœç´¢ç•Œé¢æµ‹è¯•**ï¼šç•Œé¢å“åº”å’Œäº¤äº’
- **ç»“æœå±•ç¤ºæµ‹è¯•**ï¼šç»“æœå±•ç¤ºå’Œåˆ†é¡µ
- **æœç´¢å»ºè®®æµ‹è¯•**ï¼šå»ºè®®åŠŸèƒ½å’Œå‡†ç¡®æ€§
- **æœç´¢å†å²æµ‹è¯•**ï¼šå†å²è®°å½•ç®¡ç†

### 13.2 æ€§èƒ½æµ‹è¯•

#### 13.2.1 FTSæ€§èƒ½æµ‹è¯•
- **FTSå“åº”æ—¶é—´æµ‹è¯•**ï¼šFTSæœç´¢å“åº”æ—¶é—´
- **FTSå¹¶å‘æœç´¢æµ‹è¯•**ï¼šå¤šç”¨æˆ·åŒæ—¶FTSæœç´¢
- **FTSå¤§æ•°æ®é‡æµ‹è¯•**ï¼šå¤§é‡ç…§ç‰‡FTSæœç´¢
- **FTSç´¢å¼•æ€§èƒ½æµ‹è¯•**ï¼šFTSç´¢å¼•åˆ›å»ºå’Œæ›´æ–°æ€§èƒ½
- **FTSé™çº§æ€§èƒ½æµ‹è¯•**ï¼šFTSé™çº§åˆ°LIKEæŸ¥è¯¢çš„æ€§èƒ½

#### 13.2.2 é€šç”¨æœç´¢æ€§èƒ½æµ‹è¯•
- **å“åº”æ—¶é—´æµ‹è¯•**ï¼šæœç´¢å“åº”æ—¶é—´
- **å¹¶å‘æœç´¢æµ‹è¯•**ï¼šå¤šç”¨æˆ·åŒæ—¶æœç´¢
- **å¤§æ•°æ®é‡æµ‹è¯•**ï¼šå¤§é‡ç…§ç‰‡æœç´¢
- **ç´¢å¼•æ€§èƒ½æµ‹è¯•**ï¼šç´¢å¼•åˆ›å»ºå’Œæ›´æ–°æ€§èƒ½

#### 13.2.2 å‹åŠ›æµ‹è¯•
- **é«˜å¹¶å‘æµ‹è¯•**ï¼šé«˜å¹¶å‘æœç´¢è¯·æ±‚
- **é•¿æ—¶é—´è¿è¡Œæµ‹è¯•**ï¼šé•¿æ—¶é—´è¿ç»­æœç´¢
- **å†…å­˜ä½¿ç”¨æµ‹è¯•**ï¼šæœç´¢è¿‡ç¨‹å†…å­˜ä½¿ç”¨
- **æ•°æ®åº“å‹åŠ›æµ‹è¯•**ï¼šæ•°æ®åº“æŸ¥è¯¢å‹åŠ›

## åå››ã€æ€»ç»“

æœç´¢æ£€ç´¢æ¨¡å—æ˜¯å®¶åº­ç…§ç‰‡ç³»ç»Ÿçš„æ ¸å¿ƒäº¤äº’æ¨¡å—ï¼Œé€šè¿‡æ•´åˆä¸°å¯Œçš„å…ƒæ•°æ®ï¼Œä¸ºç”¨æˆ·æä¾›å¤šç»´åº¦ã€æ™ºèƒ½åŒ–çš„ç…§ç‰‡æœç´¢åŠŸèƒ½ã€‚æ¨¡å—è®¾è®¡éµå¾ªç®€å•æ˜“ç”¨çš„åŸåˆ™ï¼Œåœ¨ä¿è¯åŠŸèƒ½å®Œæ•´æ€§çš„åŒæ—¶ï¼Œç¡®ä¿æœç´¢æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚

### **âœ… å·²å®ç°åŠŸèƒ½ï¼ˆç…§ç‰‡åº“é¡µé¢ï¼‰**

**åŸºç¡€æœç´¢åŠŸèƒ½**ï¼š
- å…³é”®è¯æœç´¢ï¼šæ”¯æŒå¤šç§æœç´¢ç±»å‹ï¼ˆå…¨éƒ¨å†…å®¹ã€æ–‡ä»¶åã€æ ‡ç­¾ã€åˆ†ç±»ã€æè¿°ã€AIåˆ†æç»“æœï¼‰
- FTSå…¨æ–‡æœç´¢ï¼šåŸºäºSQLite FTS5çš„é«˜æ•ˆå…¨æ–‡æœç´¢ï¼Œæ”¯æŒä¸­æ–‡åˆ†è¯
- æ¡ä»¶ç­›é€‰ï¼šæ—¥æœŸç­›é€‰ã€è´¨é‡ç­›é€‰ã€æ’åºåŠŸèƒ½
- æœç´¢å»ºè®®ï¼šåŸºäºçƒ­é—¨æ ‡ç­¾å’Œåˆ†ç±»çš„å®æ—¶æœç´¢å»ºè®®
- æœç´¢APIï¼šå®Œæ•´çš„æœç´¢æ¥å£å’Œå‚æ•°æ”¯æŒ
- æ ‡ç­¾å’Œåˆ†ç±»ç­›é€‰ï¼šå¤šé€‰ä¸‹æ‹‰æ¡†ï¼Œæ”¯æŒæœç´¢å’Œç­›é€‰
- ç›¸ä¼¼ç…§ç‰‡æœç´¢ï¼šé›†æˆåˆ°å›¾ç‰‡æ‚¬åœåŠŸèƒ½ä¸­ï¼Œæä¾›ç›´è§‚çš„ç›¸ä¼¼ç…§ç‰‡å‘ç°

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š
- æœç´¢å“åº”å¿«é€Ÿï¼Œç”¨æˆ·ä½“éªŒè‰¯å¥½
- FTSå…¨æ–‡æœç´¢é«˜æ•ˆï¼Œæ”¯æŒä¸­æ–‡åˆ†è¯å’Œå¤æ‚æŸ¥è¯¢
- æœç´¢å»ºè®®æ™ºèƒ½ï¼ŒåŸºäºå®é™…æ•°æ®
- ç•Œé¢ç®€æ´ç›´è§‚ï¼Œæ“ä½œç®€å•
- ä¸ç…§ç‰‡åº“é¡µé¢å®Œç¾é›†æˆ
- åŠŸèƒ½é›†ä¸­ï¼Œé¿å…ç•Œé¢è·³è½¬
- ç›¸ä¼¼ç…§ç‰‡å‘ç°æ›´ç›´è§‚ä¾¿æ·
- FTSé™çº§æœºåˆ¶ç¡®ä¿æœç´¢å¯é æ€§

### **âŒ å·²åˆ é™¤åŠŸèƒ½ï¼ˆé«˜çº§æœç´¢é¡µé¢ï¼‰**

**åˆ é™¤çš„é«˜çº§åŠŸèƒ½**ï¼š
- å¤šæ¡ä»¶ç»„åˆæœç´¢ï¼šå·²åˆ é™¤ï¼Œç®€åŒ–ç³»ç»Ÿæ¶æ„
- æ™ºèƒ½æ¨èï¼šå·²åˆ é™¤ï¼Œç®€åŒ–ç”¨æˆ·ä½“éªŒ
- æœç´¢ç»“æœå¤„ç†ï¼šå·²åˆ é™¤ï¼Œå‡å°‘ç³»ç»Ÿå¤æ‚åº¦
- æœç´¢å†å²ç®¡ç†ï¼šå·²åˆ é™¤ï¼Œç®€åŒ–æ“ä½œæµç¨‹
- ä¿å­˜æœç´¢æ¡ä»¶ï¼šå·²åˆ é™¤ï¼Œä¸“æ³¨æ ¸å¿ƒéœ€æ±‚

**åŠŸèƒ½è¿ç§»**ï¼š
- ç›¸ä¼¼ç…§ç‰‡æœç´¢ï¼šå·²é›†æˆåˆ°å›¾ç‰‡æ‚¬åœåŠŸèƒ½ä¸­ï¼Œæä¾›æ›´ç›´è§‚çš„ç›¸ä¼¼ç…§ç‰‡å‘ç°ä½“éªŒ

**åˆ é™¤åŸå› **ï¼š
- ç®€åŒ–ç³»ç»Ÿæ¶æ„ï¼Œé™ä½ç»´æŠ¤æˆæœ¬
- ä¸“æ³¨æ ¸å¿ƒæœç´¢åŠŸèƒ½ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- å‡å°‘åŠŸèƒ½å¤æ‚åº¦ï¼Œé¿å…ç”¨æˆ·å›°æƒ‘
- é›†ä¸­æ‰€æœ‰æœç´¢åŠŸèƒ½åœ¨ç…§ç‰‡åº“é¡µé¢

### **ğŸ“ˆ ç³»ç»Ÿç®€åŒ–è¯´æ˜**

**ç®€åŒ–åŸåˆ™**ï¼š
1. **ä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½**ï¼šä¿ç•™åŸºç¡€æœç´¢å’Œç­›é€‰åŠŸèƒ½
2. **ç®€åŒ–ç”¨æˆ·ç•Œé¢**ï¼šæ‰€æœ‰æœç´¢åŠŸèƒ½é›†ä¸­åœ¨ç…§ç‰‡åº“é¡µé¢
3. **å‡å°‘ç»´æŠ¤æˆæœ¬**ï¼šåˆ é™¤å¤æ‚åŠŸèƒ½ï¼Œé™ä½ç³»ç»Ÿå¤æ‚åº¦
4. **æå‡ç”¨æˆ·ä½“éªŒ**ï¼šé¿å…åŠŸèƒ½è¿‡äºå¤æ‚ï¼Œä¸“æ³¨æ ¸å¿ƒéœ€æ±‚

**ä¿ç•™çš„æ ¸å¿ƒåŠŸèƒ½**ï¼š
- åŸºç¡€æœç´¢ï¼šå…³é”®è¯æœç´¢ã€æœç´¢ç±»å‹é€‰æ‹©
- FTSå…¨æ–‡æœç´¢ï¼šåŸºäºSQLite FTS5çš„é«˜æ•ˆå…¨æ–‡æœç´¢
- æ¡ä»¶ç­›é€‰ï¼šæ—¥æœŸç­›é€‰ã€è´¨é‡ç­›é€‰ã€æ ‡ç­¾ç­›é€‰ã€åˆ†ç±»ç­›é€‰
- æœç´¢å»ºè®®ï¼šåŸºäºçƒ­é—¨æ ‡ç­¾å’Œåˆ†ç±»çš„æœç´¢å»ºè®®
- æ’åºåŠŸèƒ½ï¼šå¤šç§æ’åºæ–¹å¼å’Œæ’åºé¡ºåº
- ç›¸ä¼¼ç…§ç‰‡æœç´¢ï¼šé›†æˆåˆ°å›¾ç‰‡æ‚¬åœåŠŸèƒ½ä¸­ï¼Œæä¾›ç›´è§‚çš„ç›¸ä¼¼ç…§ç‰‡å‘ç°

### **ğŸ¯ é€‚ç”¨åœºæ™¯**

- **å®¶åº­ä½¿ç”¨**ï¼šå•ç”¨æˆ·ï¼Œæ”¯æŒ1-5ä¸‡å¼ ç…§ç‰‡æœç´¢
- **åŸºç¡€æœç´¢**ï¼šç…§ç‰‡åº“é¡µé¢çš„å¿«é€Ÿæœç´¢å’Œç­›é€‰
- **FTSå…¨æ–‡æœç´¢**ï¼šé«˜æ•ˆçš„ä¸­æ–‡å…¨æ–‡æœç´¢å’Œå¤æ‚æŸ¥è¯¢
- **ç›¸ä¼¼ç…§ç‰‡å‘ç°**ï¼šé€šè¿‡å›¾ç‰‡æ‚¬åœåŠŸèƒ½ç›´è§‚å‘ç°ç›¸ä¼¼ç…§ç‰‡
- **ç®€åŒ–æ“ä½œ**ï¼šæ‰€æœ‰æœç´¢åŠŸèƒ½é›†ä¸­åœ¨ç…§ç‰‡åº“é¡µé¢
- **æ ¸å¿ƒéœ€æ±‚**ï¼šä¸“æ³¨åŸºç¡€æœç´¢å’Œç­›é€‰åŠŸèƒ½
- **ç”¨æˆ·å‹å¥½**ï¼šç®€æ´ç›´è§‚çš„æœç´¢ç•Œé¢

é€šè¿‡éµå¾ªæœ¬è®¾è®¡æ–‡æ¡£ï¼Œå¼€å‘å›¢é˜Ÿå¯ä»¥åŸºäºå·²å®ç°çš„åŠŸèƒ½ç»§ç»­ä¼˜åŒ–ç…§ç‰‡åº“é¡µé¢çš„æœç´¢ä½“éªŒï¼Œä¸ºç”¨æˆ·æä¾›æ›´ç®€æ´ã€æ›´é«˜æ•ˆçš„ç…§ç‰‡æœç´¢åŠŸèƒ½ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šV2.4
**æœ€åæ›´æ–°**ï¼š2025å¹´9æœˆ28æ—¥
**æ–‡æ¡£çŠ¶æ€**ï¼šå·²åŒæ­¥æœ€æ–°å®ç°

**æ›´æ–°è¯´æ˜**ï¼š
- å®Œå…¨åŒæ­¥æœ€æ–°ä»£ç å®ç°ï¼Œæ›´æ–°æ‰€æœ‰æŠ€æœ¯ç»†èŠ‚
- ç¡®è®¤FTSåˆ†è¯å™¨é…ç½®ï¼šä½¿ç”¨SQLite FTS5é»˜è®¤åˆ†è¯å™¨
- éªŒè¯APIæ¥å£æ•°é‡ï¼š10ä¸ªæœç´¢ç›¸å…³æ¥å£å®Œå…¨å®ç°
- åŒæ­¥å‰ç«¯ç•Œé¢ï¼š4ä¸ªæœç´¢ç±»å‹ä¸å®é™…HTMLä¸€è‡´
- æ›´æ–°ç›¸ä¼¼ç…§ç‰‡æœç´¢ï¼šç¡®è®¤æ‚¬åœåŠŸèƒ½é›†æˆå®ç°
- å®Œå–„é…ç½®å‚æ•°ï¼šä¸æœ€æ–°config_default.jsonåŒæ­¥
- **æ–°å¢æ™ºèƒ½æ ‡ç­¾ç­›é€‰ä¼˜åŒ–**ï¼šå®ç°åç«¯æœç´¢é©±åŠ¨ã€çƒ­é—¨æ ‡ç­¾ä¼˜å…ˆã€å¤§è§„æ¨¡æ ‡ç­¾æ”¯æŒ
- ä¼˜åŒ–APIå‚æ•°ï¼šæ ‡ç­¾å’Œåˆ†ç±»é»˜è®¤limitä»100å¢åŠ åˆ°300
- æ›´æ–°æ–‡æ¡£ç‰ˆæœ¬åˆ°V2.4ï¼Œæ ‡è®°ä¸º"å·²åŒæ­¥æœ€æ–°å®ç°"