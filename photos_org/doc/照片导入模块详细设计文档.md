# å®¶åº­ç‰ˆæ™ºèƒ½ç…§ç‰‡ç³»ç»Ÿ - ç…§ç‰‡å¯¼å…¥æ¨¡å—è¯¦ç»†è®¾è®¡æ–‡æ¡£

## ä¸€ã€æ–‡æ¡£åŸºç¡€ä¿¡æ¯

| é¡¹ç›®åç§° | å®¶åº­ç‰ˆæ™ºèƒ½ç…§ç‰‡ç³»ç»Ÿ | æ–‡æ¡£ç±»å‹ | ç…§ç‰‡å¯¼å…¥æ¨¡å—è¯¦ç»†è®¾è®¡æ–‡æ¡£ |
| -------- | ------------------------- | -------- | ----------------------- |
| æ–‡æ¡£ç‰ˆæœ¬ | V1.2 | æ–‡æ¡£çŠ¶æ€ | â˜‘ å·²åŒæ­¥å®é™…å®ç° â–¡ è¯„å®¡ä¸­ â–¡ å·²ç¡®è®¤ â–¡ å·²å½’æ¡£ |
| ç¼–å†™äºº | AIåŠ©æ‰‹ | ç¼–å†™æ—¥æœŸ | 2025å¹´9æœˆ9æ—¥ |
| æ›´æ–°æ—¥æœŸ | 2025å¹´9æœˆ28æ—¥ | æ›´æ–°å†…å®¹ | æ ¹æ®å®é™…å®ç°ä¿®æ­£æ–‡æ¡£ï¼Œæ›´æ–°å¯¼å…¥æ–¹å¼çŠ¶æ€ï¼Œä¿®æ­£APIæ¥å£æè¿° |
| å…³è”æ–‡æ¡£ | ã€Šå®¶åº­ç‰ˆç®€è¦è®¾è®¡æ–‡æ¡£ã€‹ã€Šæ•°æ®åº“è®¾è®¡æ–‡æ¡£ã€‹ã€Šé€šç”¨æŠ€æœ¯è§„èŒƒè¯¦ç»†è®¾è®¡æ–‡æ¡£ã€‹ | | |

## äºŒã€æ¨¡å—æ¦‚è¿°

### 2.1 æ¨¡å—ç›®æ ‡

ç…§ç‰‡å¯¼å…¥æ¨¡å—æ˜¯å®¶åº­ç…§ç‰‡ç³»ç»Ÿçš„å…¥å£æ¨¡å—ï¼Œè´Ÿè´£ç…§ç‰‡æ–‡ä»¶çš„å¯¼å…¥ã€æ ¡éªŒã€å…ƒæ•°æ®æå–å’Œå­˜å‚¨ç®¡ç†ã€‚é€šè¿‡æ”¯æŒå¤šç§å¯¼å…¥æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯æ–‡ä»¶å¤¹æ‰«æå¯¼å…¥ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿæ•´ç†å¤§é‡å†å²ç…§ç‰‡ï¼Œä¸ºåç»­çš„æ™ºèƒ½åˆ†æå’Œåˆ†ç±»æä¾›æ•°æ®åŸºç¡€ã€‚

### 2.2 è®¾è®¡åŸåˆ™

- **æ™ºèƒ½é‡å¤æ£€æµ‹**ï¼šä½¿ç”¨æ„ŸçŸ¥å“ˆå¸Œç®—æ³•è¿›è¡Œå›¾åƒç›¸ä¼¼åº¦æ£€æµ‹
- **é«˜æ•ˆå¤„ç†**ï¼šå•å¼ ç…§ç‰‡å¤„ç† â‰¤ 2ç§’ï¼Œæ™ºèƒ½å¤„ç†é«˜æ•ˆ
- **æ•°æ®å®Œæ•´**ï¼šç¡®ä¿å…ƒæ•°æ®æå–çš„å®Œæ•´æ€§å’Œå‡†ç¡®æ€§
- **å®¶åº­ä¼˜åŒ–**ï¼šå•ç”¨æˆ·å®¶åº­ä½¿ç”¨ï¼Œç®€åŒ–æƒé™æ§åˆ¶
- **é”™è¯¯å®¹é”™**ï¼šå¤„ç†å„ç§å¼‚å¸¸æƒ…å†µï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®š
- **æ™ºèƒ½å­˜å‚¨**ï¼šé¿å…é‡å¤å­˜å‚¨ï¼Œä¼˜åŒ–å­˜å‚¨ç©ºé—´ä½¿ç”¨
- **ç”¨æˆ·å‹å¥½**ï¼šæä¾›æ¸…æ™°ã€è¯¦ç»†çš„é€šçŸ¥åé¦ˆï¼Œæ”¯æŒè¯¦ç»†ç»“æœæŸ¥çœ‹

### 2.3 æŠ€æœ¯é€‰å‹

- **æ–‡ä»¶å¤„ç†**ï¼šPIL (Python Imaging Library) + pillow-heif (HEICæ”¯æŒ)
- **é‡å¤æ£€æµ‹**ï¼šimagehash (æ„ŸçŸ¥å“ˆå¸Œç®—æ³•)
- **EXIFæå–**ï¼šPIL ExifTags (æ”¯æŒHEICæ ¼å¼)
- **æ–‡ä»¶ç³»ç»Ÿ**ï¼šPython os/pathlib
- **å¼‚æ­¥å¤„ç†**ï¼šasyncio + ä»»åŠ¡é˜Ÿåˆ—
- **æ•°æ®åº“**ï¼šSQLite + SQLAlchemy
- **å‰ç«¯æŠ€æœ¯**ï¼šHTML5 + CSS3 + JavaScript (Bootstrap 5)

**âš ï¸ é‡è¦æŠ€æœ¯é™åˆ¶ï¼šè¿›ç¨‹éš”ç¦»çŠ¶æ€ç®¡ç†**
- **å†…å­˜çŠ¶æ€å­˜å‚¨**ï¼šä½¿ç”¨å…¨å±€å­—å…¸ `task_status = {}` å­˜å‚¨ä»»åŠ¡çŠ¶æ€
- **å¼€å‘ç¯å¢ƒæ­£å¸¸**ï¼šå•è¿›ç¨‹æŒç»­è¿è¡Œï¼ŒçŠ¶æ€å…±äº«æ­£å¸¸
- **ç”Ÿäº§ç¯å¢ƒé—®é¢˜**ï¼šPyInstalleræ‰“åŒ…åè¿›ç¨‹éš”ç¦»ï¼ŒçŠ¶æ€æ— æ³•å…±äº«
- **å½±å“è¡¨ç°**ï¼šæ‰¹é‡å¯¼å…¥æ—¶æ˜¾ç¤º"ç¬¬20æ‰¹"ç­‰é‡å¤æ‰¹æ¬¡å·ï¼Œè¿›åº¦ç›‘æ§å¼‚å¸¸
- **å½“å‰çŠ¶æ€**ï¼šå¯¼å…¥æ¨¡å—**æ— æ¸…ç†æœºåˆ¶**ï¼Œä»»åŠ¡çŠ¶æ€æ°¸ä¹…ä¿å­˜åœ¨å†…å­˜ä¸­

## ä¸‰ã€å¯¼å…¥æ–¹å¼åˆ†æ

### 3.1 ä¸»è¦å¯¼å…¥æ–¹å¼

#### 3.1.1 æ–‡ä»¶å¤¹æ‰«æå¯¼å…¥ï¼ˆä¸»è¦æ–¹å¼ï¼‰
**ä½¿ç”¨åœºæ™¯**ï¼š
- ç”¨æˆ·å·²æœ‰å¤§é‡ç…§ç‰‡å­˜å‚¨åœ¨ç”µè„‘ä¸Š
- ç…§ç‰‡åˆ†æ•£åœ¨å¤šä¸ªæ–‡ä»¶å¤¹ä¸­
- ä»æ‰‹æœºã€ç›¸æœºæ‰¹é‡å¯¼å…¥åéœ€è¦æ•´ç†
- ä»å…¶ä»–ç…§ç‰‡ç®¡ç†è½¯ä»¶è¿ç§»æ•°æ®

**ä¼˜åŠ¿**ï¼š
- ä¸€æ¬¡æ€§å¯¼å…¥å¤§é‡ç…§ç‰‡
- è‡ªåŠ¨å‘ç°æ‰€æœ‰æ”¯æŒæ ¼å¼
- æ”¯æŒé€’å½’æ‰«æå­æ–‡ä»¶å¤¹
- é€‚åˆæ‰¹é‡æ•´ç†å†å²ç…§ç‰‡

**æŠ€æœ¯å®ç°**ï¼š
```python
def scan_folder(folder_path: str, recursive: bool = True) -> List[PhotoFile]:
    """
    æ‰«ææ–‡ä»¶å¤¹è·å–ç…§ç‰‡æ–‡ä»¶
    
    :param folder_path: æ–‡ä»¶å¤¹è·¯å¾„
    :param recursive: æ˜¯å¦é€’å½’æ‰«æå­æ–‡ä»¶å¤¹
    :return: ç…§ç‰‡æ–‡ä»¶åˆ—è¡¨
    """
    # é€’å½’æ‰«ææ–‡ä»¶å¤¹
    # è¿‡æ»¤æ”¯æŒçš„å›¾ç‰‡æ ¼å¼
    # æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§
    # è¿”å›ç…§ç‰‡æ–‡ä»¶ä¿¡æ¯
```

#### 3.1.2 æ–‡ä»¶é€‰æ‹©å¯¼å…¥ï¼ˆå¸¸ç”¨æ–¹å¼ï¼‰
**ä½¿ç”¨åœºæ™¯**ï¼š

- å°‘é‡ç…§ç‰‡çš„å¿«é€Ÿå¯¼å…¥
- ä»ç‰¹å®šæ–‡ä»¶å¤¹é€‰æ‹©ç…§ç‰‡
- ä¸´æ—¶æ·»åŠ å‡ å¼ ç…§ç‰‡
- ç²¾ç¡®æ§åˆ¶å¯¼å…¥å†…å®¹

**ä¼˜åŠ¿**ï¼š

- æ“ä½œç®€å•ç›´è§‚
- é€‚åˆå°‘é‡ç…§ç‰‡
- ç”¨æˆ·ä½“éªŒå¥½
- æ”¯æŒå¤šæ–‡ä»¶é€‰æ‹©

**æŠ€æœ¯å®ç°**ï¼š

```python
@router.post("/upload")
async def upload_photos(
    files: List[UploadFile] = File(...),
    background_tasks: BackgroundTasks = None,
    db: Session = Depends(get_db)
):
    """
    æ–‡ä»¶é€‰æ‹©å¯¼å…¥ç…§ç‰‡ï¼ˆå·²å®ç°ï¼‰
    
    :param files: ä¸Šä¼ çš„æ–‡ä»¶åˆ—è¡¨
    :param background_tasks: åå°ä»»åŠ¡
    :param db: æ•°æ®åº“ä¼šè¯
    """
    # éªŒè¯æ–‡ä»¶ç±»å‹å’Œæ•°é‡
    # ä¿å­˜ä¸´æ—¶æ–‡ä»¶
    # æ™ºèƒ½é‡å¤æ£€æµ‹
    # å¤„ç†ç…§ç‰‡å¹¶ä¿å­˜åˆ°æ•°æ®åº“
```

**å‰ç«¯å®ç°**ï¼š
```javascript
async function startFileImport() {
    const files = elements.photoFiles.files;
    
    // åˆ›å»ºFormDataå¯¹è±¡
    const formData = new FormData();
    Array.from(files).forEach(file => {
        formData.append('files', file);
    });
    
    // å‘é€è¯·æ±‚åˆ° /import/upload
    const response = await fetch(`${CONFIG.API_BASE_URL}/import/upload`, {
        method: 'POST',
        body: formData
    });
}
```

#### 3.1.3 æ‹–æ‹½å¯¼å…¥ï¼ˆæœªå®ç°ï¼‰
**ä½¿ç”¨åœºæ™¯**ï¼š

- ä»å…¶ä»–åº”ç”¨æ‹–æ‹½ç…§ç‰‡
- å¿«é€Ÿæ·»åŠ ç…§ç‰‡
- ä¸´æ—¶æ·»åŠ å‡ å¼ ç…§ç‰‡

**ä¼˜åŠ¿**ï¼š

- æ“ä½œç®€å•ç›´è§‚
- é€‚åˆå°‘é‡ç…§ç‰‡
- ç”¨æˆ·ä½“éªŒå¥½

**å®ç°çŠ¶æ€**ï¼šâŒ **æœªå®ç°**

**æŠ€æœ¯å®ç°è§„åˆ’**ï¼š

```python
def handle_drag_drop(files: List[File]) -> List[PhotoFile]:
    """
    å¤„ç†æ‹–æ‹½å¯¼å…¥çš„æ–‡ä»¶ï¼ˆè§„åˆ’ä¸­ï¼‰

    :param files: æ‹–æ‹½çš„æ–‡ä»¶åˆ—è¡¨
    :return: ç…§ç‰‡æ–‡ä»¶åˆ—è¡¨
    """
    # éªŒè¯æ–‡ä»¶æ ¼å¼
    # æ£€æŸ¥æ–‡ä»¶å¤§å°
    # éªŒè¯æ–‡ä»¶å®Œæ•´æ€§
    # è¿”å›ç…§ç‰‡æ–‡ä»¶ä¿¡æ¯
```

**å‰ç«¯å®ç°è§„åˆ’**ï¼š
```html
<!-- æ‹–æ‹½å¯¼å…¥åŒºåŸŸï¼ˆè§„åˆ’ä¸­ï¼‰ -->
<div class="drag-drop-area" id="drag-drop-area">
    <div class="drag-drop-content">
        <div class="drag-icon">ğŸ“</div>
        <h3>æ‹–æ‹½ç…§ç‰‡åˆ°æ­¤å¤„</h3>
        <p>æ”¯æŒ JPEGã€PNGã€TIFFã€WebPã€HEIC ç­‰æ ¼å¼</p>
    </div>
</div>
```

```javascript
// æ‹–æ‹½äº‹ä»¶å¤„ç†ï¼ˆè§„åˆ’ä¸­ï¼‰
function initDragDrop() {
    const dragArea = document.getElementById('drag-drop-area');

    dragArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        dragArea.classList.add('drag-over');
    });

    dragArea.addEventListener('drop', (e) => {
        e.preventDefault();
        const files = Array.from(e.dataTransfer.files);
        handleDragDropFiles(files);
    });
}
```

### 3.2 å¯¼å…¥æ–¹å¼ä¼˜å…ˆçº§

1. **æ–‡ä»¶å¤¹æ‰«æå¯¼å…¥**ï¼ˆ60%ä½¿ç”¨åœºæ™¯ï¼‰- å¤§é‡å†å²ç…§ç‰‡ âœ… **å·²å®ç°**
2. **æ–‡ä»¶é€‰æ‹©å¯¼å…¥**ï¼ˆ30%ä½¿ç”¨åœºæ™¯ï¼‰- å°‘é‡ç…§ç‰‡å¿«é€Ÿå¯¼å…¥ âœ… **å·²å®ç°**
3. **æ‹–æ‹½å¯¼å…¥**ï¼ˆ10%ä½¿ç”¨åœºæ™¯ï¼‰- ä¸´æ—¶æ·»åŠ ç…§ç‰‡ âŒ **æœªå®ç°**

## å››ã€æ–‡ä»¶å¤„ç†è®¾è®¡

### 4.1 æ”¯æŒçš„æ–‡ä»¶æ ¼å¼

#### 4.1.1 ä¸»è¦æ ¼å¼
```python
SUPPORTED_FORMATS = {
    'JPEG': ['.jpg', '.jpeg'],
    'PNG': ['.png'],
    'TIFF': ['.tiff', '.tif'],
    'WebP': ['.webp'],
    'BMP': ['.bmp'],
    'GIF': ['.gif'],
    'HEIC': ['.heic', '.heif']  # æ–°å¢HEICæ ¼å¼æ”¯æŒ
}
```

#### 4.1.2 æ ¼å¼ä¼˜å…ˆçº§
1. **JPEG** - æœ€å¸¸ç”¨ï¼ŒEXIFæ”¯æŒæœ€å¥½
2. **PNG** - å¸¸ç”¨ï¼ŒEXIFæ”¯æŒä¸€èˆ¬
3. **TIFF** - ä¸“ä¸šæ ¼å¼ï¼ŒEXIFæ”¯æŒæœ€å¥½
4. **WebP** - ç°ä»£æ ¼å¼ï¼ŒEXIFæ”¯æŒä¸€èˆ¬
5. **HEIC** - ç°ä»£æ ¼å¼ï¼ŒEXIFæ”¯æŒå¥½ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†
6. **BMP/GIF** - è¾ƒå°‘ä½¿ç”¨ï¼ŒEXIFæ”¯æŒå·®

### 4.2 æ–‡ä»¶æ ¡éªŒè§„åˆ™

#### 4.2.1 åŸºç¡€æ ¡éªŒ
```python
def validate_photo_file(file_path: str) -> ValidationResult:
    """
    éªŒè¯ç…§ç‰‡æ–‡ä»¶
    
    :param file_path: æ–‡ä»¶è·¯å¾„
    :return: éªŒè¯ç»“æœ
    """
    # æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥
    # æ–‡ä»¶å¤§å°æ£€æŸ¥ï¼ˆæœ€å¤§50MBï¼‰
    # æ–‡ä»¶æ ¼å¼æ£€æŸ¥ï¼ˆåŒ…æ‹¬HEICæ ¼å¼ï¼‰
    # æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥
    # å›¾åƒæœ‰æ•ˆæ€§æ£€æŸ¥ï¼ˆæ”¯æŒHEICæ ¼å¼ï¼‰
    
    # HEICæ ¼å¼ç‰¹æ®Šå¤„ç†
    if file_path.lower().endswith(('.heic', '.heif')):
        # æ³¨å†ŒHEIFæ”¯æŒ
        from pillow_heif import register_heif_opener
        register_heif_opener()
        
        # éªŒè¯HEICæ–‡ä»¶å®Œæ•´æ€§
        try:
            with Image.open(file_path) as img:
                img.verify()
        except Exception as e:
            return ValidationResult(valid=False, error=f"HEICæ–‡ä»¶éªŒè¯å¤±è´¥: {str(e)}")
```

#### 4.2.2 ç…§ç‰‡å¤§å°é™åˆ¶
- **å•æ–‡ä»¶æœ€å¤§**ï¼š50MB
- **æ€»å­˜å‚¨ç©ºé—´**ï¼šæ ¹æ®ç£ç›˜ç©ºé—´åŠ¨æ€è°ƒæ•´

#### 4.2.3 æ™ºèƒ½é‡å¤æ£€æµ‹ï¼ˆå·²å®ç°ï¼‰

**é‡å¤æ£€æµ‹ç­–ç•¥**ï¼š

- **æ–‡ä»¶å“ˆå¸Œæ£€æµ‹**ï¼šMD5å“ˆå¸Œæ£€æµ‹å®Œå…¨ç›¸åŒçš„æ–‡ä»¶
- **æ„ŸçŸ¥å“ˆå¸Œæ£€æµ‹**ï¼šä½¿ç”¨imagehash.phashæ£€æµ‹ç›¸ä¼¼å›¾åƒ
- **å¤šå±‚çº§æ£€æµ‹**ï¼šæ•°æ®åº“è®°å½• + ç‰©ç†æ–‡ä»¶å­˜åœ¨æ€§æ£€æµ‹

**MD5å“ˆå¸Œè®¡ç®—å®ç°**ï¼š
```python
def calculate_file_hash(self, file_path: str) -> str:
    """
    è®¡ç®—æ–‡ä»¶çš„MD5å“ˆå¸Œå€¼

    :param file_path: æ–‡ä»¶è·¯å¾„
    :return: MD5å“ˆå¸Œå€¼ï¼ˆåå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼‰
    """
    import hashlib

    hash_md5 = hashlib.md5()
    with open(file_path, "rb") as f:
        # åˆ†å—è¯»å–ï¼Œé¿å…å¤§æ–‡ä»¶å†…å­˜æº¢å‡º
        for chunk in iter(lambda: f.read(4096), b""):
            hash_md5.update(chunk)
    return hash_md5.hexdigest()
```

**äº”ç§å®Œæ•´é‡å¤æƒ…å†µå¤„ç†**ï¼š

MD5å“ˆå¸Œæ£€æµ‹ä¸»è¦ç”¨äºæ•°æ®åº“çº§åˆ«çš„é‡å¤æ£€æŸ¥ï¼Œä½†å®Œæ•´çš„é‡å¤æ£€æµ‹æµç¨‹è¿˜åŒ…æ‹¬ç‰©ç†æ–‡ä»¶çº§åˆ«çš„æ£€æŸ¥ï¼š

1. **å®Œå…¨é‡å¤ï¼ˆå·²å®Œæˆï¼‰**ï¼šæ•°æ®åº“æœ‰è®°å½• + ç‰©ç†æ–‡ä»¶å­˜åœ¨ + å·²å®Œæˆæ™ºèƒ½å¤„ç† â†’ è·³è¿‡
2. **å®Œå…¨é‡å¤ï¼ˆæœªå®Œæˆï¼‰**ï¼šæ•°æ®åº“æœ‰è®°å½• + ç‰©ç†æ–‡ä»¶å­˜åœ¨ + æœªå®Œæˆæ™ºèƒ½å¤„ç†
   - **å¯¼å…¥å±‚é¢**ï¼šè·³è¿‡æ–‡ä»¶å­˜å‚¨ï¼ˆæ–‡ä»¶å·²å­˜åœ¨ï¼‰ï¼Œè®¡å…¥è·³è¿‡æ•°é‡
   - **æ™ºèƒ½åˆ†æå±‚é¢**ï¼šæ¡ä»¶æ€§é‡ç½®çŠ¶æ€
     - å¦‚æœçŠ¶æ€ä¸º'error'â†’é‡ç½®ä¸º'imported'ï¼Œå‡†å¤‡é‡æ–°åˆ†æ
     - å¦‚æœçŠ¶æ€ä¸º'imported'/'analyzing'/'quality_completed'/'content_completed'â†’ä¿æŒåŸçŠ¶æ€ï¼Œç»§ç»­åˆ†æ
3. **å­¤å„¿è®°å½•**ï¼šæ•°æ®åº“æœ‰è®°å½• + ç‰©ç†æ–‡ä»¶ä¸å­˜åœ¨ â†’ æ¸…ç†æ•°æ®åº“è®°å½•ï¼Œé‡æ–°å¤„ç†
4. **ç‰©ç†é‡å¤**ï¼šæ•°æ®åº“æ— è®°å½• + ç‰©ç†æ–‡ä»¶å­˜åœ¨ç›¸åŒå“ˆå¸Œ â†’ ä½¿ç”¨ç°æœ‰æ–‡ä»¶
5. **å…¨æ–°æ–‡ä»¶**ï¼šæ•°æ®åº“æ— è®°å½• + ç‰©ç†æ–‡ä»¶ä¸å­˜åœ¨ç›¸åŒå“ˆå¸Œ â†’ æ­£å¸¸å¤„ç†

**MD5å“ˆå¸Œæ£€æµ‹æ ¸å¿ƒé€»è¾‘**ï¼š

```python
def _check_duplicate_file(self, file_hash: str, db_session) -> Dict:
    """
    æ£€æŸ¥æ–‡ä»¶æ˜¯å¦é‡å¤çš„å®Œæ•´é€»è¾‘ï¼ˆå·²å®ç°ï¼‰

    :param file_hash: æ–‡ä»¶å“ˆå¸Œå€¼
    :param db_session: æ•°æ®åº“ä¼šè¯
    :return: é‡å¤æ£€æŸ¥ç»“æœ
    """
    # æƒ…å†µ1ï¼šæ•°æ®åº“æœ‰è®°å½• + ç‰©ç†æ–‡ä»¶å­˜åœ¨ = å®Œå…¨é‡å¤
    existing_photo = db_session.query(Photo).filter(Photo.file_hash == file_hash).first()

    if existing_photo:
        # æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆçš„æ–‡ä»¶è·¯å¾„
        if existing_photo.original_path:
            # æ„å»ºå®Œæ•´çš„æ–‡ä»¶è·¯å¾„
            storage_base = Path(self.storage_base)
            full_path = storage_base / existing_photo.original_path

            if full_path.exists():
                # æ£€æŸ¥æ™ºèƒ½å¤„ç†çŠ¶æ€
                if existing_photo.status == 'completed':
                    return {
                        "is_duplicate": True,
                        "message": "æ–‡ä»¶å·²å­˜åœ¨ä¸”å·²å®Œæˆæ™ºèƒ½å¤„ç†",
                        "duplicate_type": "full_duplicate_completed",
                        "existing_photo": existing_photo
                    }
                elif existing_photo.status in ['imported', 'analyzing', 'error', 'quality_completed', 'content_completed']:
                    # æ³¨æ„ï¼šæ­¤æƒ…å†µåœ¨å¯¼å…¥å±‚é¢ä¼šè·³è¿‡æ–‡ä»¶å­˜å‚¨ï¼Œä½†åœ¨æ™ºèƒ½åˆ†æå±‚é¢ä¼šæ¡ä»¶æ€§é‡ç½®çŠ¶æ€
                    # åªæœ‰å½“statusä¸º'error'æ—¶æ‰ä¼šé‡ç½®ä¸º'imported'ï¼Œå…¶ä»–çŠ¶æ€ä¿æŒä¸å˜ç»§ç»­åˆ†æ
                    return {
                        "is_duplicate": True,
                        "message": "æ–‡ä»¶å·²å­˜åœ¨ä½†æœªå®Œæˆæ™ºèƒ½å¤„ç†",
                        "duplicate_type": "full_duplicate_incomplete",
                        "existing_photo": existing_photo
                    }

        # æƒ…å†µ2ï¼šæ•°æ®åº“æœ‰è®°å½• + ç‰©ç†æ–‡ä»¶ä¸å­˜åœ¨ = å­¤å„¿è®°å½•
        db_session.delete(existing_photo)
        db_session.commit()
        return {
            "is_duplicate": False,
            "message": "å­¤å„¿è®°å½•å·²æ¸…ç†",
            "duplicate_type": "orphan_cleaned"
        }

    # æƒ…å†µ3ï¼šæ•°æ®åº“æ— è®°å½• = å…¨æ–°æ–‡ä»¶ï¼ˆMD5å“ˆå¸Œæ£€æµ‹æ— é‡å¤ï¼‰
    return {
        "is_duplicate": False,
        "message": "å…¨æ–°æ–‡ä»¶",
        "duplicate_type": "new_file"
    }
```

**æ„ŸçŸ¥å“ˆå¸Œç®—æ³•**ï¼š
```python
def calculate_perceptual_hash(self, image_path: str) -> str:
    """
    è®¡ç®—å›¾åƒçš„æ„ŸçŸ¥å“ˆå¸Œå€¼ï¼ˆå·²å®ç°ï¼‰
    
    :param image_path: å›¾åƒæ–‡ä»¶è·¯å¾„
    :return: åå…­è¿›åˆ¶å“ˆå¸Œå­—ç¬¦ä¸²
    """
    try:
        # æ‰“å¼€å›¾ç‰‡å¹¶è½¬æ¢ä¸ºç°åº¦
        image = Image.open(image_path)
        
        # è½¬æ¢ä¸ºRGBæ¨¡å¼ï¼ˆå¤„ç†å¯èƒ½çš„è°ƒè‰²æ¿æ¨¡å¼ï¼‰
        if image.mode != 'RGB':
            image = image.convert('RGB')
        
        # è®¡ç®—æ„ŸçŸ¥å“ˆå¸Œ
        hash_value = imagehash.phash(image, hash_size=16)
        
        # è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²
        return str(hash_value)
    except Exception as e:
        self.logger.error(f"è®¡ç®—æ„ŸçŸ¥å“ˆå¸Œå¤±è´¥: {str(e)}")
        return None
```

## äº”ã€å…ƒæ•°æ®æå–è®¾è®¡

### 5.1 EXIFæ•°æ®æå–

#### 5.1.1 æå–ç­–ç•¥
```python
def extract_exif_metadata(image_path: str) -> ExifData:
    """
    æå–EXIFå…ƒæ•°æ®
    
    :param image_path: å›¾åƒè·¯å¾„
    :return: EXIFæ•°æ®
    """
    # 1. å°è¯•æå–æ‹æ‘„æ—¶é—´
    taken_at = extract_datetime_original(image_path)
    
    # 2. æå–ç›¸æœºä¿¡æ¯
    camera_info = extract_camera_info(image_path)
    
    # 3. æå–æŠ€æœ¯å‚æ•°
    tech_params = extract_technical_params(image_path)
    
    # 4. æå–GPSä¿¡æ¯
    gps_info = extract_gps_info(image_path)
    
    return ExifData(taken_at, camera_info, tech_params, gps_info)
```

#### 5.1.2 æ—¶é—´ä¿¡æ¯æå–
```python
def extract_photo_time(image_path: str) -> TimeInfo:
    """
    æå–ç…§ç‰‡æ—¶é—´ä¿¡æ¯
    
    :param image_path: å›¾åƒè·¯å¾„
    :return: æ—¶é—´ä¿¡æ¯
    """
    # 1. ä¼˜å…ˆå°è¯•EXIFæ‹æ‘„æ—¶é—´
    exif_time = extract_exif_datetime(image_path)
    if exif_time:
        return TimeInfo(exif_time, 'exif', 0.9)  # é«˜ç½®ä¿¡åº¦
    
    # 2. ä½¿ç”¨æ–‡ä»¶ä¿®æ”¹æ—¶é—´
    file_time = get_file_mtime(image_path)
    return TimeInfo(file_time, 'file_mtime', 0.7)  # ä¸­ç­‰ç½®ä¿¡åº¦
```

#### 5.1.3 æ•°æ®å¯ç”¨æ€§åˆ†æ
| æ•°æ®æ¥æº | å¯ç”¨æ€§ | ç½®ä¿¡åº¦ | å¤‡æ³¨ |
|---------|--------|--------|------|
| iPhoneç›´æ¥æ‹æ‘„ | 95% | 0.9 | å®Œæ•´EXIFä¿¡æ¯ |
| æ•°ç ç›¸æœºæ‹æ‘„ | 99% | 0.95 | æœ€å®Œæ•´EXIFä¿¡æ¯ |
| å¾®ä¿¡ä¿å­˜ç…§ç‰‡ | 5% | 0.1 | é€šå¸¸åˆ é™¤EXIF |
| ç¤¾äº¤åª’ä½“ä¸‹è½½ | 10% | 0.2 | éƒ¨åˆ†åˆ é™¤EXIF |
| æ–‡ä»¶ä¿®æ”¹æ—¶é—´ | 100% | 0.7 | å¤‡é€‰æ–¹æ¡ˆ |

### 5.2 åŸºç¡€ä¿¡æ¯æå–

#### 5.2.1 æ–‡ä»¶ä¿¡æ¯
```python
def extract_file_info(file_path: str) -> FileInfo:
    """
    æå–æ–‡ä»¶åŸºç¡€ä¿¡æ¯
    
    :param file_path: æ–‡ä»¶è·¯å¾„
    :return: æ–‡ä»¶ä¿¡æ¯
    """
    # æ–‡ä»¶å¤§å°
    file_size = os.path.getsize(file_path)
    
    # æ–‡ä»¶æ ¼å¼
    file_format = get_image_format(file_path)
    
    # æ–‡ä»¶å“ˆå¸Œ
    file_hash = calculate_md5_hash(file_path)
    
    # åˆ›å»ºæ—¶é—´
    created_at = datetime.now()
    
    return FileInfo(file_size, file_format, file_hash, created_at)
```

#### 5.2.2 å›¾åƒä¿¡æ¯
```python
def extract_image_info(image_path: str) -> ImageInfo:
    """
    æå–å›¾åƒåŸºç¡€ä¿¡æ¯
    
    :param image_path: å›¾åƒè·¯å¾„
    :return: å›¾åƒä¿¡æ¯
    """
    with Image.open(image_path) as img:
        # å›¾åƒå°ºå¯¸
        width, height = img.size
        
        # é¢œè‰²æ¨¡å¼
        mode = img.mode
        
        # å›¾åƒæ–¹å‘
        orientation = get_image_orientation(img)
        
        return ImageInfo(width, height, mode, orientation)
```

## å…­ã€å­˜å‚¨ç®¡ç†è®¾è®¡

### 6.1 æ™ºèƒ½æ–‡ä»¶å­˜å‚¨ç®¡ç†ï¼ˆå·²å®ç°ï¼‰

#### 6.1.1 ç›®å½•ç»“æ„
```
photos_storage/
â”œâ”€â”€ originals/           # åŸå§‹ç…§ç‰‡
â”‚   â”œâ”€â”€ 2023/
â”‚   â”‚   â”œâ”€â”€ 01/
â”‚   â”‚   â”‚   â”œâ”€â”€ 01/     # æŒ‰å¹´æœˆæ—¥ç»„ç»‡
â”‚   â”‚   â”‚   â””â”€â”€ 02/
â”‚   â”‚   â””â”€â”€ 02/
â”‚   â””â”€â”€ 2024/
â”œâ”€â”€ thumbnails/          # ç¼©ç•¥å›¾
â”‚   â”œâ”€â”€ 2023/
â”‚   â”‚   â”œâ”€â”€ 01/
â”‚   â”‚   â””â”€â”€ 02/
â”‚   â””â”€â”€ 2024/
â””â”€â”€ temp/               # ä¸´æ—¶æ–‡ä»¶
```

#### 6.1.2 æ™ºèƒ½æ–‡ä»¶ç®¡ç†ç­–ç•¥ï¼ˆå·²å®ç°ï¼‰

**é¿å…é‡å¤å­˜å‚¨**ï¼š
- é€šè¿‡æ–‡ä»¶å“ˆå¸Œæ£€æµ‹é¿å…å­˜å‚¨ç›¸åŒæ–‡ä»¶
- æ™ºèƒ½æ–‡ä»¶è·¯å¾„æŸ¥æ‰¾å’Œç®¡ç†
- å­¤å„¿è®°å½•è‡ªåŠ¨æ¸…ç†

**æ–‡ä»¶å‘½åè§„åˆ™**ï¼š
```python
def generate_file_name(photo_info: PhotoInfo) -> str:
    """
    ç”Ÿæˆæ–‡ä»¶åï¼ˆå·²å®ç°ï¼‰
    
    :param photo_info: ç…§ç‰‡ä¿¡æ¯
    :return: æ–‡ä»¶å
    """
    # æ ¼å¼ï¼šYYYYMMDD_HHMMSS_åŸæ–‡ä»¶å.jpg
    # ç¤ºä¾‹ï¼š20231219_143025_IMG_001.jpg
    
    timestamp = photo_info.taken_at.strftime('%Y%m%d_%H%M%S')
    original_name = photo_info.original_filename
    return f"{timestamp}_{original_name}"
```

### 6.2 ç¼©ç•¥å›¾ç”Ÿæˆ

#### 6.2.1 ç¼©ç•¥å›¾è§„æ ¼
- **å°ºå¯¸**ï¼š300x300åƒç´ ï¼ˆå¯é…ç½®ï¼š`storage.thumbnail_size`ï¼‰
- **æ ¼å¼**ï¼šJPEG
- **è´¨é‡**ï¼š50%ï¼ˆå¯é…ç½®ï¼š`storage.thumbnail_quality`ï¼Œé»˜è®¤85%ï¼‰
- **å‘½å**ï¼šå“ˆå¸Œå€¼_thumb.jpg

#### 6.2.2 ç”Ÿæˆç­–ç•¥
```python
def generate_thumbnail(self, source_path: str, max_size: int = None, file_hash: str = None) -> str:
    """
    ç”Ÿæˆç¼©ç•¥å›¾ï¼ˆå·²å®ç°ï¼‰

    :param source_path: æºæ–‡ä»¶è·¯å¾„
    :param max_size: ç¼©ç•¥å›¾æœ€å¤§å°ºå¯¸ï¼ˆä»é…ç½®è¯»å–ï¼Œé»˜è®¤300ï¼‰
    :param file_hash: æ–‡ä»¶å“ˆå¸Œå€¼ï¼ˆç”¨äºç”ŸæˆåŸºäºå“ˆå¸Œçš„æ–‡ä»¶åï¼‰
    :return: ç¼©ç•¥å›¾è·¯å¾„
    """
    if max_size is None:
        max_size = settings.storage.thumbnail_size  # ä»é…ç½®è¯»å–ï¼Œé»˜è®¤300

    try:
        with Image.open(source_path) as img:
            # è®¡ç®—ç¼©ç•¥å›¾å°ºå¯¸ï¼Œä¿æŒå®½é«˜æ¯”
            img.thumbnail((max_size, max_size), Image.Resampling.LANCZOS)

            # ç”Ÿæˆç¼©ç•¥å›¾æ–‡ä»¶åï¼ˆåŸºäºå“ˆå¸Œå€¼ï¼‰
            if file_hash:
                thumbnail_filename = f"{file_hash}_thumb.jpg"
            else:
                source_name = Path(source_path).stem
                thumbnail_filename = f"{source_name}_thumb.jpg"

            thumbnail_path = self.thumbnails_path / thumbnail_filename

            # è½¬æ¢ä¸ºRGBæ¨¡å¼ï¼ˆå¦‚æœéœ€è¦ï¼‰
            if img.mode in ('RGBA', 'P'):
                img = img.convert('RGB')

            # ä¿å­˜ç¼©ç•¥å›¾ï¼Œä½¿ç”¨é…ç½®çš„è´¨é‡å‚æ•°
            img.save(thumbnail_path, 'JPEG', quality=settings.storage.thumbnail_quality)
            return str(thumbnail_path)

    except Exception as e:
        logger.error(f"ç¼©ç•¥å›¾ç”Ÿæˆå¤±è´¥: {e}")
        raise
```

## å…­ã€å¯¼å…¥æˆåŠŸåçš„ç”¨æˆ·æŒ‡å¼•

### 6.1 å¯¼å…¥å®Œæˆåçš„çŠ¶æ€æ˜¾ç¤º

**ç…§ç‰‡çŠ¶æ€è¯´æ˜**ï¼š
- **ğŸ†• æ–°å¯¼å…¥**ï¼šç…§ç‰‡åˆšå¯¼å…¥å®Œæˆï¼Œæ˜¾ç¤ºä¸º"æ–°å¯¼å…¥"çŠ¶æ€
- **ç…§ç‰‡ä¿¡æ¯**ï¼šæ˜¾ç¤ºæ–‡ä»¶åŸºæœ¬ä¿¡æ¯ï¼ˆæ–‡ä»¶åã€å¤§å°ã€æ‹æ‘„æ—¶é—´ç­‰ï¼‰
- **è´¨é‡æ˜¾ç¤º**ï¼šæ˜¾ç¤º"æœªè¯„ä¼°"çŠ¶æ€ï¼Œç­‰å¾…è´¨é‡åˆ†æ

### 6.2 æ¨èçš„åç»­æ“ä½œæµç¨‹

**ç¬¬ä¸€æ­¥ï¼šåŸºç¡€åˆ†æï¼ˆæ¨èï¼‰**
```
å¯¼å…¥å®Œæˆ â†’ ç‚¹å‡»å¯¼èˆªæ "åŸºç¡€åˆ†æ"æŒ‰é’® â†’ é€‰æ‹©è¦åˆ†æçš„ç…§ç‰‡ â†’ å¼€å§‹åˆ†æ
åˆ†æå†…å®¹ï¼šè´¨é‡è¯„ä¼° + åŸºç¡€æ ‡ç­¾ç”Ÿæˆï¼ˆæ—¶é—´ã€EXIFæ ‡ç­¾ï¼‰
åˆ†æç»“æœï¼šçŠ¶æ€å˜ä¸º"åŸºç¡€å®Œæˆ"ï¼Œæ˜¾ç¤ºè´¨é‡ç­‰çº§å›¾æ ‡
```

**ç¬¬äºŒæ­¥ï¼šAIåˆ†æï¼ˆå¯é€‰ï¼‰**
```
åŸºç¡€åˆ†æå®Œæˆ â†’ ç‚¹å‡»å¯¼èˆªæ "AIåˆ†æ"æŒ‰é’® â†’ é€‰æ‹©è¦åˆ†æçš„ç…§ç‰‡ â†’ å¼€å§‹åˆ†æ
åˆ†æå†…å®¹ï¼šAIå†…å®¹è¯†åˆ« + AIæ ‡ç­¾ç”Ÿæˆï¼ˆåœºæ™¯ã€ç‰©ä½“ã€æ´»åŠ¨ã€æƒ…æ„Ÿï¼‰
åˆ†æç»“æœï¼šçŠ¶æ€å˜ä¸º"å®Œæ•´å®Œæˆ"ï¼Œå¯è¿›è¡Œæ™ºèƒ½æœç´¢å’Œåˆ†ç±»
```

**æˆ–è€…ç›´æ¥è¿›è¡Œå®Œæ•´åˆ†æ**ï¼š
```
å¯¼å…¥å®Œæˆ â†’ é€‰æ‹©ç…§ç‰‡ â†’ ç‚¹å‡»"AIåˆ†æ"æŒ‰é’®ï¼ˆç³»ç»Ÿä¼šè‡ªåŠ¨å…ˆè¿›è¡ŒåŸºç¡€åˆ†æï¼‰
```

### 6.3 åˆ†ææ–¹å¼å¯¹æ¯”

| åˆ†æç±»å‹ | å¤„ç†é€Ÿåº¦ | è´¹ç”¨ | åŠŸèƒ½ | é€‚ç”¨åœºæ™¯ |
|----------|----------|------|------|----------|
| **åŸºç¡€åˆ†æ** | å¿«é€Ÿï¼ˆ2-3ç§’ï¼‰ | å…è´¹ | è´¨é‡è¯„ä¼°ã€åŸºç¡€æ ‡ç­¾ | å¿«é€Ÿé¢„è§ˆã€æ‰¹é‡å¤„ç† |
| **AIåˆ†æ** | è¾ƒæ…¢ï¼ˆ5-10ç§’ï¼‰ | APIè´¹ç”¨ | æ·±åº¦AIåˆ†æã€æ™ºèƒ½æ ‡ç­¾ | ç²¾ç¡®åˆ†ç±»ã€æ™ºèƒ½æœç´¢ |

### 6.4 é€‰æ‹©æ€§åˆ†æåŠŸèƒ½

**ç…§ç‰‡å±•ç¤ºåŒºåˆ†æ**ï¼š
- é€‰ä¸­ç‰¹å®šç…§ç‰‡ â†’ ç‚¹å‡»"åŸºç¡€åˆ†æ"æˆ–"AIåˆ†æ"æŒ‰é’®
- æ”¯æŒé‡æ–°åˆ†æå·²å¤„ç†çš„ç…§ç‰‡
- ç³»ç»Ÿè‡ªåŠ¨æ¸…ç†æ—§æ ‡ç­¾ï¼Œé¿å…é‡å¤ç´¯ç§¯

**å¯¼èˆªæ æ‰¹é‡åˆ†æ**ï¼š
- å¯¹æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ç…§ç‰‡è¿›è¡Œæ‰¹é‡å¤„ç†
- æ˜¾ç¤ºå¾…åˆ†æç…§ç‰‡æ•°é‡ï¼Œæ™ºèƒ½æŒ‰é’®çŠ¶æ€
- é€‚åˆå¤§é‡ç…§ç‰‡çš„ç»Ÿä¸€å¤„ç†

## ä¸ƒã€æ™ºèƒ½å¤„ç†æµç¨‹è®¾è®¡ï¼ˆå·²å®ç°ï¼‰

### 7.1 æ™ºèƒ½é‡å¤æ£€æµ‹æµç¨‹

#### 7.1.1 é‡å¤æ£€æµ‹é˜¶æ®µï¼ˆå·²å®ç°ï¼‰
```
1. ç”¨æˆ·é€‰æ‹©æ‰«ææ–‡ä»¶å¤¹
2. ç³»ç»Ÿé€’å½’æ‰«ææ‰€æœ‰å­æ–‡ä»¶å¤¹
3. è¿‡æ»¤å‡ºæ”¯æŒçš„å›¾ç‰‡æ ¼å¼
4. è®¡ç®—æ–‡ä»¶MD5å“ˆå¸Œ
5. æ‰§è¡Œæ™ºèƒ½é‡å¤æ£€æµ‹ï¼š
   - æƒ…å†µ1ï¼šå®Œå…¨é‡å¤ä¸”å·²å®Œæˆæ™ºèƒ½å¤„ç† â†’ è·³è¿‡
   - æƒ…å†µ2ï¼šå®Œå…¨é‡å¤ä½†æœªå®Œæˆæ™ºèƒ½å¤„ç† â†’ ç»§ç»­å¤„ç†
   - æƒ…å†µ3ï¼šå­¤å„¿è®°å½• â†’ æ¸…ç†åé‡æ–°å¤„ç†
   - æƒ…å†µ4ï¼šç‰©ç†é‡å¤ â†’ ä½¿ç”¨ç°æœ‰æ–‡ä»¶
   - æƒ…å†µ5ï¼šå…¨æ–°æ–‡ä»¶ â†’ æ­£å¸¸å¤„ç†
6. ç”Ÿæˆæ™ºèƒ½å¤„ç†æŠ¥å‘Š
```

#### 7.1.2 æ™ºèƒ½å¤„ç†é˜¶æ®µï¼ˆå·²å®ç°ï¼‰
```
1. æ™ºèƒ½é‡å¤æ£€æµ‹å’Œæ–‡ä»¶ç®¡ç†
2. æå–æ–‡ä»¶åŸºç¡€ä¿¡æ¯
3. æå–EXIFå…ƒæ•°æ®
4. è®¡ç®—æ„ŸçŸ¥å“ˆå¸Œï¼ˆç”¨äºç›¸ä¼¼å›¾åƒæ£€æµ‹ï¼‰
5. ç”Ÿæˆç¼©ç•¥å›¾
6. æŒ‰å¹´æœˆæ—¥ç»„ç»‡å­˜å‚¨ï¼ˆé¿å…é‡å¤å­˜å‚¨ï¼‰
7. æ›´æ–°æ•°æ®åº“ï¼ˆåŒ…å«é‡å¤æ£€æµ‹ä¿¡æ¯ï¼‰
8. è§¦å‘åç»­AIåˆ†ææµç¨‹
```

### 7.2 æ™ºèƒ½å•æ–‡ä»¶å¤„ç†æµç¨‹ï¼ˆå·²å®ç°ï¼‰

#### 7.2.1 æ™ºèƒ½é‡å¤æ£€æµ‹å¤„ç†ï¼ˆå·²å®ç°ï¼‰
```python
def process_single_photo(self, file_path: str, move_file: bool = True, db_session=None) -> Tuple[bool, str, Optional[PhotoCreate], Optional[Dict]]:
    """
    æ™ºèƒ½å¤„ç†ç…§ç‰‡ï¼ˆåŒ…å«é‡å¤æ£€æµ‹ï¼‰
    
    :param self: ImportServiceå®ä¾‹
    :param file_path: æ–‡ä»¶è·¯å¾„
    :param move_file: æ˜¯å¦ç§»åŠ¨æ–‡ä»¶
    :param db_session: æ•°æ®åº“ä¼šè¯
    :return: (æˆåŠŸæ ‡å¿—, æ¶ˆæ¯, ç…§ç‰‡æ•°æ®, é‡å¤ä¿¡æ¯)
    """
    try:
    # 1. æ–‡ä»¶æ ¡éªŒ
        validation_result = self.validate_photo_file(file_path)
        if not validation_result['valid']:
            return False, validation_result['error'], None, None
        
        # 2. è®¡ç®—æ–‡ä»¶å“ˆå¸Œ
        file_hash = self.calculate_file_hash(file_path)
        
        # 3. æ™ºèƒ½é‡å¤æ£€æµ‹
        if db_session:
            duplicate_result = self._check_duplicate_file(file_hash, db_session)
            
            # æƒ…å†µ1.1ï¼šå®Œå…¨é‡å¤ä¸”å·²å®Œæˆæ™ºèƒ½å¤„ç† - è·³è¿‡æ‰€æœ‰å¤„ç†
            if duplicate_result['is_duplicate'] and duplicate_result.get('duplicate_type') == 'full_duplicate_completed':
                return False, duplicate_result['message'], None, duplicate_result
            
            # æƒ…å†µ1.2ï¼šå®Œå…¨é‡å¤ä½†æœªå®Œæˆæ™ºèƒ½å¤„ç† - ç»§ç»­æ™ºèƒ½å¤„ç†
            elif duplicate_result['is_duplicate'] and duplicate_result.get('duplicate_type') == 'full_duplicate_incomplete':
                existing_photo = duplicate_result['existing_photo']
                if existing_photo.status == 'error':
                    existing_photo.status = 'imported'
                    db_session.commit()
                return True, "æ–‡ä»¶å·²å­˜åœ¨ï¼Œç»§ç»­æ™ºèƒ½å¤„ç†", None, duplicate_result
            
            # æƒ…å†µ2ï¼šå­¤å„¿è®°å½• - æ¸…ç†åç»§ç»­æ­£å¸¸å¤„ç†
            elif not duplicate_result['is_duplicate'] and duplicate_result.get('duplicate_type') == 'orphan_cleaned':
                return self._handle_orphan_cleaned(duplicate_result, file_path, file_hash, db_session)
            
            # æƒ…å†µ3ï¼šç‰©ç†é‡å¤ - ä½¿ç”¨ç°æœ‰æ–‡ä»¶ï¼Œç»§ç»­å¤„ç†
            elif duplicate_result['is_duplicate'] and duplicate_result.get('duplicate_type') == 'physical_only':
                return self._handle_physical_duplicate(duplicate_result, file_path, file_hash)
            
            # æƒ…å†µ4ï¼šå…¨æ–°æ–‡ä»¶ - æ­£å¸¸å¤„ç†
            elif not duplicate_result['is_duplicate'] and duplicate_result.get('duplicate_type') == 'new_file':
                pass  # ç»§ç»­æ­£å¸¸å¤„ç†æµç¨‹
        
        # 4. æ­£å¸¸å¤„ç†æµç¨‹ï¼ˆé€‚ç”¨äºæƒ…å†µ2å’Œæƒ…å†µ4ï¼‰
        success, message, photo_data, duplicate_info = self._handle_new_file(file_path, file_hash, move_file, db_session)
        
        return success, message, photo_data, duplicate_info
        
    except Exception as e:
        print(f"å¤„ç†ç…§ç‰‡æ—¶å‘ç”Ÿé”™è¯¯: {e}")
        return False, f"å¤„ç†å¤±è´¥: {str(e)}", None, None
```

#### 7.2.2 æ„ŸçŸ¥å“ˆå¸Œè®¡ç®—ï¼ˆå·²å®ç°ï¼‰
æ„ŸçŸ¥å“ˆå¸Œè®¡ç®—åŠŸèƒ½å·²åœ¨ç¬¬4.2.3èŠ‚ä¸­è¯¦ç»†æè¿°ï¼Œä½¿ç”¨`imagehash.phash`ç®—æ³•è¿›è¡Œå›¾åƒç›¸ä¼¼åº¦æ£€æµ‹ã€‚

### 7.3 æ™ºèƒ½æ™ºèƒ½å¤„ç†æµç¨‹ï¼ˆå·²å®ç°ï¼‰

#### 7.3.1 æ–‡ä»¶å¤¹æ‰«æå¤„ç†ï¼ˆå·²å®ç°ï¼‰

å®é™…å®ç°é€šè¿‡APIæ¥å£è¿›è¡Œæ–‡ä»¶å¤¹æ‰«æï¼š

```python
# APIæ¥å£ï¼šPOST /scan-folder
@router.post("/scan-folder")
async def scan_folder(
    folder_path: str,
    recursive: bool = True,
    background_tasks: BackgroundTasks = None,
    db: Session = Depends(get_db)
):
    """
    æ‰«ææ–‡ä»¶å¤¹å¯¼å…¥ç…§ç‰‡ï¼ˆå·²å®ç°ï¼‰

    :param folder_path: æ–‡ä»¶å¤¹è·¯å¾„
    :param recursive: æ˜¯å¦é€’å½’æ‰«æå­æ–‡ä»¶å¤¹
    :param background_tasks: åå°ä»»åŠ¡
    :param db: æ•°æ®åº“ä¼šè¯
    """
    try:
        import_service = ImportService()

        # æ™ºèƒ½æ‰«ææ–‡ä»¶å¤¹ï¼ˆåŒ…å«é‡å¤æ£€æµ‹ï¼‰
        photo_files = import_service.scan_folder(folder_path, recursive)

        # æ™ºèƒ½å¤„ç†æ¯ä¸ªæ–‡ä»¶
        results = []
        for file_path in photo_files:
            success, message, photo_data, duplicate_info = import_service.process_single_photo(
                file_path, True, db
            )
            results.append({
                'file_path': file_path,
                'success': success,
                'message': message,
                'duplicate_info': duplicate_info
            })

        return JSONResponse({
            "success": True,
            "message": f"æˆåŠŸæ‰«æå¹¶å¤„ç† {len(photo_files)} ä¸ªæ–‡ä»¶",
            "data": {
                "scanned_files": len(photo_files),
                "processed_results": results
            }
        })

    except Exception as e:
        return JSONResponse({
            "success": False,
            "message": f"æ‰«æå¤±è´¥: {str(e)}"
        }, status_code=500)
```

## å…«ã€é”™è¯¯å¤„ç†è®¾è®¡

### 8.1 æ–‡ä»¶å¤„ç†é”™è¯¯

#### 8.1.1 æ–‡ä»¶æ ¼å¼é”™è¯¯
```python
class UnsupportedFormatError(Exception):
    """ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼"""
    def __init__(self, file_path: str, format: str):
        self.file_path = file_path
        self.format = format
        super().__init__(f"ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼: {format}")

def handle_format_error(error: UnsupportedFormatError) -> ErrorResult:
    """
    å¤„ç†æ–‡ä»¶æ ¼å¼é”™è¯¯
    
    :param error: æ ¼å¼é”™è¯¯
    :return: é”™è¯¯å¤„ç†ç»“æœ
    """
    return ErrorResult(
        error_type="UNSUPPORTED_FORMAT",
        message=f"æ–‡ä»¶ {error.file_path} æ ¼å¼ {error.format} ä¸æ”¯æŒ",
        suggestion="è¯·é€‰æ‹©æ”¯æŒçš„å›¾ç‰‡æ ¼å¼ï¼šJPEGã€PNGã€TIFFã€WebPç­‰"
    )
```

#### 8.1.2 æ–‡ä»¶æŸåé”™è¯¯
```python
class CorruptedFileError(Exception):
    """æ–‡ä»¶æŸå"""
    def __init__(self, file_path: str, reason: str):
        self.file_path = file_path
        self.reason = reason
        super().__init__(f"æ–‡ä»¶æŸå: {reason}")

def handle_corrupted_file(error: CorruptedFileError) -> ErrorResult:
    """
    å¤„ç†æ–‡ä»¶æŸåé”™è¯¯
    
    :param error: æ–‡ä»¶æŸåé”™è¯¯
    :return: é”™è¯¯å¤„ç†ç»“æœ
    """
    return ErrorResult(
        error_type="CORRUPTED_FILE",
        message=f"æ–‡ä»¶ {error.file_path} å·²æŸå",
        suggestion="è¯·æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§æˆ–é‡æ–°è·å–æ–‡ä»¶"
    )
```

### 8.2 å…ƒæ•°æ®æå–é”™è¯¯

#### 8.2.1 EXIFæå–å¤±è´¥
```python
def handle_exif_extraction_failure(file_path: str) -> ExifResult:
    """
    å¤„ç†EXIFæå–å¤±è´¥
    
    :param file_path: æ–‡ä»¶è·¯å¾„
    :return: EXIFæå–ç»“æœ
    """
    # ä½¿ç”¨æ–‡ä»¶æ—¶é—´ä½œä¸ºå¤‡é€‰
    file_time = get_file_mtime(file_path)
    
    return ExifResult(
        taken_at=file_time,
        source='file_mtime',
        confidence=0.7,
        warning="EXIFæ•°æ®ä¸å¯ç”¨ï¼Œä½¿ç”¨æ–‡ä»¶æ—¶é—´"
    )
```

### 8.3 å­˜å‚¨é”™è¯¯

#### 8.3.1 ç£ç›˜ç©ºé—´ä¸è¶³
```python
class InsufficientSpaceError(Exception):
    """ç£ç›˜ç©ºé—´ä¸è¶³"""
    def __init__(self, required: int, available: int):
        self.required = required
        self.available = available
        super().__init__(f"ç£ç›˜ç©ºé—´ä¸è¶³: éœ€è¦ {required}, å¯ç”¨ {available}")

def handle_insufficient_space(error: InsufficientSpaceError) -> ErrorResult:
    """
    å¤„ç†ç£ç›˜ç©ºé—´ä¸è¶³é”™è¯¯
    
    :param error: ç©ºé—´ä¸è¶³é”™è¯¯
    :return: é”™è¯¯å¤„ç†ç»“æœ
    """
    return ErrorResult(
        error_type="INSUFFICIENT_SPACE",
        message=f"ç£ç›˜ç©ºé—´ä¸è¶³: éœ€è¦ {error.required}MB, å¯ç”¨ {error.available}MB",
        suggestion="è¯·æ¸…ç†ç£ç›˜ç©ºé—´æˆ–é€‰æ‹©å…¶ä»–å­˜å‚¨ä½ç½®"
    )
```

## ä¹ã€æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### 9.1 å¤„ç†æ€§èƒ½ä¼˜åŒ–

#### 9.1.1 ç›®æ ‡æ€§èƒ½
- **å•å¼ ç…§ç‰‡å¤„ç†**ï¼šâ‰¤ 2ç§’
- **æ™ºèƒ½å¤„ç†ï¼ˆ10å¼ ï¼‰**ï¼šâ‰¤ 20ç§’
- **æ–‡ä»¶å¤¹æ‰«æ**ï¼š1000å¼ ç…§ç‰‡ â‰¤ 3åˆ†é’Ÿ
- **ç¼©ç•¥å›¾ç”Ÿæˆ**ï¼šâ‰¤ 0.5ç§’

#### 9.1.2 ä¼˜åŒ–ç­–ç•¥
```python
class PhotoProcessor:
    """ç…§ç‰‡å¤„ç†å™¨"""
    
    def __init__(self, max_concurrent: int = 2):
        self.max_concurrent = max_concurrent
        self.semaphore = asyncio.Semaphore(max_concurrent)
    
    async def process_photo(self, file_path: str) -> ProcessingResult:
        """
        å¤„ç†å•å¼ ç…§ç‰‡
        
        :param file_path: æ–‡ä»¶è·¯å¾„
        :return: å¤„ç†ç»“æœ
        """
        async with self.semaphore:
            # å¹¶å‘æ§åˆ¶
            # å¼‚æ­¥å¤„ç†
            # é”™è¯¯å¤„ç†
            pass
```

### 9.2 å†…å­˜ä¼˜åŒ–

#### 9.2.1 å†…å­˜ç®¡ç†
```python
def process_image_memory_efficient(image_path: str) -> ImageInfo:
    """
    å†…å­˜é«˜æ•ˆå¤„ç†å›¾åƒ
    
    :param image_path: å›¾åƒè·¯å¾„
    :return: å›¾åƒä¿¡æ¯
    """
    # ä½¿ç”¨PILçš„æ‡’åŠ è½½
    with Image.open(image_path) as img:
        # åªåŠ è½½å¿…è¦çš„å±æ€§
        width, height = img.size
        mode = img.mode
        
        # ä¸åŠ è½½å®Œæ•´å›¾åƒæ•°æ®
        return ImageInfo(width, height, mode)
```

#### 9.2.2 æ™ºèƒ½å¤„ç†ä¼˜åŒ–
```python
async def batch_process_optimized(file_paths: List[str]) -> List[ProcessingResult]:
    """
    ä¼˜åŒ–çš„æ™ºèƒ½å¤„ç†
    
    :param file_paths: æ–‡ä»¶è·¯å¾„åˆ—è¡¨
    :return: å¤„ç†ç»“æœåˆ—è¡¨
    """
    # åˆ†æ‰¹å¤„ç†ï¼Œé¿å…å†…å­˜æº¢å‡º
    batch_size = 10
    results = []
    
    for i in range(0, len(file_paths), batch_size):
        batch = file_paths[i:i + batch_size]
        batch_results = await asyncio.gather(*[
            process_photo(path) for path in batch
        ])
        results.extend(batch_results)
        
        # å¼ºåˆ¶åƒåœ¾å›æ”¶
        gc.collect()
    
    return results
```

## åã€ç”¨æˆ·ç•Œé¢è®¾è®¡

### 10.1 å¯¼å…¥æ–¹å¼é€‰æ‹©ç•Œé¢ï¼ˆå·²å®ç°ï¼‰

#### 10.1.1 å¯¼å…¥æ–¹å¼åˆ‡æ¢ç•Œé¢
```html
<!-- å¯¼å…¥æ–¹å¼é€‰æ‹©ç•Œé¢ï¼ˆå·²å®ç°ï¼‰ -->
<div class="import-method-selection">
    <div class="btn-group" role="group">
        <input type="radio" class="btn-check" name="importMethod" id="fileImport" value="file" checked>
        <label class="btn btn-outline-primary" for="fileImport">
            <i class="bi bi-file-earmark-image me-1"></i>
            é€‰æ‹©æ–‡ä»¶
        </label>
        
        <input type="radio" class="btn-check" name="importMethod" id="folderImport" value="folder">
        <label class="btn btn-outline-primary" for="folderImport">
            <i class="bi bi-folder2-open me-1"></i>
            é€‰æ‹©æ–‡ä»¶å¤¹
        </label>
    </div>
</div>
```

#### 10.1.2 æ–‡ä»¶é€‰æ‹©ç•Œé¢ï¼ˆå·²å®ç°ï¼‰
```html
<!-- æ–‡ä»¶é€‰æ‹©ç•Œé¢ï¼ˆå·²å®ç°ï¼‰ -->
<div id="fileImportSection" class="import-section">
    <div class="mb-3">
        <label for="photoFiles" class="form-label">é€‰æ‹©ç…§ç‰‡æ–‡ä»¶</label>
        <input type="file" class="form-control" id="photoFiles" multiple 
               accept="image/*,.heic,.heif">
        <div class="form-text">æ”¯æŒ JPGã€PNGã€GIFã€HEIC ç­‰å¸¸è§å›¾ç‰‡æ ¼å¼</div>
    </div>
    
    <div class="alert alert-info">
        <i class="bi bi-info-circle me-2"></i>
        <strong>åŠŸèƒ½ï¼š</strong>é€‰æ‹©å¤šä¸ªç…§ç‰‡æ–‡ä»¶è¿›è¡Œæ‰¹é‡å¯¼å…¥
    </div>
</div>
```

#### 10.1.3 æ–‡ä»¶å¤¹æ‰«æç•Œé¢ï¼ˆå·²å®ç°ï¼‰
```html
<!-- æ–‡ä»¶å¤¹é€‰æ‹©ç•Œé¢ï¼ˆå·²å®ç°ï¼‰ -->
<div id="folderImportSection" class="import-section d-none">
    <div class="mb-3">
        <label for="folderPath" class="form-label">é€‰æ‹©ç…§ç‰‡æ–‡ä»¶å¤¹</label>
        <div class="input-group">
            <input type="file" class="form-control" id="folderFiles" webkitdirectory directory multiple 
                   accept="image/*,.heic,.heif" style="display: none;">
            <input type="text" class="form-control" id="folderPath" placeholder="ç‚¹å‡»æµè§ˆæŒ‰é’®é€‰æ‹©ç…§ç‰‡ç›®å½•" readonly>
            <button class="btn btn-outline-secondary" type="button" id="browseFolderBtn">
                <i class="bi bi-folder2-open me-1"></i>
                æµè§ˆæ–‡ä»¶å¤¹
            </button>
        </div>
        
        <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            <strong>åŠŸèƒ½ï¼š</strong>é€‰æ‹©æ–‡ä»¶å¤¹åä¼šè‡ªåŠ¨æ‰«ææ‰€æœ‰å­ç›®å½•ä¸­çš„ç…§ç‰‡æ–‡ä»¶ï¼ˆåŒ…æ‹¬HEICæ ¼å¼ï¼‰
        </div>
    </div>
    
    <div class="form-check">
        <input class="form-check-input" type="checkbox" id="recursiveScan" checked>
        <label class="form-check-label" for="recursiveScan">
            é€’å½’æ‰«æå­æ–‡ä»¶å¤¹
        </label>
    </div>
    
    <div class="alert alert-warning">
        <i class="bi bi-exclamation-triangle me-2"></i>
        <strong>æç¤ºï¼š</strong>é€‰æ‹©æ–‡ä»¶å¤¹åä¼šè‡ªåŠ¨æ‰«ææ‰€æœ‰å­ç›®å½•ã€‚æ‰«æå¤§é‡æ–‡ä»¶æ—¶ä¼šåœ¨åå°å¤„ç†ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚
    </div>
</div>
```

#### 10.1.4 æ™ºèƒ½å¤„ç†ç•Œé¢ï¼ˆå·²å®ç°ï¼‰
```html
<!-- æ™ºèƒ½å¤„ç†æ¨¡æ€æ¡†ï¼ˆå·²å®ç°ï¼‰ -->
<div class="modal fade" id="batchProcessModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">æ™ºèƒ½å¤„ç†</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- å¤„ç†ç»Ÿè®¡ä¿¡æ¯ -->
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>
                    <strong>å¤„ç†ç»Ÿè®¡ï¼š</strong>
                    <span id="photo-count-info">æ­£åœ¨è·å–ç…§ç‰‡æ•°é‡...</span>
                    <br>
                    <small class="text-muted">
                        ç¡®ä¿ä½ å·²ç”³è¯·å¹¶é…ç½®äº†Qwen-vl å¤§æ¨¡å‹çš„APIå¯†é’¥
                        <a href="/help-api-key" target="_blank" class="ms-1">å¦‚æœ‰ç–‘é—®ï¼Œè¯·ç‚¹å‡»é“¾æ¥</a>
                    </small>
                </div>
                
                <!-- å¤„ç†è¿›åº¦ -->
                <div class="progress mb-3" style="height: 25px;">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" 
                         role="progressbar" style="width: 0%" id="batch-progress-bar">
                        <span id="batch-progress-text">å‡†å¤‡ä¸­...</span>
                    </div>
                </div>
                
                <!-- å¤„ç†çŠ¶æ€ -->
                <div class="text-center">
                    <span id="batch-status-text">å‡†å¤‡å¼€å§‹æ™ºèƒ½å¤„ç†...</span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                <button type="button" class="btn btn-primary" id="start-batch-process">å¼€å§‹å¤„ç†</button>
            </div>
        </div>
    </div>
</div>
```

#### 10.1.5 æ‰«æè¿›åº¦ç•Œé¢
```html
<!-- æ‰«æè¿›åº¦ç•Œé¢ -->
<div class="scan-progress-panel">
    <div class="progress-header">
        <h3>æ­£åœ¨æ‰«ææ–‡ä»¶å¤¹</h3>
        <span id="scan-status">å‡†å¤‡ä¸­...</span>
    </div>
    
    <div class="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
    </div>
    
    <div class="progress-info">
        <div class="progress-stats">
            <span>å·²æ‰«æ: <span id="scanned-count">0</span> å¼ </span>
            <span>å‘ç°: <span id="found-count">0</span> å¼ </span>
            <span>è·³è¿‡: <span id="skipped-count">0</span> å¼ </span>
        </div>
        
        <div class="current-file">
            <span>å½“å‰æ–‡ä»¶: <span id="current-file">-</span></span>
        </div>
    </div>
    
    <div class="scan-actions">
        <button id="pause-scan">æš‚åœ</button>
        <button id="stop-scan">åœæ­¢</button>
    </div>
</div>
```

### 10.2 æ‹–æ‹½å¯¼å…¥ç•Œé¢ï¼ˆå¾…å®ç°ï¼‰

#### 10.2.1 æ‹–æ‹½åŒºåŸŸï¼ˆå¾…å®ç°ï¼‰
```html
<!-- æ‹–æ‹½å¯¼å…¥åŒºåŸŸï¼ˆå¾…å®ç°ï¼‰ -->
<div class="drag-drop-area" id="drag-drop-area">
    <div class="drag-drop-content">
        <div class="drag-icon">ğŸ“</div>
        <h3>æ‹–æ‹½ç…§ç‰‡åˆ°æ­¤å¤„</h3>
        <p>æ”¯æŒ JPEGã€PNGã€TIFFã€WebP ç­‰æ ¼å¼</p>
        <p>å•æ–‡ä»¶æœ€å¤§ 50MB</p>
    </div>
    
    <div class="drag-drop-overlay" id="drag-overlay">
        <div class="drag-overlay-content">
            <div class="drag-icon">ğŸ“·</div>
            <h3>æ¾å¼€é¼ æ ‡å¯¼å…¥ç…§ç‰‡</h3>
        </div>
    </div>
</div>
```

#### 10.2.2 å¯¼å…¥è¿›åº¦ï¼ˆå¾…å®ç°ï¼‰
```html
<!-- å¯¼å…¥è¿›åº¦ç•Œé¢ï¼ˆå¾…å®ç°ï¼‰ -->
<div class="import-progress-panel">
    <div class="progress-header">
        <h3>æ­£åœ¨å¯¼å…¥ç…§ç‰‡</h3>
        <span id="import-status">å‡†å¤‡ä¸­...</span>
    </div>
    
    <div class="file-list" id="file-list">
        <!-- æ–‡ä»¶åˆ—è¡¨é¡¹ -->
        <div class="file-item" data-file="photo1.jpg">
            <div class="file-info">
                <span class="file-name">photo1.jpg</span>
                <span class="file-size">2.5MB</span>
            </div>
            <div class="file-status">
                <span class="status-text">å¤„ç†ä¸­...</span>
                <div class="status-icon">â³</div>
            </div>
        </div>
    </div>
    
    <div class="import-actions">
        <button id="cancel-import">å–æ¶ˆå¯¼å…¥</button>
    </div>
</div>
```

**å®ç°çŠ¶æ€**ï¼šâŒ **å°šæœªå®ç°**
- æ‹–æ‹½åŒºåŸŸHTMLç»“æ„ï¼šå¾…å®ç°
- æ‹–æ‹½äº‹ä»¶å¤„ç†ï¼šå¾…å®ç°
- æ‹–æ‹½æ ·å¼è®¾è®¡ï¼šå¾…å®ç°
- å¯¼å…¥è¿›åº¦ç•Œé¢ï¼šå¾…å®ç°

## åä¸€ã€æ™ºèƒ½APIæ¥å£è®¾è®¡ï¼ˆå·²å®ç°ï¼‰

### 11.1 æ™ºèƒ½å¯¼å…¥æ¥å£

#### 11.1.1 æ™ºèƒ½æ–‡ä»¶å¤¹æ‰«ææ¥å£ï¼ˆå·²å®ç°ï¼‰
```python
@router.post("/scan-folder")
async def scan_folder(
    folder_path: str,
    recursive: bool = True,
    background_tasks: BackgroundTasks = None,
    db: Session = Depends(get_db)
):
    """
    æ™ºèƒ½æ‰«ææ–‡ä»¶å¤¹å¯¼å…¥ç…§ç‰‡ï¼ˆå·²å®ç°ï¼‰
    
    :param folder_path: æ–‡ä»¶å¤¹è·¯å¾„
    :param recursive: æ˜¯å¦é€’å½’æ‰«æå­æ–‡ä»¶å¤¹
    :param background_tasks: åå°ä»»åŠ¡
    :param db: æ•°æ®åº“ä¼šè¯
    """
    try:
        import_service = ImportService()
        
        # æ™ºèƒ½æ‰«ææ–‡ä»¶å¤¹ï¼ˆåŒ…å«é‡å¤æ£€æµ‹ï¼‰
        photo_files = import_service.scan_folder(folder_path, recursive)
        
        # æ™ºèƒ½å¤„ç†æ¯ä¸ªæ–‡ä»¶
        results = []
        for file_path in photo_files:
            success, message, photo_data, duplicate_info = import_service.process_single_photo(
                file_path, True, db
            )
            results.append({
                'file_path': file_path,
                'success': success,
                'message': message,
                'duplicate_info': duplicate_info
            })
        
        return JSONResponse({
            "success": True,
            "message": f"æˆåŠŸæ‰«æå¹¶å¤„ç† {len(photo_files)} ä¸ªæ–‡ä»¶",
            "data": {
                "scanned_files": len(photo_files),
                "processed_results": results
            }
        })
        
    except Exception as e:
        return JSONResponse({
            "success": False,
            "message": f"æ‰«æå¤±è´¥: {str(e)}"
        }, status_code=500)
```

#### 11.1.2 æ™ºèƒ½æ–‡ä»¶é€‰æ‹©å¯¼å…¥æ¥å£ï¼ˆå·²å®ç°ï¼‰
```python
@router.post("/upload")
async def upload_photos(
    files: List[UploadFile] = File(...),
    background_tasks: BackgroundTasks = None,
    db: Session = Depends(get_db)
):
    """
    æ™ºèƒ½æ–‡ä»¶é€‰æ‹©å¯¼å…¥ç…§ç‰‡ï¼ˆåŒ…å«é‡å¤æ£€æµ‹ï¼‰
    
    :param files: ä¸Šä¼ çš„æ–‡ä»¶åˆ—è¡¨
    :param background_tasks: åå°ä»»åŠ¡
    :param db: æ•°æ®åº“ä¼šè¯
    """
    if not files:
        raise HTTPException(status_code=400, detail="æœªé€‰æ‹©æ–‡ä»¶")

    if len(files) > 50:  # é™åˆ¶å•æ¬¡ä¸Šä¼ æ•°é‡
        raise HTTPException(status_code=400, detail="å•æ¬¡æœ€å¤šä¸Šä¼ 50ä¸ªæ–‡ä»¶")

    try:
        import_service = ImportService()
        photo_service = PhotoService()
        imported_count = 0
        failed_files = []

        for file in files:
            # éªŒè¯æ–‡ä»¶ç±»å‹
            if not file.content_type or not file.content_type.startswith('image/'):
                failed_files.append(f"{file.filename}: ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹")
                continue

            # ä¿å­˜ä¸´æ—¶æ–‡ä»¶
            with tempfile.NamedTemporaryFile(delete=False, suffix=Path(file.filename).suffix) as temp_file:
                shutil.copyfileobj(file.file, temp_file)
                temp_path = temp_file.name

            try:
                # æ™ºèƒ½å¤„ç†ï¼ˆåŒ…å«é‡å¤æ£€æµ‹ï¼‰
                success, message, photo_data, duplicate_info = import_service.process_single_photo(temp_path, db_session=db)

                if success and photo_data:
                    # ä¿å­˜åˆ°æ•°æ®åº“
                    photo = photo_service.create_photo(db, photo_data)
                    if photo:
                        imported_count += 1
                    else:
                        failed_files.append(f"{file.filename}: æ•°æ®åº“ä¿å­˜å¤±è´¥")
                elif duplicate_info:
                    # å¤„ç†é‡å¤æ–‡ä»¶
                    duplicate_type = duplicate_info.get('duplicate_type', 'unknown')
                    if duplicate_type == 'full_duplicate_completed':
                        failed_files.append(f"{file.filename}: æ–‡ä»¶å·²å­˜åœ¨ä¸”å·²å®Œæˆå¤„ç†")
                    elif duplicate_type == 'full_duplicate_incomplete':
                        imported_count += 1  # ç»§ç»­å¤„ç†
                    else:
                        failed_files.append(f"{file.filename}: {message}")
                else:
                    failed_files.append(f"{file.filename}: {message}")

            except Exception as e:
                failed_files.append(f"{file.filename}: å¤„ç†å¤±è´¥ - {str(e)}")
            finally:
                # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
                try:
                    os.unlink(temp_path)
                except:
                    pass

        return JSONResponse({
            "success": True,
            "message": f"æˆåŠŸå¤„ç† {imported_count} ä¸ªæ–‡ä»¶",
            "data": {
                "imported_photos": imported_count,
                "total_files": len(files),
                "failed_files": failed_files
            }
        })
        
    except Exception as e:
        return JSONResponse({
            "success": False,
            "message": f"ä¸Šä¼ å¤±è´¥: {str(e)}"
        }, status_code=500)
```

### 11.2 å¤„ç†çŠ¶æ€æ¥å£

#### 11.2.1 æ‰¹é‡çŠ¶æ€æŸ¥è¯¢æ¥å£ï¼ˆå·²å®ç°ï¼‰
```python
@router.post("/batch-status")
async def get_batch_status(task_ids: List[str]):
    """
    è·å–å¤šä¸ªæ‰¹æ¬¡ä»»åŠ¡çš„èšåˆçŠ¶æ€ï¼ˆå·²å®ç°ï¼‰

    :param task_ids: ä»»åŠ¡IDåˆ—è¡¨
    :return: æ‰¹æ¬¡èšåˆçŠ¶æ€
    """
```

#### 11.2.2 æ‰«æçŠ¶æ€æŸ¥è¯¢æ¥å£ï¼ˆå·²å®ç°ï¼‰
```python
@router.get("/scan-status/{task_id}")
async def get_scan_status(task_id: str):
    """
    è·å–æ‰«æä»»åŠ¡çŠ¶æ€ï¼ˆå·²å®ç°ï¼‰

    :param task_id: ä»»åŠ¡ID
    :return: æ‰«æä»»åŠ¡çŠ¶æ€
    """
```

#### 11.2.3 å¯¼å…¥çŠ¶æ€æŸ¥è¯¢æ¥å£ï¼ˆå·²å®ç°ï¼‰
```python
@router.get("/import-status")
async def get_import_status():
    """
    è·å–å¯¼å…¥çŠ¶æ€ä¿¡æ¯ï¼ˆå·²å®ç°ï¼‰
    """
```

## åäºŒã€é…ç½®ç®¡ç†

### 12.1 å½“å‰é…ç½®ç®¡ç†å®ç°çŠ¶æ€

#### 12.1.1 åç«¯é…ç½®ç³»ç»Ÿï¼ˆå·²å®ç°ï¼‰
**é…ç½®æ–‡ä»¶ä½ç½®**ï¼š`app/core/config.py`

**å·²å®ç°çš„é…ç½®ç±»å‹**ï¼š
```python
class SystemConfig(BaseSettings):
    """ç³»ç»ŸåŸºç¡€é…ç½®"""
    max_file_size: int = Field(default=52428800, description="å•æ–‡ä»¶æœ€å¤§å¤§å°ï¼ˆå­—èŠ‚ï¼‰")
    timeout: int = Field(default=10, description="è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰")
    max_concurrent: int = Field(default=2, description="æœ€å¤§å¹¶å‘æ•°")
    temp_file_max_age: int = Field(default=24, description="ä¸´æ—¶æ–‡ä»¶æœ€å¤§å¹´é¾„ï¼ˆå°æ—¶ï¼‰")

class StorageConfig(BaseSettings):
    """å­˜å‚¨é…ç½®"""
    base_path: str = Field(default="./photos_storage", description="å­˜å‚¨æ ¹ç›®å½•")
    originals_path: str = Field(default="originals", description="åŸå›¾å­˜å‚¨è·¯å¾„")
    thumbnails_path: str = Field(default="thumbnails", description="ç¼©ç•¥å›¾å­˜å‚¨è·¯å¾„")
    temp_path: str = Field(default="temp", description="ä¸´æ—¶æ–‡ä»¶å­˜å‚¨è·¯å¾„")
    thumbnail_size: int = Field(default=300, description="ç¼©ç•¥å›¾å°ºå¯¸")
    thumbnail_quality: int = Field(default=85, description="ç¼©ç•¥å›¾è´¨é‡")

class AnalysisConfig(BaseSettings):
    """åˆ†æé…ç½®"""
    duplicate_threshold: int = Field(default=5, description="é‡å¤æ£€æµ‹é˜ˆå€¼")
    quality_threshold: int = Field(default=0, description="è´¨é‡è¯„ä¼°é˜ˆå€¼")
```

#### 12.1.2 é…ç½®åŠ è½½æœºåˆ¶ï¼ˆå·²å®ç°ï¼‰
- **JSONé…ç½®æ–‡ä»¶**ï¼šæ”¯æŒä» `config.json` åŠ è½½é…ç½®
- **ç¯å¢ƒå˜é‡è¦†ç›–**ï¼šæ”¯æŒç¯å¢ƒå˜é‡è¦†ç›–é…ç½®å€¼
- **é»˜è®¤å€¼è®¾ç½®**ï¼šæä¾›åˆç†çš„é»˜è®¤é…ç½®å€¼
- **é…ç½®éªŒè¯**ï¼šä½¿ç”¨Pydanticè¿›è¡Œé…ç½®éªŒè¯

### 12.2 å‰ç«¯è®¾ç½®ç®¡ç†ï¼ˆå·²å®ç°ï¼‰

#### 12.2.1 å·²å®ç°çš„åŠŸèƒ½
- **è®¾ç½®é¡µé¢**ï¼šç‹¬ç«‹çš„ç³»ç»Ÿé…ç½®é¡µé¢ï¼ˆtemplates/settings.htmlï¼‰
- **é…ç½®ä¿®æ”¹**ï¼šé€šè¿‡ç•Œé¢ä¿®æ”¹å„é¡¹é…ç½®å‚æ•°
- **é…ç½®æŸ¥çœ‹**ï¼šå®æ—¶æ˜¾ç¤ºå½“å‰å€¼å’Œé»˜è®¤å€¼
- **é…ç½®éªŒè¯**ï¼šå®æ—¶éªŒè¯é…ç½®å‚æ•°çš„æœ‰æ•ˆæ€§
- **æœ¬åœ°è®¿é—®é™åˆ¶**ï¼šæ•æ„Ÿé…ç½®ä»…é™æœ¬åœ°è®¿é—®

#### 12.2.2 è®¾ç½®é¡µé¢åŠŸèƒ½
**è®¾ç½®é¡µé¢åŒ…å«ä»¥ä¸‹é…ç½®é¡¹**ï¼š
- **AIæœåŠ¡è®¾ç½®**ï¼šå¤§æ¨¡å‹é€‰æ‹©ã€APIå¯†é’¥é…ç½®
- **å­˜å‚¨è®¾ç½®**ï¼šç…§ç‰‡å­˜å‚¨ç›®å½•ã€ç¼©ç•¥å›¾è´¨é‡è®¾ç½®
- **ç•Œé¢è®¾ç½®**ï¼šæ¯é¡µæ˜¾ç¤ºæ•°é‡ã€ç›¸ä¼¼ç…§ç‰‡æ˜¾ç¤ºæ•°é‡
- **æœç´¢è®¾ç½®**ï¼šç›¸ä¼¼åº¦é˜ˆå€¼ã€é‡å¤æ£€æµ‹é˜ˆå€¼
- **æ“ä½œæŒ‰é’®**ï¼šä¿å­˜é…ç½®ã€é‡ç½®ä¸ºé»˜è®¤ã€å¯¼å‡ºé…ç½®

### 12.3 é…ç½®ç®¡ç†æ”¹è¿›å»ºè®®

#### 12.3.1 çŸ­æœŸæ”¹è¿›ï¼ˆå»ºè®®ï¼‰
1. **æ·»åŠ é…ç½®æŸ¥çœ‹API**ï¼šæä¾›è·å–å½“å‰é…ç½®çš„æ¥å£
2. **é…ç½®éªŒè¯API**ï¼šæä¾›é…ç½®éªŒè¯å’Œæµ‹è¯•æ¥å£
3. **åŸºç¡€è®¾ç½®é¡µé¢**ï¼šå®ç°ç®€å•çš„è®¾ç½®ç®¡ç†ç•Œé¢

#### 12.3.2 é•¿æœŸæ”¹è¿›ï¼ˆè§„åˆ’ï¼‰
1. **å®Œæ•´è®¾ç½®ç®¡ç†**ï¼šå®ç°å®Œæ•´çš„è®¾ç½®ç®¡ç†ç•Œé¢
2. **é…ç½®çƒ­æ›´æ–°**ï¼šæ”¯æŒè¿è¡Œæ—¶é…ç½®æ›´æ–°
3. **é…ç½®å¤‡ä»½æ¢å¤**ï¼šæ”¯æŒé…ç½®çš„å¤‡ä»½å’Œæ¢å¤
4. **é…ç½®æ¨¡æ¿**ï¼šæä¾›ä¸åŒåœºæ™¯çš„é…ç½®æ¨¡æ¿

### 12.4 å½“å‰é…ç½®ä½¿ç”¨æƒ…å†µ

#### 12.4.1 å·²ä½¿ç”¨çš„é…ç½®é¡¹
- **ç…§ç‰‡å¤§å°é™åˆ¶**ï¼š`settings.system.max_file_size`
- **å­˜å‚¨è·¯å¾„**ï¼š`settings.storage.base_path`
- **ç¼©ç•¥å›¾è®¾ç½®**ï¼š`settings.storage.thumbnail_size`
- **APIé…ç½®**ï¼š`settings.dashscope.api_key`

#### 12.4.2 é…ç½®ä¿®æ”¹æ–¹å¼
**æ”¯æŒå¤šç§é…ç½®ä¿®æ”¹æ–¹å¼**ï¼š
1. **è®¾ç½®é¡µé¢é…ç½®**ï¼šé€šè¿‡Webç•Œé¢ä¿®æ”¹ï¼ˆæ¨èï¼‰
2. **ä¿®æ”¹ `config.json` æ–‡ä»¶**ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
3. **è®¾ç½®ç¯å¢ƒå˜é‡**ï¼ˆå¦‚ `DASHSCOPE_API_KEY`ï¼‰
4. **ä¿®æ”¹ä»£ç ä¸­çš„é»˜è®¤å€¼**ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

**æ³¨æ„**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®é€šè¿‡è®¾ç½®é¡µé¢ä¿®æ”¹é…ç½®ï¼Œå¼€å‘ç¯å¢ƒå¯ä»¥ä½¿ç”¨å…¶ä»–æ–¹å¼ã€‚

## åä¸‰ã€ç›‘æ§ä¸æ—¥å¿—

### 13.1 å¯¼å…¥ç›‘æ§

#### 13.1.1 æ€§èƒ½ç›‘æ§
- **å¯¼å…¥é€Ÿåº¦**ï¼šå¼ /ç§’
- **å¤„ç†æ—¶é—´**ï¼šå¹³å‡å¤„ç†æ—¶é—´
- **æˆåŠŸç‡**ï¼šå¯¼å…¥æˆåŠŸç‡
- **é”™è¯¯ç‡**ï¼šå„ç±»é”™è¯¯ç»Ÿè®¡

#### 13.1.2 èµ„æºç›‘æ§
- **å†…å­˜ä½¿ç”¨**ï¼šå¤„ç†è¿‡ç¨‹å†…å­˜ä½¿ç”¨
- **ç£ç›˜ä½¿ç”¨**ï¼šå­˜å‚¨ç©ºé—´ä½¿ç”¨
- **CPUä½¿ç”¨**ï¼šå¤„ç†è¿‡ç¨‹CPUä½¿ç”¨ç‡
- **å¹¶å‘æ•°**ï¼šå½“å‰å¹¶å‘å¤„ç†æ•°é‡

### 13.2 å¯¼å…¥æ—¥å¿—ç®¡ç†

#### 13.2.1 æ—¥å¿—å†…å®¹
- **å¯¼å…¥è¯·æ±‚æ—¥å¿—**ï¼šå¯¼å…¥æ–¹å¼ã€æ–‡ä»¶æ•°é‡ã€æ—¶é—´
- **å¤„ç†è¿‡ç¨‹æ—¥å¿—**ï¼šæ–‡ä»¶å¤„ç†çŠ¶æ€ã€é”™è¯¯ä¿¡æ¯
- **æ€§èƒ½æ—¥å¿—**ï¼šå¤„ç†æ—¶é—´ã€å†…å­˜ä½¿ç”¨ã€ç£ç›˜I/O
- **é”™è¯¯æ—¥å¿—**ï¼šé”™è¯¯ç±»å‹ã€é”™è¯¯è¯¦æƒ…ã€å¤„ç†å»ºè®®

#### 13.2.2 æ—¥å¿—åˆ†æ
- **å¯¼å…¥è¶‹åŠ¿åˆ†æ**ï¼šå¯¼å…¥é‡å˜åŒ–è¶‹åŠ¿
- **æ€§èƒ½ç“¶é¢ˆåˆ†æ**ï¼šæ…¢æ–‡ä»¶å¤„ç†åˆ†æ
- **é”™è¯¯æ¨¡å¼åˆ†æ**ï¼šå¸¸è§é”™è¯¯ç±»å‹ç»Ÿè®¡
- **ç”¨æˆ·è¡Œä¸ºåˆ†æ**ï¼šå¯¼å…¥æ–¹å¼åå¥½åˆ†æ

## åå››ã€æµ‹è¯•ç­–ç•¥

### 14.1 åŠŸèƒ½æµ‹è¯•

#### 14.1.1 å¯¼å…¥åŠŸèƒ½æµ‹è¯•
- **æ–‡ä»¶å¤¹æ‰«ææµ‹è¯•**ï¼šå„ç§æ–‡ä»¶å¤¹ç»“æ„æ‰«æ
- **æ‹–æ‹½å¯¼å…¥æµ‹è¯•**ï¼šå•æ–‡ä»¶å’Œå¤šæ–‡ä»¶æ‹–æ‹½
- **Webä¸Šä¼ æµ‹è¯•**ï¼šå„ç§æ–‡ä»¶æ ¼å¼ä¸Šä¼ 
- **æ‰¹é‡å¯¼å…¥æµ‹è¯•**ï¼šå¤§é‡æ–‡ä»¶æ™ºèƒ½å¤„ç†

#### 14.1.2 æ–‡ä»¶å¤„ç†æµ‹è¯•
- **æ ¼å¼æ”¯æŒæµ‹è¯•**ï¼šå„ç§å›¾ç‰‡æ ¼å¼å¤„ç†
- **æ–‡ä»¶æ ¡éªŒæµ‹è¯•**ï¼šæŸåæ–‡ä»¶ã€è¶…å¤§æ–‡ä»¶å¤„ç†
- **å…ƒæ•°æ®æå–æµ‹è¯•**ï¼šEXIFæ•°æ®æå–å‡†ç¡®æ€§
- **ç¼©ç•¥å›¾ç”Ÿæˆæµ‹è¯•**ï¼šç¼©ç•¥å›¾è´¨é‡å’Œæ€§èƒ½

### 14.2 æ€§èƒ½æµ‹è¯•

#### 14.2.1 å¤„ç†æ€§èƒ½æµ‹è¯•
- **å•æ–‡ä»¶å¤„ç†æµ‹è¯•**ï¼šå¤„ç†æ—¶é—´ â‰¤ 2ç§’
- **æ™ºèƒ½å¤„ç†æµ‹è¯•**ï¼š10å¼ ç…§ç‰‡ â‰¤ 20ç§’
- **å¹¶å‘å¤„ç†æµ‹è¯•**ï¼šå¤šæ–‡ä»¶åŒæ—¶å¤„ç†
- **å†…å­˜ä½¿ç”¨æµ‹è¯•**ï¼šå¤„ç†è¿‡ç¨‹å†…å­˜æ§åˆ¶

#### 14.2.2 å‹åŠ›æµ‹è¯•
- **å¤§é‡æ–‡ä»¶æµ‹è¯•**ï¼š1000å¼ ç…§ç‰‡å¯¼å…¥
- **é•¿æ—¶é—´è¿è¡Œæµ‹è¯•**ï¼šè¿ç»­å¯¼å…¥æµ‹è¯•
- **ç£ç›˜ç©ºé—´æµ‹è¯•**ï¼šç©ºé—´ä¸è¶³å¤„ç†
- **ç½‘ç»œä¸­æ–­æµ‹è¯•**ï¼šå¼‚å¸¸æƒ…å†µå¤„ç†

### 14.3 å…¼å®¹æ€§æµ‹è¯•

#### 14.3.1 æ–‡ä»¶æ ¼å¼å…¼å®¹æ€§
- **ä¸»æµæ ¼å¼**ï¼šJPEGã€PNGã€TIFFã€WebP
- **ç‰¹æ®Šæ ¼å¼**ï¼šRAWæ–‡ä»¶ã€HDRç…§ç‰‡
- **æŸåæ–‡ä»¶**ï¼šéƒ¨åˆ†æŸåçš„å›¾ç‰‡æ–‡ä»¶
- **è¶…å¤§æ–‡ä»¶**ï¼šæ¥è¿‘å¤§å°é™åˆ¶çš„æ–‡ä»¶

#### 14.3.2 ç³»ç»Ÿå…¼å®¹æ€§
- **æ“ä½œç³»ç»Ÿ**ï¼šWindowsã€macOSã€Linux
- **æ–‡ä»¶ç³»ç»Ÿ**ï¼šNTFSã€HFS+ã€ext4
- **Pythonç‰ˆæœ¬**ï¼šPython 3.8+
- **ä¾èµ–åº“ç‰ˆæœ¬**ï¼šPILã€SQLAlchemyç­‰

## åäº”ã€éƒ¨ç½²ä¸è¿ç»´

### 15.1 éƒ¨ç½²è¦æ±‚

#### 15.1.1 ç¡¬ä»¶è¦æ±‚
- **å¤„ç†å™¨**ï¼šIntel i5æˆ–AMD Ryzen 5åŠä»¥ä¸Š
- **å†…å­˜**ï¼š8GBåŠä»¥ä¸Šï¼ˆæ¨è16GBï¼‰
- **ç¡¬ç›˜**ï¼š100GBåŠä»¥ä¸Šå¯ç”¨ç©ºé—´ï¼ˆæ¨èSSDï¼‰
- **ç½‘ç»œ**ï¼šç¨³å®šçš„ç½‘ç»œè¿æ¥ï¼ˆç”¨äºAIåˆ†æï¼‰

#### 15.1.2 è½¯ä»¶è¦æ±‚
- **æ“ä½œç³»ç»Ÿ**ï¼šWindows 10/11ã€macOS 10.15+ã€Ubuntu 18.04+
- **Pythonç‰ˆæœ¬**ï¼šPython 3.8åŠä»¥ä¸Š
- **ä¾èµ–åº“**ï¼šPILã€SQLAlchemyã€FastAPIç­‰
- **æµè§ˆå™¨**ï¼šChrome 90+ã€Firefox 88+ã€Safari 14+ã€Edge 90+

### 15.2 è¿ç»´ç®¡ç†

#### 15.2.1 æœåŠ¡ç›‘æ§
- **æœåŠ¡çŠ¶æ€ç›‘æ§**ï¼šå¯¼å…¥æœåŠ¡å¯ç”¨æ€§
- **æ€§èƒ½æŒ‡æ ‡ç›‘æ§**ï¼šå¤„ç†é€Ÿåº¦ã€æˆåŠŸç‡
- **èµ„æºä½¿ç”¨ç›‘æ§**ï¼šCPUã€å†…å­˜ã€ç£ç›˜ä½¿ç”¨
- **é”™è¯¯ç‡ç›‘æ§**ï¼šå„ç±»é”™è¯¯å‘ç”Ÿé¢‘ç‡
- **è¿›ç¨‹éš”ç¦»ç›‘æ§**ï¼šPyInstallerç¯å¢ƒçš„ä»»åŠ¡çŠ¶æ€å…±äº«é—®é¢˜
  - å¼€å‘ç¯å¢ƒï¼šå•è¿›ç¨‹ï¼Œå…¨å±€å˜é‡ä¿æŒæ­£å¸¸
  - ç”Ÿäº§ç¯å¢ƒï¼šå¤šè¿›ç¨‹éš”ç¦»ï¼Œ`task_status` å­—å…¸ä¸å…±äº«
  - å½±å“ï¼šæ‰¹é‡å¯¼å…¥æ—¶æ˜¾ç¤º"ç¬¬20æ‰¹"ç­‰é‡å¤æ‰¹æ¬¡å·

#### 15.2.2 æ•°æ®ç®¡ç†
- **å­˜å‚¨ç©ºé—´ç®¡ç†**ï¼šå®šæœŸæ¸…ç†ä¸´æ—¶æ–‡ä»¶
- **æ•°æ®åº“ç»´æŠ¤**ï¼šå®šæœŸä¼˜åŒ–æ•°æ®åº“
- **å¤‡ä»½ç­–ç•¥**ï¼šé‡è¦æ•°æ®å¤‡ä»½
- **æ—¥å¿—ç®¡ç†**ï¼šæ—¥å¿—è½®è½¬å’Œæ¸…ç†

## åå…­ã€é£é™©ä¸åº”å¯¹æªæ–½

### 16.1 æŠ€æœ¯é£é™©

| é£é™©ç±»å‹ | é£é™©æè¿° | å½±å“ç¨‹åº¦ | åº”å¯¹æªæ–½ |
|---------|---------|---------|---------|
| æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ | ç”¨æˆ·ä¸Šä¼ ä¸æ”¯æŒçš„æ ¼å¼ | ä¸­ | æä¾›æ ¼å¼è½¬æ¢å»ºè®®ï¼Œæ‰©å±•æ”¯æŒæ ¼å¼ |
| æ–‡ä»¶æŸå | å¤„ç†æŸåçš„å›¾ç‰‡æ–‡ä»¶ | ä¸­ | è·³è¿‡æŸåæ–‡ä»¶ï¼Œè®°å½•é”™è¯¯æ—¥å¿— |
| ç£ç›˜ç©ºé—´ä¸è¶³ | å­˜å‚¨ç©ºé—´ä¸å¤Ÿ | é«˜ | ç©ºé—´ç›‘æ§é¢„è­¦ï¼Œæä¾›æ¸…ç†å»ºè®® |
| å¤„ç†è¶…æ—¶ | å¤§æ–‡ä»¶å¤„ç†è¶…æ—¶ | ä¸­ | è®¾ç½®è¶…æ—¶é™åˆ¶ï¼Œæä¾›é‡è¯•æœºåˆ¶ |
| å†…å­˜æº¢å‡º | æ™ºèƒ½å¤„ç†å†…å­˜ä¸è¶³ | é«˜ | åˆ†æ‰¹å¤„ç†ï¼Œå†…å­˜ä½¿ç”¨ç›‘æ§ |
| è¿›ç¨‹éš”ç¦»çŠ¶æ€ä¸¢å¤± | PyInstallerç”Ÿäº§ç¯å¢ƒè¿›ç¨‹éš”ç¦»å¯¼è‡´ä»»åŠ¡çŠ¶æ€ä¸¢å¤± | é«˜ | çŠ¶æ€æŸ¥è¯¢æ—¶æ˜¾ç¤ºé”™è¯¯æ‰¹æ¬¡å·ï¼Œå½±å“è¿›åº¦ç›‘æ§ |

### 16.2 ä¸šåŠ¡é£é™©

| é£é™©ç±»å‹ | é£é™©æè¿° | å½±å“ç¨‹åº¦ | åº”å¯¹æªæ–½ |
|---------|---------|---------|---------|
| é‡å¤å¯¼å…¥ | ç”¨æˆ·é‡å¤å¯¼å…¥ç›¸åŒç…§ç‰‡ | ä½ | æ–‡ä»¶å“ˆå¸Œæ£€æµ‹ï¼Œè·³è¿‡é‡å¤æ–‡ä»¶ |
| æ•°æ®ä¸¢å¤± | å¯¼å…¥è¿‡ç¨‹ä¸­æ•°æ®ä¸¢å¤± | é«˜ | äº‹åŠ¡å¤„ç†ï¼Œæ•°æ®å¤‡ä»½ |
| æ€§èƒ½ä¸‹é™ | å¤§é‡æ–‡ä»¶å¯¼å…¥æ€§èƒ½ä¸‹é™ | ä¸­ | åˆ†æ‰¹å¤„ç†ï¼Œæ€§èƒ½ä¼˜åŒ– |
| ç”¨æˆ·è¯¯æ“ä½œ | ç”¨æˆ·è¯¯åˆ æˆ–è¯¯æ“ä½œ | ä¸­ | æ“ä½œç¡®è®¤ï¼Œæ’¤é”€åŠŸèƒ½ |

## åä¸ƒã€æ™ºèƒ½é€šçŸ¥ç³»ç»Ÿè®¾è®¡ï¼ˆå·²å®ç°ï¼‰

### 17.1 é€šçŸ¥ç³»ç»Ÿæ¦‚è¿°

æ™ºèƒ½é€šçŸ¥ç³»ç»Ÿæ˜¯ç…§ç‰‡å¯¼å…¥æ¨¡å—çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¸ºç”¨æˆ·æä¾›æ¸…æ™°ã€è¯¦ç»†çš„æ“ä½œåé¦ˆã€‚ç³»ç»Ÿé‡‡ç”¨ç»Ÿä¸€çš„é€šçŸ¥æ ¼å¼ï¼Œæ”¯æŒè¯¦ç»†ç»“æœæŸ¥çœ‹ï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿå®Œå…¨äº†è§£å¯¼å…¥å’Œæ™ºèƒ½å¤„ç†çš„ç»“æœã€‚

### 17.2 é€šçŸ¥ç³»ç»Ÿç‰¹æ€§

#### 17.2.1 ç»Ÿä¸€é€šçŸ¥æ ¼å¼ï¼ˆå·²å®ç°ï¼‰
**é€šçŸ¥æ ¼å¼**ï¼š
```
[å›¾æ ‡] æ€»å…±Xå¼ ç…§ç‰‡ï¼ŒYå¼ å¯¼å…¥æˆåŠŸï¼ŒZå¼ æ— éœ€å¯¼å…¥ï¼ŒWå¼ å¯¼å…¥å¤±è´¥
è¯·å…ˆç‚¹å‡»"åŸºç¡€åˆ†æ"æŒ‰é’®è¿›è¡Œè´¨é‡è¯„ä¼°å’ŒåŸºç¡€æ ‡ç­¾ç”Ÿæˆï¼›å¦‚éœ€æ›´æ·±å…¥çš„AIåˆ†æï¼Œå†ç‚¹å‡»"AIåˆ†æ"æŒ‰é’®
```

**å›¾æ ‡è§„åˆ™**ï¼š
- `âœ…` - å…¨éƒ¨æˆåŠŸï¼ˆfailed_count = 0 && skipped_count = 0ï¼‰
- `âš ï¸` - æœ‰è·³è¿‡ä½†æ— å¤±è´¥ï¼ˆfailed_count = 0 && skipped_count > 0ï¼‰
- `âŒ` - æœ‰å¤±è´¥ï¼ˆfailed_count > 0ï¼‰

#### 17.2.2 è¯¦ç»†ç»“æœå±•ç¤ºï¼ˆå·²å®ç°ï¼‰
**æŸ¥çœ‹è¯¦æƒ…åŠŸèƒ½**ï¼š
- é¡¶éƒ¨é€šçŸ¥åŒ…å«"æŸ¥çœ‹è¯¦æƒ…"æŒ‰é’®
- ç‚¹å‡»åæ‰“å¼€æ¨¡æ€æ¡†æ˜¾ç¤ºå®Œæ•´ç»“æœ
- åŒ…å«å¤±è´¥æ–‡ä»¶åˆ—è¡¨å’Œå¤±è´¥åŸå› 
- æ”¯æŒè¡¨æ ¼å½¢å¼å±•ç¤ºè¯¦ç»†ä¿¡æ¯

**æ¨¡æ€æ¡†å†…å®¹**ï¼š
```html
<!-- å¯¼å…¥ç»“æœè¯¦æƒ…æ¨¡æ€æ¡† -->
<div class="modal fade" id="importDetailsModal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">å¯¼å…¥ç»“æœè¯¦æƒ…</h5>
            </div>
            <div class="modal-body">
                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                <div class="row mb-3">
                    <div class="col-3">æ€»æ–‡ä»¶æ•°ï¼šX</div>
                    <div class="col-3">æˆåŠŸï¼šY</div>
                    <div class="col-3">è·³è¿‡ï¼šZ</div>
                    <div class="col-3">å¤±è´¥ï¼šW</div>
                </div>
                <!-- å¤±è´¥æ–‡ä»¶åˆ—è¡¨ -->
                <table class="table table-sm">
                    <thead>
                        <tr><th>æ–‡ä»¶å</th><th>å¤±è´¥åŸå› </th></tr>
                    </thead>
                    <tbody>
                        <!-- å¤±è´¥æ–‡ä»¶è¯¦æƒ… -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
```

#### 17.2.3 é€šçŸ¥è¡Œä¸ºæ§åˆ¶ï¼ˆå·²å®ç°ï¼‰
**é€šçŸ¥æŒä¹…æ€§**ï¼š
- é€šçŸ¥ä¸å†è‡ªåŠ¨æ¶ˆå¤±
- éœ€è¦ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»å…³é—­
- ç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿå……åˆ†äº†è§£ç»“æœ

**æ™ºèƒ½å¤„ç†é€šçŸ¥**ï¼š
- æ™ºèƒ½å¤„ç†å®Œæˆåæ˜¾ç¤ºç»“æœé€šçŸ¥
- å¤„ç†"æ— ç…§ç‰‡éœ€è¦å¤„ç†"åœºæ™¯ï¼Œæ˜¾ç¤ºå‹å¥½æç¤º
- æ™ºèƒ½å¤„ç†æ¨¡æ€æ¡†åœ¨æ˜¾ç¤ºç»“æœåè‡ªåŠ¨å…³é—­

### 17.3 é€šçŸ¥ç³»ç»Ÿå®ç°

#### 17.3.1 å‰ç«¯é€šçŸ¥å‡½æ•°ï¼ˆå·²å®ç°ï¼‰
```javascript
// ç»Ÿä¸€é€šçŸ¥æ˜¾ç¤ºå‡½æ•°
function showSuccess(message, showDetails = false, detailsData = null) {
    // æ˜¾ç¤ºæˆåŠŸé€šçŸ¥
    // æ”¯æŒå¤šè¡Œæ¶ˆæ¯æ ¼å¼
    // æ”¯æŒæŸ¥çœ‹è¯¦æƒ…æŒ‰é’®
}

function showWarning(message, showDetails = false, detailsData = null) {
    // æ˜¾ç¤ºè­¦å‘Šé€šçŸ¥
    // æ”¯æŒå¤šè¡Œæ¶ˆæ¯æ ¼å¼
    // æ”¯æŒæŸ¥çœ‹è¯¦æƒ…æŒ‰é’®
}

function showError(message, showDetails = false, detailsData = null) {
    // æ˜¾ç¤ºé”™è¯¯é€šçŸ¥
    // æ”¯æŒå¤šè¡Œæ¶ˆæ¯æ ¼å¼
    // æ”¯æŒæŸ¥çœ‹è¯¦æƒ…æŒ‰é’®
}

// è¯¦ç»†ç»“æœå±•ç¤ºå‡½æ•°
function showImportDetails(detailsData) {
    // åŠ¨æ€ç”Ÿæˆè¯¦ç»†ç»“æœæ¨¡æ€æ¡†
    // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯å’Œå¤±è´¥æ–‡ä»¶åˆ—è¡¨
    // æ”¯æŒè¡¨æ ¼å½¢å¼å±•ç¤º
}
```

#### 17.3.2 åç«¯æ•°æ®æ”¯æŒï¼ˆå·²å®ç°ï¼‰
**è¯¦ç»†ç»Ÿè®¡ä¿¡æ¯**ï¼š
```python
# å¯¼å…¥ç»“æœæ•°æ®ç»“æ„
{
    "total_files": 20,           # æ€»æ–‡ä»¶æ•°
    "imported_photos": 15,       # æˆåŠŸå¯¼å…¥æ•°
    "skipped_photos": 4,         # è·³è¿‡æ•°ï¼ˆé‡å¤ç­‰ï¼‰
    "failed_photos": 1,          # å¤±è´¥æ•°
    "failed_files": [            # å¤±è´¥æ–‡ä»¶è¯¦æƒ…
        {
            "filename": "photo.jpg",
            "reason": "æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒ"
        }
    ]
}
```

#### 17.3.3 æ™ºèƒ½å¤„ç†é€šçŸ¥ï¼ˆå·²å®ç°ï¼‰
**æ™ºèƒ½å¤„ç†ç»“æœé€šçŸ¥**ï¼š
```javascript
// æ™ºèƒ½å¤„ç†å®Œæˆé€šçŸ¥
const totalPhotos = statusData.batch_total_photos || initialTotal;
const completedPhotos = statusData.batch_completed_photos || 0;
const failedPhotos = totalPhotos - completedPhotos;

let icon, message;
if (failedPhotos > 0) {
    icon = 'âŒ';
    message = `${icon} æ™ºèƒ½å¤„ç†å®Œæˆï¼š${totalPhotos}å¼ ç…§ç‰‡ï¼Œ${completedPhotos}å¼ æˆåŠŸï¼Œ${failedPhotos}å¼ å¤±è´¥`;
} else if (completedPhotos > 0) {
    icon = 'âœ…';
    message = `${icon} æ™ºèƒ½å¤„ç†å®Œæˆï¼š${totalPhotos}å¼ ç…§ç‰‡å…¨éƒ¨å¤„ç†æˆåŠŸ`;
} else {
    icon = 'âš ï¸';
    message = `${icon} æ™ºèƒ½å¤„ç†å®Œæˆï¼šæ²¡æœ‰ç…§ç‰‡è¢«å¤„ç†`;
}

showSuccess(message);
```

### 17.4 é€šçŸ¥ç³»ç»Ÿä¼˜åŒ–

#### 17.4.1 ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- **æ¸…æ™°çš„ä¿¡æ¯å±‚æ¬¡**ï¼šç»Ÿè®¡ä¿¡æ¯ â†’ è¯¦ç»†åˆ—è¡¨ â†’ æ“ä½œå»ºè®®
- **ç›´è§‚çš„è§†è§‰åé¦ˆ**ï¼šå›¾æ ‡ã€é¢œè‰²ã€å¸ƒå±€çš„åˆç†ä½¿ç”¨
- **ä¾¿æ·çš„æ“ä½œæµç¨‹**ï¼šä¸€é”®æŸ¥çœ‹è¯¦æƒ…ï¼Œå¿«é€Ÿäº†è§£ç»“æœ

#### 17.4.2 æŠ€æœ¯å®ç°ä¼˜åŒ–
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šé€šçŸ¥å‡½æ•°ç‹¬ç«‹ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **æ•°æ®é©±åŠ¨**ï¼šåŸºäºåç«¯è¿”å›çš„è¯¦ç»†æ•°æ®ç”Ÿæˆé€šçŸ¥
- **å“åº”å¼å¸ƒå±€**ï¼šé€‚é…ä¸åŒå±å¹•å°ºå¯¸çš„é€šçŸ¥æ˜¾ç¤º

### 17.5 é€šçŸ¥ç³»ç»Ÿæµ‹è¯•

#### 17.5.1 åŠŸèƒ½æµ‹è¯•
- **é€šçŸ¥æ˜¾ç¤ºæµ‹è¯•**ï¼šå„ç§åœºæ™¯ä¸‹çš„é€šçŸ¥æ˜¾ç¤º
- **è¯¦æƒ…æŸ¥çœ‹æµ‹è¯•**ï¼šæ¨¡æ€æ¡†å†…å®¹æ­£ç¡®æ€§
- **é€šçŸ¥å…³é—­æµ‹è¯•**ï¼šæ‰‹åŠ¨å…³é—­åŠŸèƒ½æ­£å¸¸

#### 17.5.2 ç”¨æˆ·ä½“éªŒæµ‹è¯•
- **ä¿¡æ¯å®Œæ•´æ€§æµ‹è¯•**ï¼šé€šçŸ¥åŒ…å«æ‰€æœ‰å¿…è¦ä¿¡æ¯
- **æ“ä½œä¾¿æ·æ€§æµ‹è¯•**ï¼šæŸ¥çœ‹è¯¦æƒ…æ“ä½œç®€å•ç›´è§‚
- **è§†è§‰æ¸…æ™°æ€§æµ‹è¯•**ï¼šé€šçŸ¥å†…å®¹æ¸…æ™°æ˜“è¯»

## åå…«ã€æ€»ç»“

ç…§ç‰‡å¯¼å…¥æ¨¡å—æ˜¯å®¶åº­ç…§ç‰‡ç³»ç»Ÿçš„æ ¸å¿ƒæ¨¡å—ï¼Œé€šè¿‡**æ™ºèƒ½é‡å¤æ£€æµ‹ç®—æ³•**å’Œ**å¤šå±‚çº§æ–‡ä»¶ç®¡ç†ç­–ç•¥**ï¼Œä¸ºç”¨æˆ·æä¾›äº†é«˜æ•ˆã€æ™ºèƒ½çš„ç…§ç‰‡å…¥å£ã€‚æ¨¡å—è®¾è®¡éµå¾ªæ™ºèƒ½åŒ–çš„åŸåˆ™ï¼Œåœ¨ä¿è¯åŠŸèƒ½å®Œæ•´æ€§çš„åŒæ—¶ï¼Œç¡®ä¿å¤„ç†æ€§èƒ½å’Œå­˜å‚¨ç©ºé—´ä¼˜åŒ–ã€‚

### **âœ… å·²å®ç°çš„æ ¸å¿ƒç‰¹æ€§**

**æ™ºèƒ½é‡å¤æ£€æµ‹**ï¼š
- **æ„ŸçŸ¥å“ˆå¸Œç®—æ³•**ï¼šä½¿ç”¨imagehash.phashè¿›è¡Œå›¾åƒç›¸ä¼¼åº¦æ£€æµ‹
- **å¤šå±‚çº§æ£€æµ‹**ï¼šæ–‡ä»¶å“ˆå¸Œ + æ„ŸçŸ¥å“ˆå¸ŒåŒé‡æ£€æµ‹æœºåˆ¶
- **å››ç§é‡å¤æƒ…å†µ**ï¼šå®Œå…¨é‡å¤ã€å­¤å„¿è®°å½•ã€ç‰©ç†é‡å¤ã€å…¨æ–°æ–‡ä»¶çš„æ™ºèƒ½å¤„ç†

**æ™ºèƒ½æ–‡ä»¶ç®¡ç†**ï¼š
- **é¿å…é‡å¤å­˜å‚¨**ï¼šé€šè¿‡æ–‡ä»¶å“ˆå¸Œæ£€æµ‹é¿å…å­˜å‚¨ç›¸åŒæ–‡ä»¶
- **å­¤å„¿è®°å½•æ¸…ç†**ï¼šè‡ªåŠ¨æ¸…ç†æ•°æ®åº“ä¸­çš„æ— æ•ˆè®°å½•

**å¤„ç†æµç¨‹ä¼˜åŒ–**ï¼š
- **æ™ºèƒ½å¤„ç†æµç¨‹**ï¼šé‡å¤æ£€æµ‹ â†’ æ–‡ä»¶ç®¡ç† â†’ å…ƒæ•°æ®æå– â†’ å­˜å‚¨ä¼˜åŒ–
- **å¼‚æ­¥å¤„ç†æ¶æ„**ï¼šæå‡ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿæ€§èƒ½
- **å®Œå–„çš„é”™è¯¯å¤„ç†**ï¼šç¡®ä¿ç³»ç»Ÿç¨³å®šå¯é 

**æ™ºèƒ½é€šçŸ¥ç³»ç»Ÿ**ï¼š
- **ç»Ÿä¸€é€šçŸ¥æ ¼å¼**ï¼šæ¸…æ™°æ˜¾ç¤ºæ€»æ•°ã€æˆåŠŸã€è·³è¿‡ã€å¤±è´¥æ•°é‡
- **å›¾æ ‡åŒ–åé¦ˆ**ï¼šâœ…å…¨éƒ¨æˆåŠŸã€âš ï¸æœ‰è·³è¿‡ã€âŒæœ‰å¤±è´¥
- **è¯¦ç»†ç»“æœæŸ¥çœ‹**ï¼šæ”¯æŒæŸ¥çœ‹è¯¦æƒ…æ¨¡æ€æ¡†ï¼Œæ˜¾ç¤ºå¤±è´¥æ–‡ä»¶åˆ—è¡¨
- **ç”¨æˆ·å‹å¥½è®¾è®¡**ï¼šé€šçŸ¥ä¸è‡ªåŠ¨æ¶ˆå¤±ï¼Œæ™ºèƒ½å¤„ç†æ¨¡æ€æ¡†è‡ªåŠ¨å…³é—­

**HEICæ ¼å¼æ”¯æŒ**ï¼š
- **å®Œæ•´HEICæ”¯æŒ**ï¼šæ”¯æŒ.heicå’Œ.heifæ ¼å¼æ–‡ä»¶çš„å¯¼å…¥å’Œå¤„ç†
- **pillow-heifé›†æˆ**ï¼šä½¿ç”¨pillow-heifåº“æä¾›HEICæ ¼å¼æ”¯æŒ
- **EXIFæ•°æ®æå–**ï¼šæ”¯æŒä»HEICæ–‡ä»¶ä¸­æå–å®Œæ•´çš„EXIFå…ƒæ•°æ®
- **è´¨é‡è¯„ä¼°å…¼å®¹**ï¼šOpenCVå’ŒPILéƒ½èƒ½æ­£ç¡®å¤„ç†HEICæ ¼å¼
- **å‰ç«¯æ˜¾ç¤ºä¼˜åŒ–**ï¼šæ™ºèƒ½æ£€æµ‹HEICæ ¼å¼ï¼Œæä¾›ç”¨æˆ·å‹å¥½çš„æ˜¾ç¤ºæç¤º

**æ™ºèƒ½å¤„ç†ç•Œé¢ä¼˜åŒ–**ï¼š
- **ç®€åŒ–æ“ä½œç•Œé¢**ï¼šç§»é™¤å¤æ‚çš„å¤é€‰æ¡†ï¼Œé»˜è®¤å¯ç”¨æ‰€æœ‰æ™ºèƒ½å¤„ç†åŠŸèƒ½
- **å®æ—¶ç»Ÿè®¡æ˜¾ç¤º**ï¼šæ˜¾ç¤ºéœ€è¦å¤„ç†çš„ç…§ç‰‡æ•°é‡ï¼ˆimportedå’ŒerrorçŠ¶æ€ï¼‰
- **å¸®åŠ©é“¾æ¥é›†æˆ**ï¼šæä¾›APIå¯†é’¥é…ç½®å¸®åŠ©é¡µé¢é“¾æ¥
- **è¿›åº¦å¯è§†åŒ–**ï¼šä½¿ç”¨Bootstrapè¿›åº¦æ¡æ˜¾ç¤ºå¤„ç†è¿›åº¦
- **çŠ¶æ€åé¦ˆ**ï¼šå®æ—¶æ˜¾ç¤ºå¤„ç†çŠ¶æ€å’Œç»“æœ

**å¯¼å…¥æ–¹å¼æ”¯æŒ**ï¼š
- **æ–‡ä»¶é€‰æ‹©å¯¼å…¥**ï¼šâœ… å·²å®ç° - æ”¯æŒå¤šæ–‡ä»¶é€‰æ‹©ï¼Œé€‚åˆå°‘é‡ç…§ç‰‡å¿«é€Ÿå¯¼å…¥
- **æ–‡ä»¶å¤¹æ‰«æå¯¼å…¥**ï¼šâœ… å·²å®ç° - æ”¯æŒé€’å½’æ‰«æï¼Œé€‚åˆå¤§é‡å†å²ç…§ç‰‡
- **æ‹–æ‹½å¯¼å…¥**ï¼šâŒ æœªå®ç° - æ”¯æŒæ‹–æ‹½æ“ä½œï¼Œé€‚åˆä¸´æ—¶æ·»åŠ ç…§ç‰‡

### ** æŠ€æœ¯äº®ç‚¹**

**é‡å¤æ£€æµ‹ç®—æ³•**ï¼š
- åŸºäºimagehash.phashçš„æ„ŸçŸ¥å“ˆå¸Œç®—æ³•
- æ”¯æŒç›¸ä¼¼å›¾åƒæ£€æµ‹ï¼Œä¸ä»…ä»…æ˜¯å®Œå…¨ç›¸åŒçš„æ–‡ä»¶
- æ™ºèƒ½å¤„ç†å››ç§ä¸åŒçš„é‡å¤æƒ…å†µ

**å­˜å‚¨ä¼˜åŒ–**ï¼š
- é¿å…é‡å¤å­˜å‚¨ç›¸åŒæ–‡ä»¶ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´
- æ™ºèƒ½æ–‡ä»¶è·¯å¾„ç®¡ç†å’ŒæŸ¥æ‰¾
- å­¤å„¿è®°å½•è‡ªåŠ¨æ¸…ç†æœºåˆ¶

**æ€§èƒ½ä¼˜åŒ–**ï¼š
- å¼‚æ­¥å¤„ç†æ¶æ„ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- æ™ºèƒ½å¤„ç†ä¼˜åŒ–ï¼Œæ”¯æŒå¤§é‡ç…§ç‰‡å¯¼å…¥
- å†…å­˜ä¼˜åŒ–çš„å›¾åƒå¤„ç†

### **ğŸ“ˆ å®é™…åº”ç”¨ä»·å€¼**

**å®¶åº­ç”¨æˆ·**ï¼š
- æ™ºèƒ½è¯†åˆ«å’Œè·³è¿‡é‡å¤ç…§ç‰‡ï¼Œé¿å…å­˜å‚¨æµªè´¹
- æ”¯æŒå¤§é‡å†å²ç…§ç‰‡çš„æ‰¹é‡æ•´ç†
- æä¾›ç›´è§‚çš„é‡å¤æ£€æµ‹æŠ¥å‘Š

**ç³»ç»Ÿæ€§èƒ½**ï¼š
- æ˜¾è‘—å‡å°‘å­˜å‚¨ç©ºé—´ä½¿ç”¨
- æå‡ç…§ç‰‡å¯¼å…¥å’Œå¤„ç†æ•ˆç‡
- é™ä½ç³»ç»Ÿç»´æŠ¤æˆæœ¬

**æ•°æ®å®Œæ•´æ€§**ï¼š
- ç¡®ä¿ç…§ç‰‡æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§
- è‡ªåŠ¨æ¸…ç†æ— æ•ˆçš„æ•°æ®åº“è®°å½•
- æä¾›è¯¦ç»†çš„å¤„ç†çŠ¶æ€å’Œé”™è¯¯ä¿¡æ¯

é€šè¿‡éµå¾ªæœ¬è®¾è®¡æ–‡æ¡£ï¼Œå¼€å‘å›¢é˜Ÿå¯ä»¥åŸºäºå®é™…å®ç°ç»§ç»­ä¼˜åŒ–ç…§ç‰‡å¯¼å…¥æ¨¡å—çš„åŠŸèƒ½ï¼Œä¸ºç”¨æˆ·æä¾›æ›´æ™ºèƒ½ã€æ›´é«˜æ•ˆçš„ç…§ç‰‡ä½“éªŒã€‚æ¨¡å—çš„æ™ºèƒ½é‡å¤æ£€æµ‹ç‰¹æ€§å’Œå­˜å‚¨ä¼˜åŒ–èƒ½åŠ›ï¼Œå°†å¤§å¤§æå‡å®¶åº­ç”¨æˆ·æ•´ç†ç…§ç‰‡çš„æ•ˆç‡å’Œä½“éªŒã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šV1.9
**æœ€åæ›´æ–°**ï¼š2025å¹´9æœˆ28æ—¥ï¼ˆå®Œå–„ç¼©ç•¥å›¾é…ç½®è¯´æ˜ï¼‰
**æ–‡æ¡£çŠ¶æ€**ï¼šå·²åŒæ­¥æœ€æ–°å®ç°

**æ›´æ–°è¯´æ˜**ï¼š
- **æ–°å¢ç”¨æˆ·æŒ‡å¼•**ï¼šæ·»åŠ å¯¼å…¥æˆåŠŸåçš„ç”¨æˆ·æŒ‡å¼•ç« èŠ‚ï¼Œè¯¦ç»†è¯´æ˜åˆ†ææµç¨‹
- **åˆ†ææµç¨‹æ›´æ–°**ï¼šæ›´æ–°åˆ†ææ–¹å¼å¯¹æ¯”å’Œé€‰æ‹©æ€§åˆ†æåŠŸèƒ½è¯´æ˜
- **çŠ¶æ€ç®¡ç†åŒæ­¥**ï¼šä¸æœ€æ–°6ç§çŠ¶æ€ç®¡ç†ç³»ç»Ÿä¿æŒä¸€è‡´
- **APIæ¥å£æ›´æ–°**ï¼šä¿®æ­£APIæ¥å£æè¿°ä¸å®é™…FastAPIå®ç°ä¿æŒä¸€è‡´
- **æ–‡æ¡£åŒæ­¥**ï¼šç¡®ä¿æ‰€æœ‰æè¿°ä¸æœ€æ–°ä»£ç å®ç°å®Œå…¨ä¸€è‡´
- **æ–°å¢è¿›ç¨‹éš”ç¦»çŠ¶æ€ç®¡ç†è¯´æ˜**ï¼šè¯¦ç»†è§£é‡Šå¼€å‘/ç”Ÿäº§ç¯å¢ƒå·®å¼‚åŠæ‰¹é‡å¯¼å…¥æ‰¹æ¬¡å·å¼‚å¸¸åŸå› 
- **æ–°å¢MD5å“ˆå¸Œæ£€æµ‹å…·ä½“å®ç°**ï¼šæ·»åŠ å®Œæ•´çš„å“ˆå¸Œè®¡ç®—å’Œé‡å¤æ£€æµ‹é€»è¾‘ä»£ç 
- **æ˜ç¡®é‡å¤æ–‡ä»¶å¤„ç†å±‚é¢çš„åŒºåˆ«**ï¼šåŒºåˆ†å¯¼å…¥å­˜å‚¨å’Œæ™ºèƒ½åˆ†æçš„å¤„ç†é€»è¾‘
- **å®Œå–„é‡å¤æ–‡ä»¶çŠ¶æ€é‡ç½®é€»è¾‘**ï¼šè¯¦ç»†è¯´æ˜æ¡ä»¶æ€§çŠ¶æ€é‡ç½®è§„åˆ™
- **ç§»é™¤æœªå®ç°çš„æ–‡ä»¶æŸ¥æ‰¾åŠŸèƒ½**ï¼šåˆ é™¤`_find_existing_file_by_hash`æ–¹æ³•ï¼Œé¿å…æ–‡æ¡£ä¸ä»£ç ä¸ä¸€è‡´
- **å®Œå–„ç¼©ç•¥å›¾é…ç½®è¯´æ˜**ï¼šæ›´æ–°å°ºå¯¸å’Œè´¨é‡å‚æ•°è¯´æ˜ï¼Œåæ˜ å®é™…çš„å¯é…ç½®æ€§

**æ³¨æ„**ï¼šæœ¬è®¾è®¡æ–‡æ¡£å·²æ ¹æ®å®é™…ç³»ç»ŸV2.0ç‰ˆæœ¬çš„ä»£ç å®ç°è¿›è¡Œå…¨é¢ä¿®æ­£ï¼Œç¡®ä¿æŠ€æœ¯æè¿°å‡†ç¡®æ— è¯¯ã€‚