# å®¶åº­ç‰ˆæ™ºèƒ½ç…§ç‰‡ç³»ç»Ÿ - é€‰æ‹©æ™ºèƒ½å¤„ç†åŠŸèƒ½è¯¦ç»†è®¾è®¡æ–‡æ¡£

## ä¸€ã€æ–‡æ¡£åŸºç¡€ä¿¡æ¯

| é¡¹ç›®åç§° | å®¶åº­ç‰ˆæ™ºèƒ½ç…§ç‰‡ç³»ç»Ÿ | æ–‡æ¡£ç±»å‹ | é€‰æ‹©æ™ºèƒ½å¤„ç†åŠŸèƒ½è¯¦ç»†è®¾è®¡æ–‡æ¡£ |
| -------- | ------------------------- | -------- | ----------------------------- |
| æ–‡æ¡£ç‰ˆæœ¬ | V1.0 | æ–‡æ¡£çŠ¶æ€ | â˜‘ è‰ç¨¿ â–¡ è¯„å®¡ä¸­ â–¡ å·²ç¡®è®¤ â–¡ å·²å½’æ¡£ |
| ç¼–å†™äºº | AIåŠ©æ‰‹ | ç¼–å†™æ—¥æœŸ | 2025å¹´9æœˆ20æ—¥ |
| å…³è”æ–‡æ¡£ | ã€Šç…§ç‰‡ç®¡ç†æ¨¡å—è¯¦ç»†è®¾è®¡æ–‡æ¡£ã€‹ã€Šæ™ºèƒ½åˆ†ææ¨¡å—è¯¦ç»†è®¾è®¡æ–‡æ¡£ã€‹ã€Šå‰ç«¯ç•Œé¢è®¾è®¡æ–‡æ¡£ã€‹ | | |

## äºŒã€åŠŸèƒ½æ¦‚è¿°

### 2.1 åŠŸèƒ½ç›®æ ‡

é€‰æ‹©æ™ºèƒ½å¤„ç†åŠŸèƒ½æ˜¯ç…§ç‰‡ç®¡ç†æ¨¡å—çš„é‡è¦æ‰©å±•åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·é€‰æ‹©ç‰¹å®šçš„ç…§ç‰‡è¿›è¡Œæ™ºèƒ½åˆ†æå¤„ç†ã€‚ä¸å¯¼èˆªæ çš„å…¨é‡æ™ºèƒ½å¤„ç†ä¸åŒï¼Œè¯¥åŠŸèƒ½æä¾›æ›´ç²¾ç»†åŒ–çš„å¤„ç†æ§åˆ¶ï¼Œæ”¯æŒç”¨æˆ·æ ¹æ®éœ€è¦é€‰æ‹©æ€§åœ°å¤„ç†ç…§ç‰‡ï¼ŒåŒ…æ‹¬é‡æ–°å¤„ç†å·²åˆ†æçš„ç…§ç‰‡ã€‚

### 2.2 è®¾è®¡åŸåˆ™

- **ç”¨æˆ·è‡ªä¸»æ€§**ï¼šç”¨æˆ·å®Œå…¨æ§åˆ¶è¦å¤„ç†å“ªäº›ç…§ç‰‡
- **çµæ´»æ€§**ï¼šæ”¯æŒé€‰æ‹©å¤„ç†å’Œé‡æ–°å¤„ç†
- **é€æ˜æ€§**ï¼šæ¸…æ™°æ˜¾ç¤ºç…§ç‰‡çš„å¤„ç†çŠ¶æ€
- **é«˜æ•ˆæ€§**ï¼šæ‰¹é‡å¤„ç†æå‡æ•ˆç‡
- **å®‰å…¨æ€§**ï¼šç¡®ä¿å¤„ç†è¿‡ç¨‹çš„ç¨³å®šæ€§å’Œæ•°æ®å®Œæ•´æ€§

### 2.3 åŠŸèƒ½èŒƒå›´

- âœ… ç…§ç‰‡é€‰æ‹©åŠŸèƒ½ï¼ˆå¤é€‰æ¡†ã€å¤šé€‰ã€å…¨é€‰ï¼‰
- âœ… çŠ¶æ€æ˜¾ç¤ºåŠŸèƒ½ï¼ˆæœªå¤„ç†/å¤„ç†ä¸­/å·²å¤„ç†æ ‡è¯†ï¼‰
- âœ… æ™ºèƒ½å¤„ç†åŠŸèƒ½ï¼ˆæ‰¹é‡AIåˆ†æï¼‰
- âœ… è¿›åº¦æ˜¾ç¤ºåŠŸèƒ½ï¼ˆå®æ—¶å¤„ç†è¿›åº¦ï¼‰
- âœ… ç»“æœåé¦ˆåŠŸèƒ½ï¼ˆå¤„ç†ç»“æœå±•ç¤ºï¼‰
- âœ… é”™è¯¯å¤„ç†åŠŸèƒ½ï¼ˆå¼‚å¸¸æƒ…å†µå¤„ç†ï¼‰

## ä¸‰ã€æŠ€æœ¯æ¶æ„

### 3.1 æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**ï¼šåŸç”ŸJavaScript ES6+ + Bootstrap 5.3.0
- **åç«¯æ¡†æ¶**ï¼šPython + FastAPI + Pydantic
- **æ•°æ®åº“**ï¼šSQLite + SQLAlchemy 2.x
- **AIæœåŠ¡**ï¼šDashScope Qwen-VL API
- **å¼‚æ­¥å¤„ç†**ï¼šasyncio + BackgroundTasks

### 3.2 ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ç•Œé¢      â”‚    â”‚   APIæ¥å£å±‚     â”‚    â”‚   ä¸šåŠ¡é€»è¾‘å±‚     â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ ç…§ç‰‡é€‰æ‹©UI    â”‚â—„â”€â”€â–ºâ”‚ â€¢ /analysis/    â”‚â—„â”€â”€â–ºâ”‚ â€¢ åˆ†ææœåŠ¡      â”‚
â”‚ â€¢ çŠ¶æ€æ˜¾ç¤º      â”‚    â”‚   batch-analyze â”‚    â”‚ â€¢ çŠ¶æ€ç®¡ç†      â”‚
â”‚ â€¢ è¿›åº¦æ¡        â”‚    â”‚ â€¢ /analysis/    â”‚    â”‚ â€¢ ä»»åŠ¡é˜Ÿåˆ—      â”‚
â”‚ â€¢ ç»“æœå±•ç¤º      â”‚    â”‚   queue/status  â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°æ®åº“å±‚      â”‚    â”‚   AIæœåŠ¡å±‚      â”‚    â”‚   æ–‡ä»¶ç³»ç»Ÿ      â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â€¢ Photoè¡¨       â”‚    â”‚ â€¢ DashScope     â”‚    â”‚ â€¢ ç…§ç‰‡æ–‡ä»¶      â”‚
â”‚ â€¢ PhotoAnalysis â”‚    â”‚ â€¢ Qwen-VL      â”‚    â”‚ â€¢ ä¸´æ—¶æ–‡ä»¶      â”‚
â”‚ â€¢ PhotoQuality  â”‚    â”‚                 â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å››ã€åŠŸèƒ½è¯¦ç»†è®¾è®¡

### 4.1 æ•°æ®æ¨¡å‹è®¾è®¡

#### 4.1.1 ç…§ç‰‡çŠ¶æ€æ¨¡å‹

```javascript
// å‰ç«¯ç…§ç‰‡çŠ¶æ€åˆ¤æ–­é€»è¾‘
function getProcessingStatus(photo) {
    // å¤„ç†ä¸­çŠ¶æ€ - ä¼˜å…ˆçº§æœ€é«˜
    if (photo.status === 'processing') {
        return {
            status: 'processing',
            icon: 'â³',
            text: 'åˆ†æä¸­',
            className: 'status-processing',
            canProcess: false
        };
    }

    // å·²å¤„ç†çŠ¶æ€ - æœ‰åˆ†æè®°å½•
    if (photo.analysis || photo.quality) {
        return {
            status: 'completed',
            icon: 'âœ…',
            text: 'å·²åˆ†æ',
            className: 'status-completed',
            canProcess: true  // æ”¯æŒé‡æ–°å¤„ç†
        };
    }

    // æœªå¤„ç†çŠ¶æ€ - é»˜è®¤çŠ¶æ€
    return {
        status: 'unprocessed',
        icon: 'ğŸ¤–',
        text: 'æœªåˆ†æ',
        className: 'status-unprocessed',
        canProcess: true
    };
}
```

#### 4.1.2 å¤„ç†ç»“æœæ•°æ®ç»“æ„

```typescript
interface ProcessingResult {
    total_photos: number;
    processed_photos: number;
    successful_photos: number;
    failed_photos: number;
    skipped_photos: number;
    progress_percentage: number;
    status: 'processing' | 'completed' | 'failed';
    errors: string[];
    start_time: string;
    end_time?: string;
}
```

### 4.2 ç•Œé¢è®¾è®¡

#### 4.2.1 ç…§ç‰‡å¡ç‰‡è®¾è®¡

```html
<!-- ç…§ç‰‡å¡ç‰‡æ¨¡æ¿ -->
<div class="photo-card selectable" data-photo-id="123">
    <!-- é€‰æ‹©æ¡† -->
    <div class="photo-select-overlay">
        <input type="checkbox" class="photo-checkbox" id="photo-123">
        <label for="photo-123" class="photo-select-label"></label>
    </div>

    <!-- çŠ¶æ€æ ‡è¯† -->
    <div class="photo-status-badge status-unprocessed">
        <i class="bi bi-robot"></i>
        <span>æœªåˆ†æ</span>
    </div>

    <!-- å›¾ç‰‡å®¹å™¨ -->
    <div class="photo-image-container">
        <img src="/photos_storage/thumbnails/photo_123.jpg"
             alt="photo_123.jpg"
             class="photo-image">
    </div>

    <!-- ä¿¡æ¯åŒºåŸŸ -->
    <div class="photo-info">
        <div class="photo-title">photo_123.jpg</div>
        <div class="photo-meta">2024-01-15 14:30</div>
    </div>
</div>
```

#### 4.2.2 æ‰¹é‡æ“ä½œæ è®¾è®¡

```html
<!-- æ‰¹é‡æ“ä½œæ  -->
<div class="batch-actions-bar" id="batchActionsBar" style="display: none;">
    <div class="container-fluid">
        <div class="row align-items-center">
            <div class="col-md-4">
                <span class="selected-count">
                    å·²é€‰æ‹© <strong id="selectedCount">0</strong> å¼ ç…§ç‰‡
                </span>
                <span class="status-summary" id="statusSummary"></span>
            </div>
            <div class="col-md-8 text-end">
                <button type="button" class="btn btn-outline-secondary me-2" onclick="clearSelection()">
                    <i class="bi bi-x-lg"></i> å–æ¶ˆé€‰æ‹©
                </button>
                <button type="button" class="btn btn-primary me-2" onclick="processSelectedPhotos()">
                    <i class="bi bi-robot"></i> æ™ºèƒ½å¤„ç†æ‰€é€‰
                </button>
                <button type="button" class="btn btn-outline-primary" onclick="reprocessSelectedPhotos()">
                    <i class="bi bi-arrow-repeat"></i> é‡æ–°å¤„ç†æ‰€é€‰
                </button>
            </div>
        </div>
    </div>
</div>
```

#### 4.2.3 å¤„ç†è¿›åº¦æ¨¡æ€æ¡†è®¾è®¡

```html
<!-- å¤„ç†è¿›åº¦æ¨¡æ€æ¡† -->
<div class="modal fade" id="batchProcessModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">æ™ºèƒ½å¤„ç†è¿›åº¦</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <!-- å¤„ç†ç»Ÿè®¡ -->
                <div class="processing-stats mb-3">
                    <div class="row text-center">
                        <div class="col-3">
                            <div class="stat-card">
                                <div class="stat-number" id="totalPhotos">0</div>
                                <div class="stat-label">æ€»ç…§ç‰‡</div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="stat-card">
                                <div class="stat-number text-success" id="processedPhotos">0</div>
                                <div class="stat-label">å·²å¤„ç†</div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="stat-card">
                                <div class="stat-number text-warning" id="pendingPhotos">0</div>
                                <div class="stat-label">å¾…å¤„ç†</div>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="stat-card">
                                <div class="stat-number text-danger" id="failedPhotos">0</div>
                                <div class="stat-label">å¤±è´¥</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è¿›åº¦æ¡ -->
                <div class="progress mb-3">
                    <div class="progress-bar progress-bar-striped progress-bar-animated"
                         id="processingProgressBar"
                         style="width: 0%"></div>
                </div>

                <!-- çŠ¶æ€ä¿¡æ¯ -->
                <div class="processing-status">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i>
                        <span id="processingStatus">æ­£åœ¨å‡†å¤‡æ™ºèƒ½å¤„ç†...</span>
                    </div>
                </div>

                <!-- è¯¦ç»†æ—¥å¿— -->
                <div class="processing-details" style="display: none;">
                    <h6>å¤„ç†è¯¦æƒ…</h6>
                    <div class="processing-log" id="processingLog" style="max-height: 200px; overflow-y: auto;">
                        <!-- åŠ¨æ€æ·»åŠ å¤„ç†æ—¥å¿— -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-lg me-1"></i> å–æ¶ˆ
                </button>
                <button type="button" class="btn btn-primary" id="confirmProcessBtn">
                    <i class="bi bi-play-fill me-1"></i> å¼€å§‹å¤„ç†
                </button>
            </div>
        </div>
    </div>
</div>
```

### 4.3 äº¤äº’æµç¨‹è®¾è®¡

#### 4.3.1 é€‰æ‹©ç…§ç‰‡æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·è¿›å…¥ç…§ç‰‡åº“] --> B[æ˜¾ç¤ºç…§ç‰‡ç½‘æ ¼]
    B --> C[ç”¨æˆ·ç‚¹å‡»é€‰æ‹©æŒ‰é’®/å¤é€‰æ¡†]
    C --> D[æ˜¾ç¤ºæ‰¹é‡æ“ä½œæ ]
    D --> E[ç”¨æˆ·ç»§ç»­é€‰æ‹©ç…§ç‰‡]
    E --> F{é€‰æ‹©å®Œæˆ?}
    F -->|å¦| E
    F -->|æ˜¯| G[ç‚¹å‡»æ™ºèƒ½å¤„ç†æŒ‰é’®]
```

#### 4.3.2 æ™ºèƒ½å¤„ç†æµç¨‹

```mermaid
graph TD
    A[ç‚¹å‡»æ™ºèƒ½å¤„ç†æŒ‰é’®] --> B[æ˜¾ç¤ºç¡®è®¤æ¨¡æ€æ¡†]
    B --> C[æ˜¾ç¤ºå¤„ç†ç»Ÿè®¡ä¿¡æ¯]
    C --> D[ç”¨æˆ·ç¡®è®¤å¼€å§‹å¤„ç†]
    D --> E[è°ƒç”¨æ‰¹é‡åˆ†æAPI]
    E --> F[æ˜¾ç¤ºå®æ—¶è¿›åº¦]
    F --> G{å¤„ç†å®Œæˆ?}
    G -->|å¦| F
    G -->|æ˜¯| H[æ˜¾ç¤ºå¤„ç†ç»“æœ]
    H --> I[åˆ·æ–°ç…§ç‰‡åˆ—è¡¨]
    I --> J[å…³é—­æ¨¡æ€æ¡†]
```

### 4.4 APIæ¥å£è®¾è®¡

#### 4.4.1 æ‰¹é‡æ™ºèƒ½å¤„ç†æ¥å£

```python
@app.post("/analysis/batch-analyze")
async def batch_analyze_photos(
    request: BatchAnalysisRequest,
    background_tasks: BackgroundTasks,
    db: Session = Depends(get_db)
) -> BatchAnalysisResponse:
    """
    æ‰¹é‡æ™ºèƒ½å¤„ç†ç…§ç‰‡

    è¯·æ±‚å‚æ•°ï¼š
    - photo_ids: List[int] - è¦å¤„ç†çš„ç…§ç‰‡IDåˆ—è¡¨
    - analysis_types: List[str] - åˆ†æç±»å‹ ['content', 'quality', 'duplicate']
    - force_reprocess: bool - æ˜¯å¦å¼ºåˆ¶é‡æ–°å¤„ç†ï¼ˆé»˜è®¤Falseï¼‰

    è¿”å›ï¼š
    - task_id: str - ä»»åŠ¡ID
    - total_photos: int - æ€»ç…§ç‰‡æ•°
    - message: str - å“åº”æ¶ˆæ¯
    """
```

#### 4.4.2 å¤„ç†çŠ¶æ€æŸ¥è¯¢æ¥å£

```python
@app.get("/analysis/queue/status")
async def get_analysis_queue_status(
    initial_total: int = Query(..., description="åˆå§‹æ€»ç…§ç‰‡æ•°")
) -> AnalysisStatusResponse:
    """
    è·å–æ™ºèƒ½å¤„ç†é˜Ÿåˆ—çŠ¶æ€

    è¿”å›ï¼š
    - is_complete: bool - æ˜¯å¦å¤„ç†å®Œæˆ
    - batch_total_photos: int - æ‰¹é‡æ€»ç…§ç‰‡æ•°
    - batch_completed_photos: int - å·²å®Œæˆç…§ç‰‡æ•°
    - processing_photos: int - æ­£åœ¨å¤„ç†ç…§ç‰‡æ•°
    - progress_percentage: float - è¿›åº¦ç™¾åˆ†æ¯”
    - errors: List[str] - é”™è¯¯åˆ—è¡¨
    """
```

### 4.5 æ ¸å¿ƒåŠŸèƒ½å®ç°

#### 4.5.1 ç…§ç‰‡é€‰æ‹©åŠŸèƒ½

```javascript
class PhotoSelector {
    constructor() {
        this.selectedPhotos = new Set();
        this.initializeEventListeners();
    }

    // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
    initializeEventListeners() {
        // ç›‘å¬å¤é€‰æ¡†å˜åŒ–
        document.addEventListener('change', (e) => {
            if (e.target.classList.contains('photo-checkbox')) {
                this.togglePhotoSelection(e.target.dataset.photoId, e.target.checked);
            }
        });

        // ç›‘å¬å…¨é€‰æŒ‰é’®
        const selectAllBtn = document.getElementById('selectAllBtn');
        if (selectAllBtn) {
            selectAllBtn.addEventListener('click', () => this.toggleSelectAll());
        }
    }

    // åˆ‡æ¢å•å¼ ç…§ç‰‡é€‰æ‹©çŠ¶æ€
    togglePhotoSelection(photoId, isSelected) {
        const photoCard = document.querySelector(`[data-photo-id="${photoId}"]`);

        if (isSelected) {
            this.selectedPhotos.add(parseInt(photoId));
            photoCard?.classList.add('selected');
        } else {
            this.selectedPhotos.delete(parseInt(photoId));
            photoCard?.classList.remove('selected');
        }

        this.updateUI();
    }

    // å…¨é€‰/å–æ¶ˆå…¨é€‰
    toggleSelectAll() {
        const allPhotoCards = document.querySelectorAll('.photo-card[data-photo-id]');
        const allSelected = allPhotoCards.length === this.selectedPhotos.size;

        if (allSelected) {
            // å–æ¶ˆå…¨é€‰
            this.clearSelection();
        } else {
            // å…¨é€‰
            allPhotoCards.forEach(card => {
                const photoId = parseInt(card.dataset.photoId);
                this.selectedPhotos.add(photoId);
                card.classList.add('selected');
                const checkbox = card.querySelector('.photo-checkbox');
                if (checkbox) checkbox.checked = true;
            });
        }

        this.updateUI();
    }

    // å–æ¶ˆé€‰æ‹©
    clearSelection() {
        this.selectedPhotos.clear();
        document.querySelectorAll('.photo-card.selected').forEach(card => {
            card.classList.remove('selected');
            const checkbox = card.querySelector('.photo-checkbox');
            if (checkbox) checkbox.checked = false;
        });
        this.updateUI();
    }

    // æ›´æ–°UIçŠ¶æ€
    updateUI() {
        const selectedCount = this.selectedPhotos.size;
        const batchActionsBar = document.getElementById('batchActionsBar');

        if (selectedCount > 0) {
            // æ˜¾ç¤ºæ‰¹é‡æ“ä½œæ 
            batchActionsBar.style.display = 'block';
            document.getElementById('selectedCount').textContent = selectedCount;

            // æ›´æ–°çŠ¶æ€ç»Ÿè®¡
            this.updateStatusSummary();
        } else {
            // éšè—æ‰¹é‡æ“ä½œæ 
            batchActionsBar.style.display = 'none';
        }

        // æ›´æ–°å…¨é€‰æŒ‰é’®çŠ¶æ€
        this.updateSelectAllButton();
    }

    // æ›´æ–°çŠ¶æ€ç»Ÿè®¡
    updateStatusSummary() {
        const statusCounts = {
            unprocessed: 0,
            processing: 0,
            completed: 0
        };

        this.selectedPhotos.forEach(photoId => {
            const photo = this.getPhotoById(photoId);
            if (photo) {
                const status = getProcessingStatus(photo).status;
                statusCounts[status]++;
            }
        });

        const summaryParts = [];
        if (statusCounts.unprocessed > 0) {
            summaryParts.push(`${statusCounts.unprocessed}å¼ æœªåˆ†æ`);
        }
        if (statusCounts.processing > 0) {
            summaryParts.push(`${statusCounts.processing}å¼ åˆ†æä¸­`);
        }
        if (statusCounts.completed > 0) {
            summaryParts.push(`${statusCounts.completed}å¼ å·²åˆ†æ`);
        }

        document.getElementById('statusSummary').textContent =
            summaryParts.length > 0 ? ` (${summaryParts.join(', ')})` : '';
    }

    // æ›´æ–°å…¨é€‰æŒ‰é’®
    updateSelectAllButton() {
        const selectAllBtn = document.getElementById('selectAllBtn');
        if (selectAllBtn) {
            const totalPhotos = document.querySelectorAll('.photo-card[data-photo-id]').length;
            const allSelected = totalPhotos === this.selectedPhotos.size && totalPhotos > 0;

            selectAllBtn.textContent = allSelected ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰';
        }
    }

    // è·å–é€‰ä¸­çš„ç…§ç‰‡IDåˆ—è¡¨
    getSelectedPhotoIds() {
        return Array.from(this.selectedPhotos);
    }
}
```

#### 4.5.2 æ™ºèƒ½å¤„ç†åŠŸèƒ½

```javascript
class BatchProcessor {
    constructor() {
        this.photoSelector = new PhotoSelector();
    }

    // å¤„ç†é€‰ä¸­çš„ç…§ç‰‡
    async processSelectedPhotos(forceReprocess = false) {
        const selectedIds = this.photoSelector.getSelectedPhotoIds();

        if (selectedIds.length === 0) {
            showWarning('è¯·å…ˆé€‰æ‹©è¦å¤„ç†çš„ç…§ç‰‡');
            return;
        }

        // æ˜¾ç¤ºç¡®è®¤æ¨¡æ€æ¡†
        await this.showProcessConfirmation(selectedIds, forceReprocess);
    }

    // æ˜¾ç¤ºå¤„ç†ç¡®è®¤æ¨¡æ€æ¡†
    async showProcessConfirmation(photoIds, forceReprocess) {
        const stats = await this.getProcessingStats(photoIds);

        const modalHtml = `
            <div class="modal fade" id="processConfirmationModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                ${forceReprocess ? 'é‡æ–°å¤„ç†' : 'æ™ºèƒ½å¤„ç†'}ç¡®è®¤
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle me-2"></i>
                                ${forceReprocess ?
                                    'å°†å¯¹é€‰ä¸­çš„ç…§ç‰‡é‡æ–°è¿›è¡Œæ™ºèƒ½åˆ†æï¼ŒåŸæœ‰çš„åˆ†æç»“æœå°†è¢«è¦†ç›–ã€‚' :
                                    'å°†å¯¹é€‰ä¸­çš„ç…§ç‰‡è¿›è¡Œæ™ºèƒ½åˆ†æï¼Œå·²åˆ†æçš„ç…§ç‰‡å°†è¢«è·³è¿‡ã€‚'
                                }
                            </div>

                            <div class="processing-preview">
                                <h6>å¤„ç†ç»Ÿè®¡ï¼š</h6>
                                <div class="row text-center">
                                    <div class="col-4">
                                        <div class="stat-item">
                                            <div class="stat-value">${stats.total}</div>
                                            <div class="stat-label">æ€»ç…§ç‰‡</div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="stat-item">
                                            <div class="stat-value text-success">${stats.toProcess}</div>
                                            <div class="stat-label">å°†å¤„ç†</div>
                                        </div>
                                    </div>
                                    <div class="col-4">
                                        <div class="stat-item">
                                            <div class="stat-value text-warning">${stats.skip}</div>
                                            <div class="stat-label">å°†è·³è¿‡</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                å–æ¶ˆ
                            </button>
                            <button type="button" class="btn btn-primary" onclick="startBatchProcessing(${JSON.stringify(photoIds)}, ${forceReprocess})">
                                <i class="bi bi-play-fill me-1"></i> å¼€å§‹å¤„ç†
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;

        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        document.body.insertAdjacentHTML('beforeend', modalHtml);
        const modal = new bootstrap.Modal(document.getElementById('processConfirmationModal'));
        modal.show();

        // æ¨¡æ€æ¡†å…³é—­æ—¶æ¸…ç†DOM
        document.getElementById('processConfirmationModal').addEventListener('hidden.bs.modal', function() {
            this.remove();
        });
    }

    // è·å–å¤„ç†ç»Ÿè®¡ä¿¡æ¯
    async getProcessingStats(photoIds) {
        const stats = {
            total: photoIds.length,
            toProcess: 0,
            skip: 0
        };

        // è·å–ç…§ç‰‡è¯¦æƒ…æ¥åˆ¤æ–­çŠ¶æ€
        for (const photoId of photoIds) {
            const photo = await this.getPhotoDetails(photoId);
            if (photo) {
                const status = getProcessingStatus(photo).status;
                if (status === 'unprocessed' || status === 'processing') {
                    stats.toProcess++;
                } else {
                    stats.skip++;
                }
            }
        }

        return stats;
    }

    // å¼€å§‹æ‰¹é‡å¤„ç†
    async startBatchProcessing(photoIds, forceReprocess) {
        // å…³é—­ç¡®è®¤æ¨¡æ€æ¡†
        const confirmModal = bootstrap.Modal.getInstance(document.getElementById('processConfirmationModal'));
        if (confirmModal) {
            confirmModal.hide();
        }

        // æ˜¾ç¤ºå¤„ç†è¿›åº¦æ¨¡æ€æ¡†
        this.showProcessingModal();

        try {
            // è°ƒç”¨æ‰¹é‡åˆ†æAPI
            const response = await fetch(`${CONFIG.API_BASE_URL}/analysis/batch-analyze`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    photo_ids: photoIds,
                    analysis_types: ['content', 'quality', 'duplicate'],
                    force_reprocess: forceReprocess
                })
            });

            if (!response.ok) {
                throw new Error('æ‰¹é‡åˆ†æè¯·æ±‚å¤±è´¥');
            }

            const result = await response.json();

            if (result.success && result.data.task_id) {
                // å¼€å§‹ç›‘æ§å¤„ç†è¿›åº¦
                await this.monitorProcessingProgress(result.data.task_id, result.data.total_photos);
            } else {
                throw new Error(result.message || 'æ‰¹é‡åˆ†æå¯åŠ¨å¤±è´¥');
            }

        } catch (error) {
            console.error('æ‰¹é‡å¤„ç†å¯åŠ¨å¤±è´¥:', error);
            showError('æ‰¹é‡å¤„ç†å¯åŠ¨å¤±è´¥: ' + error.message);
            this.hideProcessingModal();
        }
    }

    // æ˜¾ç¤ºå¤„ç†è¿›åº¦æ¨¡æ€æ¡†
    showProcessingModal() {
        const modalHtml = `
            <div class="modal fade" id="processingModal" tabindex="-1" data-bs-backdrop="static">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">æ™ºèƒ½å¤„ç†è¿›åº¦</h5>
                        </div>
                        <div class="modal-body">
                            <div class="progress mb-3">
                                <div class="progress-bar progress-bar-striped progress-bar-animated"
                                     style="width: 0%"></div>
                            </div>
                            <div class="processing-status">
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle me-2"></i>
                                    <span>æ­£åœ¨å‡†å¤‡æ™ºèƒ½å¤„ç†...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;

        document.body.insertAdjacentHTML('beforeend', modalHtml);
        const modal = new bootstrap.Modal(document.getElementById('processingModal'));
        modal.show();
    }

    // éšè—å¤„ç†è¿›åº¦æ¨¡æ€æ¡†
    hideProcessingModal() {
        const modal = bootstrap.Modal.getInstance(document.getElementById('processingModal'));
        if (modal) {
            modal.hide();
            document.getElementById('processingModal').remove();
        }
    }

    // ç›‘æ§å¤„ç†è¿›åº¦
    async monitorProcessingProgress(taskId, totalPhotos) {
        const progressBar = document.querySelector('#processingModal .progress-bar');
        const statusText = document.querySelector('#processingModal .processing-status span');

        const checkProgress = async () => {
            try {
                const response = await fetch(`${CONFIG.API_BASE_URL}/analysis/queue/status?initial_total=${totalPhotos}`);
                const status = await response.json();

                if (status.is_complete) {
                    // å¤„ç†å®Œæˆ
                    progressBar.style.width = '100%';
                    statusText.textContent = 'æ™ºèƒ½å¤„ç†å®Œæˆï¼';

                    // å»¶è¿Ÿå…³é—­æ¨¡æ€æ¡†
                    setTimeout(() => {
                        this.hideProcessingModal();
                        // åˆ·æ–°ç…§ç‰‡åˆ—è¡¨
                        loadPhotos();
                        // å–æ¶ˆç…§ç‰‡é€‰æ‹©
                        this.photoSelector.clearSelection();
                    }, 2000);
                } else {
                    // æ›´æ–°è¿›åº¦
                    const progress = Math.min(status.progress_percentage || 0, 95);
                    progressBar.style.width = `${progress}%`;
                    statusText.textContent = `æ­£åœ¨å¤„ç†... ${Math.round(progress)}% (${status.batch_completed_photos}/${status.batch_total_photos})`;

                    // ç»§ç»­ç›‘æ§
                    setTimeout(checkProgress, 1000);
                }
            } catch (error) {
                console.error('è¿›åº¦æ£€æŸ¥å¤±è´¥:', error);
                statusText.textContent = 'è¿›åº¦æ£€æŸ¥å¤±è´¥ï¼Œæ­£åœ¨é‡è¯•...';
                setTimeout(checkProgress, 2000);
            }
        };

        // å¼€å§‹ç›‘æ§
        checkProgress();
    }
}

// å…¨å±€å®ä¾‹
window.BatchProcessor = new BatchProcessor();

// ä¾¿æ·å‡½æ•°
window.processSelectedPhotos = () => window.BatchProcessor.processSelectedPhotos(false);
window.reprocessSelectedPhotos = () => window.BatchProcessor.processSelectedPhotos(true);
window.clearSelection = () => window.BatchProcessor.photoSelector.clearSelection();
```

## äº”ã€æ ·å¼è®¾è®¡

### 5.1 CSSæ ·å¼å®šä¹‰

```css
/* ç…§ç‰‡é€‰æ‹©ç›¸å…³æ ·å¼ */
.photo-card.selectable {
    position: relative;
    transition: all 0.2s ease;
}

.photo-card.selectable.selected {
    box-shadow: 0 0 0 3px #007bff;
    transform: scale(0.98);
}

.photo-select-overlay {
    position: absolute;
    top: 8px;
    left: 8px;
    z-index: 10;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.photo-card:hover .photo-select-overlay,
.photo-card.selected .photo-select-overlay {
    opacity: 1;
}

.photo-checkbox {
    width: 20px;
    height: 20px;
    border-radius: 4px;
    border: 2px solid #fff;
    background: rgba(0, 123, 255, 0.9);
    appearance: none;
    cursor: pointer;
}

.photo-checkbox:checked {
    background: #007bff;
}

.photo-checkbox:checked::after {
    content: 'âœ“';
    color: white;
    font-size: 12px;
    font-weight: bold;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

/* çŠ¶æ€æ ‡è¯†æ ·å¼ */
.photo-status-badge {
    position: absolute;
    top: 8px;
    right: 8px;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
    z-index: 5;
    display: flex;
    align-items: center;
    gap: 4px;
}

.photo-status-badge.status-unprocessed {
    background: #fff3cd;
    color: #856404;
    border: 1px solid #ffeaa7;
}

.photo-status-badge.status-processing {
    background: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
}

.photo-status-badge.status-completed {
    background: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

/* æ‰¹é‡æ“ä½œæ æ ·å¼ */
.batch-actions-bar {
    background: #f8f9fa;
    border-bottom: 1px solid #dee2e6;
    padding: 12px 0;
    position: sticky;
    top: 0;
    z-index: 100;
}

.selected-count {
    font-size: 14px;
    color: #495057;
}

.status-summary {
    font-size: 12px;
    color: #6c757d;
    margin-left: 8px;
}

/* å¤„ç†è¿›åº¦æ¨¡æ€æ¡†æ ·å¼ */
.processing-stats .stat-card {
    padding: 16px;
    background: #f8f9fa;
    border-radius: 8px;
    margin-bottom: 16px;
}

.processing-stats .stat-number {
    font-size: 24px;
    font-weight: bold;
    color: #495057;
}

.processing-stats .stat-label {
    font-size: 12px;
    color: #6c757d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
    .batch-actions-bar .row {
        flex-direction: column;
        gap: 12px;
    }

    .batch-actions-bar .text-end {
        text-align: center !important;
    }

    .photo-status-badge {
        font-size: 11px;
        padding: 3px 6px;
    }
}
```

## å…­ã€æµ‹è¯•ç­–ç•¥

### 6.1 åŠŸèƒ½æµ‹è¯•

#### 6.1.1 å•å…ƒæµ‹è¯•
- âœ… ç…§ç‰‡é€‰æ‹©åŠŸèƒ½æµ‹è¯•
- âœ… çŠ¶æ€åˆ¤æ–­é€»è¾‘æµ‹è¯•
- âœ… APIè°ƒç”¨æµ‹è¯•
- âœ… é”™è¯¯å¤„ç†æµ‹è¯•

#### 6.1.2 é›†æˆæµ‹è¯•
- âœ… é€‰æ‹©å¤„ç†å®Œæ•´æµç¨‹æµ‹è¯•
- âœ… é‡æ–°å¤„ç†åŠŸèƒ½æµ‹è¯•
- âœ… æ‰¹é‡æ“ä½œæµ‹è¯•
- âœ… è¿›åº¦æ˜¾ç¤ºæµ‹è¯•

#### 6.1.3 ç”¨æˆ·ä½“éªŒæµ‹è¯•
- âœ… ç•Œé¢å“åº”é€Ÿåº¦æµ‹è¯•
- âœ… æ“ä½œæµç•…æ€§æµ‹è¯•
- âœ… é”™è¯¯æç¤ºå‡†ç¡®æ€§æµ‹è¯•

### 6.2 æ€§èƒ½æµ‹è¯•

#### 6.2.1 å¹¶å‘å¤„ç†æµ‹è¯•
- å¤§é‡ç…§ç‰‡é€‰æ‹©å¤„ç†æ€§èƒ½
- å¤šç”¨æˆ·åŒæ—¶æ“ä½œæ€§èƒ½
- å†…å­˜ä½¿ç”¨æƒ…å†µæµ‹è¯•

#### 6.2.2 ç½‘ç»œæ¡ä»¶æµ‹è¯•
- å¼±ç½‘ç»œç¯å¢ƒæµ‹è¯•
- ç½‘ç»œä¸­æ–­æ¢å¤æµ‹è¯•
- APIè¶…æ—¶å¤„ç†æµ‹è¯•

## ä¸ƒã€éƒ¨ç½²å’Œç»´æŠ¤

### 7.1 éƒ¨ç½²è¦æ±‚

#### 7.1.1 ç³»ç»Ÿè¦æ±‚
- **æ“ä½œç³»ç»Ÿ**ï¼šWindows 10+ / macOS 10.15+ / Ubuntu 18.04+
- **å†…å­˜**ï¼šæœ€ä½4GBï¼Œæ¨è8GB+
- **å­˜å‚¨**ï¼šæ ¹æ®ç…§ç‰‡åº“å¤§å°è€Œå®š
- **ç½‘ç»œ**ï¼šç¨³å®šçš„äº’è”ç½‘è¿æ¥ï¼ˆç”¨äºAIåˆ†æï¼‰

#### 7.1.2 è½¯ä»¶ä¾èµ–
- **Python**ï¼š3.8+
- **Node.js**ï¼š16+ï¼ˆå‰ç«¯æ„å»ºï¼‰
- **æ•°æ®åº“**ï¼šSQLite 3.0+
- **AIæœåŠ¡**ï¼šDashScope APIå¯†é’¥

### 7.2 ç»´æŠ¤ç­–ç•¥

#### 7.2.1 ç›‘æ§æŒ‡æ ‡
- å¤„ç†æˆåŠŸç‡
- å¹³å‡å¤„ç†æ—¶é—´
- ç”¨æˆ·æ“ä½œç»Ÿè®¡
- ç³»ç»Ÿèµ„æºä½¿ç”¨

#### 7.2.2 æ—¥å¿—ç®¡ç†
- æ“ä½œæ—¥å¿—è®°å½•
- é”™è¯¯æ—¥å¿—åˆ†æ
- æ€§èƒ½ç›‘æ§æ—¥å¿—
- ç”¨æˆ·è¡Œä¸ºæ—¥å¿—

#### 7.2.3 å¤‡ä»½ç­–ç•¥
- æ•°æ®åº“å®šæœŸå¤‡ä»½
- é…ç½®ä¿¡æ¯å¤‡ä»½
- æ—¥å¿—æ–‡ä»¶è½®è½¬

## å…«ã€é£é™©è¯„ä¼°å’Œåº”å¯¹

### 8.1 æŠ€æœ¯é£é™©

#### 8.1.1 APIè°ƒç”¨é£é™©
- **é£é™©**ï¼šAIæœåŠ¡è°ƒç”¨å¤±è´¥æˆ–è¶…æ—¶
- **åº”å¯¹**ï¼šå®ç°é‡è¯•æœºåˆ¶ã€é”™è¯¯å¤„ç†ã€é™çº§ç­–ç•¥

#### 8.1.2 å¹¶å‘å¤„ç†é£é™©
- **é£é™©**ï¼šå¤§é‡å¹¶å‘è¯·æ±‚å¯¼è‡´ç³»ç»Ÿè´Ÿè½½è¿‡é«˜
- **åº”å¯¹**ï¼šå®ç°è¯·æ±‚é˜Ÿåˆ—ã€é™æµæ§åˆ¶ã€èµ„æºç›‘æ§

#### 8.1.3 æ•°æ®ä¸€è‡´æ€§é£é™©
- **é£é™©**ï¼šå¤„ç†è¿‡ç¨‹ä¸­æ•°æ®çŠ¶æ€ä¸ä¸€è‡´
- **åº”å¯¹**ï¼šå®ç°äº‹åŠ¡ç®¡ç†ã€çŠ¶æ€åŒæ­¥ã€æ•°æ®æ ¡éªŒ

### 8.2 ä¸šåŠ¡é£é™©

#### 8.2.1 ç”¨æˆ·æ“ä½œé£é™©
- **é£é™©**ï¼šç”¨æˆ·è¯¯æ“ä½œå¯¼è‡´æ•°æ®ä¸¢å¤±
- **åº”å¯¹**ï¼šå®ç°æ“ä½œç¡®è®¤ã€æ’¤é”€æœºåˆ¶ã€æ•°æ®å¤‡ä»½

#### 8.2.2 åŠŸèƒ½å¯ç”¨æ€§é£é™©
- **é£é™©**ï¼šæ ¸å¿ƒåŠŸèƒ½ä¸å¯ç”¨å½±å“ç”¨æˆ·ä½“éªŒ
- **åº”å¯¹**ï¼šå®ç°é™çº§æ–¹æ¡ˆã€çŠ¶æ€ç›‘æ§ã€å¥åº·æ£€æŸ¥

## ä¹ã€æ€»ç»“

### 9.1 åŠŸèƒ½ä»·å€¼

é€‰æ‹©æ™ºèƒ½å¤„ç†åŠŸèƒ½ä¸ºå®¶åº­ç‰ˆæ™ºèƒ½ç…§ç‰‡ç³»ç»Ÿæä¾›äº†ä»¥ä¸‹ä»·å€¼ï¼š

1. **ç”¨æˆ·è‡ªä¸»æ€§**ï¼šç”¨æˆ·å¯ä»¥ç²¾ç¡®æ§åˆ¶è¦å¤„ç†çš„ç…§ç‰‡
2. **å¤„ç†æ•ˆç‡**ï¼šæ”¯æŒæ‰¹é‡å¤„ç†ï¼Œæå‡æ“ä½œæ•ˆç‡
3. **çŠ¶æ€é€æ˜**ï¼šæ¸…æ™°æ˜¾ç¤ºç…§ç‰‡å¤„ç†çŠ¶æ€
4. **çµæ´»æ€§**ï¼šæ”¯æŒé€‰æ‹©å¤„ç†å’Œé‡æ–°å¤„ç†
5. **ä½“éªŒä¼˜åŒ–**ï¼šç›´è§‚å‹å¥½çš„äº¤äº’ç•Œé¢

### 9.2 æŠ€æœ¯äº®ç‚¹

1. **å‰ç«¯æ¶æ„**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œç»„ä»¶å¤ç”¨æ€§å¼º
2. **çŠ¶æ€ç®¡ç†**ï¼šå®æ—¶çŠ¶æ€åŒæ­¥ï¼Œæ•°æ®ä¸€è‡´æ€§ä¿è¯
3. **ç”¨æˆ·ä½“éªŒ**ï¼šå“åº”å¼è®¾è®¡ï¼Œäº¤äº’æµç•…
4. **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œç”¨æˆ·æç¤º
5. **æ€§èƒ½ä¼˜åŒ–**ï¼šå¼‚æ­¥å¤„ç†ï¼Œèµ„æºåˆç†åˆ©ç”¨

### 9.3 åç»­è§„åˆ’

#### 9.3.1 çŸ­æœŸä¼˜åŒ–ï¼ˆV1.1ï¼‰
- æ™ºèƒ½è¿‡æ»¤åŠŸèƒ½ï¼ˆåªæ˜¾ç¤ºæœªå¤„ç†çš„ç…§ç‰‡ï¼‰
- å¤„ç†å†å²è®°å½•
- è‡ªå®šä¹‰åˆ†æç±»å‹é€‰æ‹©

#### 9.3.2 ä¸­æœŸæ‰©å±•ï¼ˆV2.0ï¼‰
- æ™ºèƒ½æ¨èåŠŸèƒ½ï¼ˆæ ¹æ®ç…§ç‰‡ç‰¹å¾æ¨èå¤„ç†ï¼‰
- æ‰¹é‡æ“ä½œæ¨¡æ¿
- å¤„ç†ç»“æœå¯¹æ¯”

#### 9.3.3 é•¿æœŸè§„åˆ’ï¼ˆV3.0ï¼‰
- æœºå™¨å­¦ä¹ ä¼˜åŒ–ï¼ˆå­¦ä¹ ç”¨æˆ·å¤„ç†åå¥½ï¼‰
- äº‘ç«¯å¤„ç†æ”¯æŒ
- å¤šè®¾å¤‡åŒæ­¥

---

**æ–‡æ¡£çŠ¶æ€**ï¼šè‰ç¨¿
**æœ€åæ›´æ–°**ï¼š2025å¹´9æœˆ20æ—¥
**ç‰ˆæœ¬å·**ï¼šV1.0
